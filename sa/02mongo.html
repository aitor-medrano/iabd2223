
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Características de MongoDB. Instalación mediante Docker, uso de MongoAtlas y MongoDB Compass. Consultas sencillas, con condiciones compuestas y acceso a arrays. Operaciones de modificación y borrado de documentos.">
      
      
      
        <link rel="canonical" href="https://aitor-medrano.github.io/iabd2223/sa/02mongo.html">
      
      <link rel="icon" href="../images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.6">
    
    
      
        <title>MongoDB - Inteligencia Artificial y Big Data</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-MFP4QLMMV7"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-MFP4QLMMV7",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-MFP4QLMMV7",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="MongoDB - Inteligencia Artificial y Big Data" >
      
        <meta  property="og:description"  content="Características de MongoDB. Instalación mediante Docker, uso de MongoAtlas y MongoDB Compass. Consultas sencillas, con condiciones compuestas y acceso a arrays. Operaciones de modificación y borrado de documentos." >
      
        <meta  property="og:image"  content="https://aitor-medrano.github.io/iabd2223/assets/images/social/sa/02mongo.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://aitor-medrano.github.io/iabd2223/sa/02mongo.html" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="MongoDB - Inteligencia Artificial y Big Data" >
      
        <meta  name="twitter:description"  content="Características de MongoDB. Instalación mediante Docker, uso de MongoAtlas y MongoDB Compass. Consultas sencillas, con condiciones compuestas y acceso a arrays. Operaciones de modificación y borrado de documentos." >
      
        <meta  name="twitter:image"  content="https://aitor-medrano.github.io/iabd2223/assets/images/social/sa/02mongo.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#conceptos" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-header__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Inteligencia Artificial y Big Data
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              MongoDB
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="light-blue"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="light-blue"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-nav__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    Inteligencia Artificial y Big Data
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Inicio
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          UF1 - Toma de decisiones
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="UF1 - Toma de decisiones" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          UF1 - Toma de decisiones
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" checked>
      
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html">UT2.- Sistemas de almacenamiento</a>
          
            <label for="__nav_2_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="UT2.- Sistemas de almacenamiento" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          UT2.- Sistemas de almacenamiento
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="01nosql.html" class="md-nav__link">
        S18.- Almacenamiento de datos. NoSQL
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          S19.- MongoDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="02mongo.html" class="md-nav__link md-nav__link--active">
        S19.- MongoDB
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#conceptos" class="md-nav__link">
    Conceptos
  </a>
  
    <nav class="md-nav" aria-label="Conceptos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bson" class="md-nav__link">
    BSON
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#puesta-en-marcha" class="md-nav__link">
    Puesta en marcha
  </a>
  
    <nav class="md-nav" aria-label="Puesta en marcha">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacion" class="md-nav__link">
    Instalación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongo-atlas" class="md-nav__link">
    Mongo Atlas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongosh" class="md-nav__link">
    mongosh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongodb-database-tools" class="md-nav__link">
    MongoDB Database Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongodb-compass" class="md-nav__link">
    MongoDB Compass
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongodb-for-vscode" class="md-nav__link">
    MongoDB for VSCode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hola-mongodb" class="md-nav__link">
    Hola MongoDB
  </a>
  
    <nav class="md-nav" aria-label="Hola MongoDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trabajando-con-el-shell" class="md-nav__link">
    Trabajando con el shell
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#empleando-javascript" class="md-nav__link">
    Empleando JavaScript
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objectid" class="md-nav__link">
    ObjectId
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recuperando-datos" class="md-nav__link">
    Recuperando datos
  </a>
  
    <nav class="md-nav" aria-label="Recuperando datos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criterios-en-consultas" class="md-nav__link">
    Criterios en consultas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proyeccion-de-campos" class="md-nav__link">
    Proyección de campos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#condiciones-compuestas-con-y-o" class="md-nav__link">
    Condiciones compuestas con Y / O
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#condiciones-sobre-objetos-anidados" class="md-nav__link">
    Condiciones sobre objetos anidados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas-sobre-arrays" class="md-nav__link">
    Consultas sobre arrays
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conjunto-de-valores" class="md-nav__link">
    Conjunto de valores
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cursores" class="md-nav__link">
    Cursores
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contando-documentos" class="md-nav__link">
    Contando Documentos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modificando-documentos" class="md-nav__link">
    Modificando documentos
  </a>
  
    <nav class="md-nav" aria-label="Modificando documentos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operadores-de-actualizacion" class="md-nav__link">
    Operadores de actualización
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#control-de-la-concurrencia" class="md-nav__link">
    Control de la concurrencia
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actualizaciones-sobre-arrays" class="md-nav__link">
    Actualizaciones sobre Arrays
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#borrando-documentos" class="md-nav__link">
    Borrando documentos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actividades" class="md-nav__link">
    Actividades
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="03modelado.html" class="md-nav__link">
        S21.- Modelado de datos NoSQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="04formatos.html" class="md-nav__link">
        S21.- Formatos de datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="05agregaciones.html" class="md-nav__link">
        S26.- Agregaciones
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="https://aitor-medrano.github.io/pia2223/" class="md-nav__link">
        UT7.- PIAFP Lara
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#conceptos" class="md-nav__link">
    Conceptos
  </a>
  
    <nav class="md-nav" aria-label="Conceptos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#bson" class="md-nav__link">
    BSON
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#puesta-en-marcha" class="md-nav__link">
    Puesta en marcha
  </a>
  
    <nav class="md-nav" aria-label="Puesta en marcha">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instalacion" class="md-nav__link">
    Instalación
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongo-atlas" class="md-nav__link">
    Mongo Atlas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongosh" class="md-nav__link">
    mongosh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongodb-database-tools" class="md-nav__link">
    MongoDB Database Tools
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongodb-compass" class="md-nav__link">
    MongoDB Compass
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mongodb-for-vscode" class="md-nav__link">
    MongoDB for VSCode
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hola-mongodb" class="md-nav__link">
    Hola MongoDB
  </a>
  
    <nav class="md-nav" aria-label="Hola MongoDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trabajando-con-el-shell" class="md-nav__link">
    Trabajando con el shell
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#empleando-javascript" class="md-nav__link">
    Empleando JavaScript
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#objectid" class="md-nav__link">
    ObjectId
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#recuperando-datos" class="md-nav__link">
    Recuperando datos
  </a>
  
    <nav class="md-nav" aria-label="Recuperando datos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#criterios-en-consultas" class="md-nav__link">
    Criterios en consultas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#proyeccion-de-campos" class="md-nav__link">
    Proyección de campos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#condiciones-compuestas-con-y-o" class="md-nav__link">
    Condiciones compuestas con Y / O
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#condiciones-sobre-objetos-anidados" class="md-nav__link">
    Condiciones sobre objetos anidados
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas-sobre-arrays" class="md-nav__link">
    Consultas sobre arrays
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conjunto-de-valores" class="md-nav__link">
    Conjunto de valores
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cursores" class="md-nav__link">
    Cursores
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#contando-documentos" class="md-nav__link">
    Contando Documentos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modificando-documentos" class="md-nav__link">
    Modificando documentos
  </a>
  
    <nav class="md-nav" aria-label="Modificando documentos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operadores-de-actualizacion" class="md-nav__link">
    Operadores de actualización
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#control-de-la-concurrencia" class="md-nav__link">
    Control de la concurrencia
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#actualizaciones-sobre-arrays" class="md-nav__link">
    Actualizaciones sobre Arrays
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#borrando-documentos" class="md-nav__link">
    Borrando documentos
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actividades" class="md-nav__link">
    Actividades
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>S19.- MongoDB</h1>

<p><em>MongoDB</em> (<a href="http://www.mongodb.com">http://www.mongodb.com</a>) es una de las bases de datos NoSQL más conocidas. Sigue un modelo de datos documental, donde los documentos se basan en JSON.</p>
<div class="admonition tip inline end">
<p class="admonition-title">huMONGOus</p>
<p>Como curiosidad, su nombre viene de la palabra inglesa <em>humongous</em>, que significa gigantesco/enorme.</p>
</div>
<p><em>MongoDB</em> destaca porque:</p>
<ul>
<li>Soporta esquemas dinámicos: diferentes documentos de una misma colección pueden tener atributos diferentes.</li>
<li>Aunque inicialmente tenía un soporte limitado de <em>joins</em>, desde la versión 5.2 se pueden realizar incluso entre colecciones particionadas.</li>
<li>Soporte de transacciones sólo a nivel de aplicación. Lo que en un <abbr title="Sistema gestor de base de datos relacional">RDMS</abbr> puede suponer múltiples operaciones, con MongoDB se puede hacer en una sola operación al insertar/actualizar todo un documento de una sola vez, pero si queremos crear una transacción entre dos documentos, la gestión la debe realizar el driver.</li>
</ul>
<h2 id="conceptos">Conceptos<a class="headerlink" href="#conceptos" title="Permanent link">&para;</a></h2>
<p>Hay una serie de conceptos que conviene conocer antes de entrar en detalle:</p>
<ul>
<li>MongoDB tienen el mismo concepto de <strong>base de datos</strong> que un <abbr title="Sistema gestor de base de datos relacional">RDMS</abbr>. Dentro de una instancia de MongoDB podemos tener 0 o más bases de datos, actuando cada una como un contenedor de alto nivel.</li>
<li>Una base de datos tendrá 0 o más colecciones. Una <strong>colección</strong> es muy similar a lo que entendemos como tabla dentro de un <abbr title="Sistema gestor de base de datos relacional">RDMS</abbr>. MongoDB ofrece diferentes tipos de colecciones, desde las normales cuyo tamaño crece conforme lo hace el número de documentos, como las colecciones <em>capped</em>, las cuales tienen un tamaño predefinido y que pueden contener una cierta cantidad de información que se sustituirá por nueva cuando se llene.</li>
<li>Las colecciones contienen 0 o más <strong>documentos</strong>, por lo que es similar a una fila o registro de un <abbr title="Sistema gestor de base de datos relacional">RDMS</abbr>.</li>
<li>Cada documento contiene 0 o más atributos, compuestos de <strong>parejas clave/valor</strong>. Cada uno de estos documentos no sigue ningún esquema, por lo que dos documentos de una misma colección pueden contener todos los atributos diferentes entre sí.</li>
</ul>
<figure style="align: center;">
    <img src="images/02mongodbitems.png" width="400px">
    <figcaption>Elementos de MongoDB</figcaption>
</figure>

<p>Así pues, tenemos que una base de datos va a contener varias colecciones, donde cada colección contendrá un conjunto de documentos:</p>
<figure style="align: center;">
    <img src="images/02mongodbmodel.jpg" width="400px">
    <figcaption>Modelo de MongoDB</figcaption>
</figure>

<p>Además, <em>MongoDB</em> soporta <strong>índices</strong>, igual que cualquier <abbr title="Sistema gestor de base de datos relacional">RDMS</abbr>, para acelerar la búsqueda de datos. Al realizar cualquier consulta, se devuelve un <strong>cursor</strong>, con el cual podemos hacer cosas tales como contar, ordenar, limitar o saltar documentos.</p>
<h3 id="bson">BSON<a class="headerlink" href="#bson" title="Permanent link">&para;</a></h3>
<p>Mediante <em>JavaScript</em> podemos crear objetos que se representan con JSON. Internamente, <em>MongoDB</em> almacena los documentos mediante BSON (<em>Binary JSON</em>). Podemos consultar la especificación en <a href="http://BSONSpec.org">http://BSONSpec.org</a></p>
<figure style="align: center;">
    <img src="images/02bson.jpg" width="500px">
    <figcaption>Especificación BSON</figcaption>
</figure>

<p>BSON representa un superset de JSON ya que:</p>
<ul>
<li>Permite almacenar datos en binario</li>
<li>Incluye un conjunto de tipos de datos no incluidos en JSON, como pueden ser <code>ObjectId</code>, <code>Date</code> o <code>BinData</code>.</li>
</ul>
<p>Podemos consultar todos los tipos que soporta un objeto BSON en <a href="http://docs.mongodb.org/manual/reference/bson-types/">http://docs.mongodb.org/manual/reference/bson-types/</a></p>
<p>Un ejemplo de un objeto BSON podría ser:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="err">var</span><span class="w"> </span><span class="err">yo</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="kc">n</span><span class="err">ombre</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Aitor&quot;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="err">apellidos</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Medrano&quot;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="kc">fna</span><span class="err">c</span><span class="p">:</span><span class="w"> </span><span class="kc">ne</span><span class="err">w</span><span class="w"> </span><span class="err">Da</span><span class="kc">te</span><span class="err">(</span><span class="s2">&quot;Oct 3, 1977&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="err">hobbies</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;programación&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;videojuegos&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;baloncesto&quot;</span><span class="p">],</span><span class="w"></span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="err">casado</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="err">hijos</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="err">co</span><span class="kc">nta</span><span class="err">c</span><span class="kc">t</span><span class="err">o</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="kc">t</span><span class="err">wi</span><span class="kc">tter</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;@aitormedrano&quot;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="err">email</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;a.medrano@edu.gva.es&quot;</span><span class="w"></span>
<span class="linenos" data-linenos="11 "></span><span class="w">  </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="kc">fe</span><span class="err">chaCreacio</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="kc">ne</span><span class="err">w</span><span class="w"> </span><span class="err">Times</span><span class="kc">ta</span><span class="err">mp()</span><span class="w"></span>
<span class="linenos" data-linenos="13 "></span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Los <a href="https://www.mongodb.com/docs/manual/core/document/">documentos</a> BSON tienen las siguientes restricciones:</p>
<ul>
<li>No pueden tener un tamaño superior a 16 MB.</li>
<li>El atributo <code>_id</code> queda reservado para la clave primaria.</li>
<li>Desde MongoDB 5.0 los nombres de los campos pueden <a href="https://www.mongodb.com/docs/manual/core/dot-dollar-considerations">empezar por <code>$</code> y/o contener el <code>.</code></a>, aunque en la medida de lo posible, es recomendable evitar su uso.</li>
</ul>
<p>Además MongoDB:</p>
<ul>
<li>No asegura que el orden de los campos se respete.</li>
<li>Es sensible a los tipos de los datos</li>
<li>Es sensible a las mayúsculas.</li>
</ul>
<p>Por lo que estos documentos son distintos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="nt">&quot;edad&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;18&quot;</span><span class="p">}</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="p">{</span><span class="nt">&quot;edad&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">}</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="p">{</span><span class="nt">&quot;Edad&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">18</span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Si queremos validar si un documento JSON es válido, podemos usar <a href="http://jsonlint.com/">http://jsonlint.com/</a>. Hemos de tener en cuenta que sólo valida JSON y no BSON, por tanto nos dará errores en los tipos de datos propios de BSON.</p>
<h2 id="puesta-en-marcha">Puesta en marcha<a class="headerlink" href="#puesta-en-marcha" title="Permanent link">&para;</a></h2>
<p>En la actualidad, <em>MongoDB</em> se comercializa mediante tres productos:</p>
<ul>
<li><a href="https://www.mongodb.com/developer/products/atlas/">Mongo Atlas</a>, como plataforma cloud, con una opción gratuita mediante un cluster de 512MB.</li>
<li><a href="https://www.mongodb.com/try/download/community">MongoDB Community Edition</a>, versión gratuita para trabajar on-premise, con versiones para Windows, MacOS y Linux.</li>
<li><a href="https://www.mongodb.com/products/mongodb-enterprise-advanced">MongoDB Enterprise Advanced</a>, versión de pago con soporte, herramientas avanzadas de monitorización y seguridad, y administración automatizada.</li>
</ul>
<h3 id="instalacion">Instalación<a class="headerlink" href="#instalacion" title="Permanent link">&para;</a></h3>
<p>Desde <a href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a> podemos descargar la versión <em>Community</em> acorde a nuestro sistema operativo.</p>
<p>Independientemente de nuestro sistema operativo, por defecto, el demonio se lanza sobre el puerto 27017. Una vez instalado, si accedemos a <a href="http://localhost:27017">http://localhost:27017</a> podremos ver que nos indica cómo estamos intentando acceder mediante HTTP a MongoDB mediante el puerto reservado al <em>driver</em> nativo.</p>
<figure style="align: center;">
    <img src="images/02localhost27017.png">
    <figcaption>Acceso al puerto 27017</figcaption>
</figure>

<p>En vez de instalarlo como un servicio en nuestra máquina, a día de hoy, es mucho más cómodo hacer uso de contenedores <em>Docker</em> o utilizar una solución <em>cloud</em>.</p>
<h3 id="docker">Docker<a class="headerlink" href="#docker" title="Permanent link">&para;</a></h3>
<p>Para lanzar el contenedor de Docker al que llamaremos <code>iadb-mongo</code> mediante el siguiente comando:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker run -p <span class="m">127</span>.0.0.1:27017:27017 --name iabd-mongo -d mongo
</code></pre></div>
<p>A continuación vamos a descargar el conjunto de datos <a href="https://atlas-education-staging.s3.amazonaws.com/sampledata.archive.gz">sampledata.archive.gz</a> que ofrece <em>MongoDB</em> a modo de prueba, el cual vamos a emplear a lo largo de las diferentes sesiones.</p>
<p>Volvemos al terminal de nuestro sistema y copiamos los datos desde nuestro sistema a la carpeta <code>/tmp</code> del contenedor:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker cp sampledata.archive.gz iabd-mongo:/tmp
</code></pre></div>
<p>Posteriormente abrimos un terminal dentro de nuestro contenedor  (o mediante <em>Attach Shell</em> en <em>VSCode</em>):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker <span class="nb">exec</span> -it iabd-mongo bash
</code></pre></div>
<p>Y finalmente, restauramos los datos mediante <code>mongorestore</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>mongorestore --gzip --archive<span class="o">=</span>/tmp/sampledata.archive.gz
</code></pre></div>
<p>Una vez cargados, nos informará que se han restaurado 433281 documentos.</p>
<h3 id="mongo-atlas">Mongo Atlas<a class="headerlink" href="#mongo-atlas" title="Permanent link">&para;</a></h3>
<p>Y si preferimos una solución <em>cloud</em>, disponemos de <a href="https://www.mongodb.com/es/atlas">Mongo Atlas</a>, que nos ofrece de manera gratuita un cluster compartido de servidores con 3 nodos y 512 MB para datos. Si queremos una solución <em>serverless</em> o un servidor dedicado, ya tendremos que <a href="https://www.mongodb.com/pricing">pasar por caja</a>.</p>
<figure style="align: center;">
    <img src="images/02mongoatlas-register.png">
    <figcaption>Registro en Mongo Atlas</figcaption>
</figure>

<p>Para comenzar a utilizar <em>Mongo Atlas</em> el primer paso es <a href="https://www.mongodb.com/cloud/atlas/register">registrarnos</a> y completar un cuestionario sobre nuestro uso. Tras ello:</p>
<ol>
<li>
<p>Creamos el cluster de despliegue. En nuestro caso, hemos realizado el despliegue en AWS en la región de Paris (<code>eu-west-3</code>) y dejado el nombre por defecto, <code>Cluster 0</code>.<br />
    <figure style="align: center;">
        <img src="images/02mongoatlas-cluster.png">
        <figcaption>Elección del cluster</figcaption>
    </figure></p>
</li>
<li>
<p>Creamos un usuario/contraseña para autenticar nuestra conexión. En nuestro caso, hemos creado el usuario <code>iabd</code> con la contraseña <code>iabdiabd</code> (después la podemos modificar desde el menú <em>Security -&gt; Database Access</em>):</p>
<p><figure style="align: center;">
    <img src="images/02mongoatlas-usuario.png">
    <figcaption>Configuración del usuario</figcaption>
</figure></p>
<p>En la misma pantalla, indicamos que permitimos las conexiones desde todas las direcciones IP (esta decisión sólo la tomamos por comodidad, para poder conectarnos desde casa y el centro) mediante la IP <code>0.0.0.0</code> (después podemos modificar la configuración desde el menú <em>Security -&gt; Network Access</em>).</p>
</li>
<li>
<p>Una vez realizados los dos pasos anteriores, comenzará la creación del cluster, la cual puede tardar de 2 a 3 minutos.</p>
<p><figure style="align: center;">
    <img src="images/02mongoatlas-dashboard.png">
    <figcaption>Dashboard del cluster</figcaption>
</figure></p>
</li>
<li>
<p>A continuación, cargaremos los datos de ejemplo. Para ello, en el menú con los tres puntos (<code>...</code>), elegiremos la opción <em>Load Sample Dataset</em>. Una vez haya finalizado, podremos ver los datos cargados pulsando sobre el botón <em>Browse Collections</em>:</p>
<p><figure style="align: center;">
    <img src="images/02mongoatlas-colecciones.png">
    <figcaption>Colecciones con los datos de prueba</figcaption>
</figure></p>
</li>
</ol>
<div class="admonition tip inline end">
<p class="admonition-title">Conexión segura</p>
<p>Mediante <code>srv</code> se establece una conexión segura</p>
</div>
<p>Finalmente, para obtener la cadena de conexión, desde el <em>dashboard</em> del cluster con la opción <em>Connect</em> o desde la pestaña <em>Cmd Line Tools</em> del propio cluster, podremos obtener la <a href="https://www.mongodb.com/docs/manual/reference/connection-string">cadena de conexión</a>, que tendrá un formato similar a :</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>mongodb+srv://usuario:password@host/basededatos
</code></pre></div>
<p>A continuación, vamos a conocer las diferentes herramientas que nos ofrece MongoDB para posteriormente estudiar todas las operaciones que podemos realizar.</p>
<h3 id="mongosh">mongosh<a class="headerlink" href="#mongosh" title="Permanent link">&para;</a></h3>
<p>Tras arrancar el demonio <code>mongod</code> (el cual se lanza automáticamente mediante <em>Docker</em> o con el cluster de <em>Mongo Atlas</em>) llega el momento de acceder mediante el cliente <a href="https://www.mongodb.com/docs/mongodb-shell/"><code>mongosh</code></a> (en versiones anteriores el comando utilizado era <code>mongo</code>), el cual funciona igual que un shell, de modo que con la fecha hacia arriba visualizaremos el último comando. El cliente utiliza <em>JavaScript</em> como lenguaje de interacción con la base de datos.</p>
<p>Si nos conectamos desde Docker, no necesitamos instalarlo. Primero nos conectamos al contenedor:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>docker <span class="nb">exec</span> -it iabd-mongo bash
</code></pre></div>
<p>Al conectar con <code>mongosh</code> si no le indicamos nada se conectará por defecto a la base de datos <code>test</code> de <em>localhost</em>. Si queremos conectarnos a una base de datos concreta, por ejemplo a <code>sample_training</code>, la pasaremos como parámetro:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">root</span><span class="err">@</span><span class="mf">3</span><span class="nx">ad17b675fb1</span><span class="o">:</span><span class="err">/# mongosh sample_training</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="nx">Current</span><span class="w"> </span><span class="nx">Mongosh</span><span class="w"> </span><span class="nx">Log</span><span class="w"> </span><span class="nx">ID</span><span class="o">:</span><span class="w"> </span><span class="mf">6316498</span><span class="nx">f30f8283fedcfabc2</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="nx">Connecting</span><span class="w"> </span><span class="nx">to</span><span class="o">:</span><span class="w">          </span><span class="nx">mongodb</span><span class="o">:</span><span class="c1">//127.0.0.1:27017/sample_training?directConnection=true&amp;serverSelectionTimeoutMS=2000</span><span class="w"></span>
<span class="linenos" data-linenos="4 "></span><span class="nx">Using</span><span class="w"> </span><span class="nx">MongoDB</span><span class="o">:</span><span class="w">          </span><span class="mf">5.0.4</span><span class="w"></span>
<span class="linenos" data-linenos="5 "></span><span class="nx">Using</span><span class="w"> </span><span class="nx">Mongosh</span><span class="o">:</span><span class="w">          </span><span class="mf">1.1.2</span><span class="w"></span>
</code></pre></div>
<p>Si queremos ver las bases de datos que existen ejecutaremos el comando <code>show dbs</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span>sample_training&gt; show dbs<span class="p">;</span>
<span class="linenos" data-linenos=" 2 "></span>admin                 <span class="m">41</span> kB
<span class="linenos" data-linenos=" 3 "></span>config              <span class="m">73</span>.7 kB
<span class="linenos" data-linenos=" 4 "></span><span class="nb">local</span>               <span class="m">73</span>.7 kB
<span class="linenos" data-linenos=" 5 "></span>sample_airbnb       <span class="m">55</span>.1 MB
<span class="linenos" data-linenos=" 6 "></span>sample_analytics     <span class="m">9</span>.9 MB
<span class="linenos" data-linenos=" 7 "></span>sample_geospatial    <span class="m">999</span> kB
<span class="linenos" data-linenos=" 8 "></span>sample_mflix        <span class="m">48</span>.5 MB
<span class="linenos" data-linenos=" 9 "></span>sample_restaurants   <span class="m">6</span>.2 MB
<span class="linenos" data-linenos="10 "></span>sample_supplies      <span class="m">991</span> kB
<span class="linenos" data-linenos="11 "></span>sample_training     <span class="m">43</span>.4 MB
<span class="linenos" data-linenos="12 "></span>sample_weatherdata  <span class="m">2</span>.49 MB
</code></pre></div>
<p>Si nos quisiéramos conectar a nuestro cluster de <em>Mongo Atlas</em> utilizaremos la cadena de conexión tras el comando <code>mongosh</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>root@3ad17b675fb1:/# mongosh mongodb+srv://iabd:iabdiabd@cluster0.dfaz5er.mongodb.net/test
<span class="linenos" data-linenos="2 "></span>Current Mongosh Log ID: 63164ac26030844c1576f8b4
<span class="linenos" data-linenos="3 "></span>Connecting to:          mongodb+srv://&lt;credentials&gt;@cluster0.dfaz5er.mongodb.net/test
<span class="linenos" data-linenos="4 "></span>Using MongoDB:          <span class="m">5</span>.0.11
<span class="linenos" data-linenos="5 "></span>Using Mongosh:          <span class="m">1</span>.1.2
<span class="linenos" data-linenos="6 "></span>
<span class="linenos" data-linenos="7 "></span>For mongosh info see: https://docs.mongodb.com/mongodb-shell/
<span class="linenos" data-linenos="8 "></span>
<span class="linenos" data-linenos="9 "></span>Atlas atlas-4wikkb-shard-0 <span class="o">[</span>primary<span class="o">]</span> test&gt;
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Uso externo</p>
<p>Si no queremos tener que conectarnos al contenedor o vamos a trabajar con un servidor remoto, podemos instalar únicamente el shell desde <a href="https://www.mongodb.com/try/download/shell">https://www.mongodb.com/try/download/shell</a></p>
</div>
<h3 id="mongodb-database-tools">MongoDB Database Tools<a class="headerlink" href="#mongodb-database-tools" title="Permanent link">&para;</a></h3>
<p>Además del propio servidor de MongoDB y el cliente para conectarse a él, <em>MongoDB</em> ofrece un conjunto de <a href="https://www.mongodb.com/docs/database-tools">herramientas</a> para interactuar con las bases de datos, permitiendo crear y restaurar copias de seguridad.</p>
<p>Si estamos interesados en introducir o exportar una colección de datos mediante JSON, podemos emplear los comandos <a href="https://www.mongodb.com/docs/database-tools/mongoimport/"><code>mongoimport</code></a> y <a href="https://www.mongodb.com/docs/database-tools/mongoexport/"><code>mongoexport</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>mongoimport -d nombreBaseDatos -c coleccion –-file nombreFichero.json
<span class="linenos" data-linenos="2 "></span>mongoexport -d nombreBaseDatos -c coleccion nombreFichero.json
</code></pre></div>
<p>Estas herramientas interactúan con datos JSON y no sobre toda la base de datos.</p>
<p>Un caso particular y muy común es importar datos que se encuentran en formato CSV/TSV. Para ello, emplearemos el parámetro <code>--type csv</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>mongoimport --type tsv -d <span class="nb">test</span> -c poblacion --headerline --drop poblacionEspanya2013.tsv
</code></pre></div>
<p>En vez de realizar un <em>export</em>, es más conveniente realizar un <em>backup</em> en binario mediante <a href="https://www.mongodb.com/docs/database-tools/mongodump/"><code>mongodump</code></a>, el cual genera ficheros BSON. Estos archivos posteriormente se restauran mediante <a href="https://www.mongodb.com/docs/database-tools/mongorestore/"><code>mongorestore</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>mongodump -d nombreBaseDatos nombreFichero.bson
<span class="linenos" data-linenos="2 "></span>mongorestore -d nombreBaseDatos nombreFichero.bson
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">Autoevaluación</p>
<p>Intenta exportar los datos de la base de datos <code>sample_training</code> desde MongoAtlas. Veras que ha creado una carpeta que contiene dos archivos ¿Cuáles son? ¿Qué contiene cada uno de ellos y cual es su formato?</p>
</div>
<p>Si necesitamos transformar un fichero BSON a JSON (de binario a texto), tenemos el comando <a href="https://www.mongodb.com/docs/database-tools/bsondump"><code>bsondump</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>bsondump file.bson &gt; file.json
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Más información sobre copias de seguridad en <a href="https://www.mongodb.com/docs/manual/core/backups/">https://www.mongodb.com/docs/manual/core/backups/</a>.</p>
</div>
<p>Para poder trabajar con MongoDB desde cualquier aplicación necesitamos un driver. MongoDB ofrece <a href="https://www.mongodb.com/docs/drivers/">drivers</a> oficiales para casi todos los lenguajes de programación actuales. En la sesión 30 de 'MongoDB y Python' trabajaremos con <a href="https://pymongo.readthedocs.io/en/stable/">PyMongo</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Monitorización</p>
<p>Tanto <a href="https://www.mongodb.com/docs/database-tools/mongostat/"><code>mongostat</code></a> como <a href="https://www.mongodb.com/docs/database-tools/mongotop/"><code>mongotop</code></a> permiten visualizar el estado del servidor MongoDB, así como algunas estadísticas sobre su rendimiento. Si trabajamos con MongoAtlas estas herramientas están integradas en las diferentes herramientas de monitorización de la plataforma.</p>
</div>
<p>En versiones anteriores, una herramienta de terceros bastante utilizada era <a href="http://robomongo.org">RoboMongo</a> / Robo3T / <a href="https://studio3t.com/">Studio3T</a> el cual extiende el shell y ofrece un IDE más amigable. A días de hoy, MongoDB tiene su propio IDE conocido como <a href="https://www.mongodb.com/es/products/compass">Mongo Compass</a>.</p>
<h3 id="mongodb-compass">MongoDB Compass<a class="headerlink" href="#mongodb-compass" title="Permanent link">&para;</a></h3>
<p>En el curso nos vamos a centrar en el uso del shell y la conectividad de MongoDB mediante Python, pero no está de más conocer las herramientas visuales que facilitan el trabajo con MongoDB en el día a día.</p>
<p>Una de ellas es <a href="https://www.mongodb.com/es/products/compass">MongoDB Compass</a>, que facilita la exploración y manipulación de los datos. De una manera flexible e intuitiva, Compass ofrece visualizaciones detalladas de los esquemas, métricas de rendimiento en tiempo real así como herramientas para la creación de consultas.</p>
<p>Existen tres versiones de Compass, una completa con todas las características, una de sólo lectura sin posibilidad de insertar, modificar o eliminar datos (perfecta para analítica de datos) y una última versión <em>isolated</em> que solo permite la conexión a una instancia local.</p>
<p>Una vez descargada e instalada la versión que nos interesa, tras crear la conexión a partir de la cadena de conexión (similar a <code>mongodb+srv://iabd:iabdiabd@cluster0.4hm7u8y.mongodb.net/test</code>), veremos en el menú de la izquierda un resumen del cluster, así como las consultas que vayamos almacenando y las diferentes bases de datos almacenadas:</p>
<figure style="align: center;">
    <img src="images/02mongocompass-init.png">
    <figcaption>GUI de Mongo Compass</figcaption>
</figure>

<p>Si seleccionamos una base de datos concreta, y de ella, una colección en el menú de la izquierda, en el panel central tendremos una visualización de los datos contenidos, así como opciones para ver su esquema, realizar consultas agregadas, editar los índices, etc... Además, podremos realizar consultas sobre los datos:</p>
<figure style="align: center;">
    <img src="images/02mongocompass-coleccion.png">
    <figcaption>Opciones desde una colección</figcaption>
</figure>

<div class="admonition tip">
<p class="admonition-title">mongosh en Compass</p>
<p>Si te fijas, en la barra inferior podemos desplegar un panel para interactuar mediante comandos como lo haríamos desde <code>mongosh</code>.</p>
</div>
<h3 id="mongodb-for-vscode">MongoDB for VSCode<a class="headerlink" href="#mongodb-for-vscode" title="Permanent link">&para;</a></h3>
<p>También podemos utilizar la <a href="https://marketplace.visualstudio.com/items?itemName=mongodb.mongodb-vscode">extensión</a> que lleva <em>VSCode</em> para trabajar con <em>MongoDB</em>.</p>
<p>Tras su instalación creamos una conexión a partir de la cadena de conexión (similar a <code>mongodb+srv://iabd:iabdiabd@cluster0.4hm7u8y.mongodb.net/test</code>), y una vez conectados, podremos recorrer las colecciones con los datos así como utilizar un <em>playground</em> para interactuar de manera similar al shell:</p>
<figure style="align: center;">
    <img src="images/02mongoatlas-vscode.png">
    <figcaption>Uso de la extensión de VSCode</figcaption>
</figure>

<h2 id="hola-mongodb">Hola MongoDB<a class="headerlink" href="#hola-mongodb" title="Permanent link">&para;</a></h2>
<p>Pues una vez que ya nos hemos conectado a MongoDB mediante <code>mongosh</code>, vamos a empezar a interactuar con los datos.</p>
<p>En cualquier momento podemos cambiar la base de datos activa mediante <code>use nombreBaseDatos</code>. Si la base de datos no existiese, MongoDB creará dicha base de datos. Esto es una verdad a medias, ya que la base de datos realmente se crea al insertar datos dentro de alguna colección.</p>
<p>Así pues, vamos a crear nuestra base de datos <code>iabd</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">use</span><span class="w"> </span><span class="nx">iabd</span><span class="w"></span>
</code></pre></div>
<p>Una vez creada, podemos crear nuestra primera colección, que llamaremos <code>people</code>, e insertaremos un persona con nuestros datos personales mediante el método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.insertOne/"><code>insertOne</code></a>, al que le pasamos un objeto JSON:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="w"> </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">edad</span><span class="o">:</span><span class="w"> </span><span class="mf">45</span><span class="p">,</span><span class="w"> </span><span class="nx">profesion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Profesor&quot;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Tras ejecutar el comando, veremos que nos devuelve un objeto JSON con su ACK y el identificador del documento insertado:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="err">ack</span><span class="kc">n</span><span class="err">owledged</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="err">i</span><span class="kc">nserte</span><span class="err">dId</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;6316fc938cc2bc168bfed066&quot;</span><span class="err">)</span><span class="w"></span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Una vez insertada, sólo nos queda realizar una consulta para recuperar los datos y comprobar que todo funciona correctamente mediante el método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.findOne/"><code>findOne</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">findOne</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<p>Lo que nos dará como resultado un objeto JSON que contiene un atributo <code>_id</code> con el mismo identificador mostrado anteriormente, además de los que le añadimos al insertar la persona:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;6316fc938cc2bc168bfed066&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Aitor Medrano&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="nx">edad</span><span class="o">:</span><span class="w"> </span><span class="mf">45</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span><span class="nx">profesion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Profesor&#39;</span><span class="w"></span>
<span class="linenos" data-linenos="6 "></span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Como podemos observar, todas las instrucciones van a seguir el patrón de <code>db.nombreColeccion.operacion()</code>.</p>
<h3 id="trabajando-con-el-shell">Trabajando con el shell<a class="headerlink" href="#trabajando-con-el-shell" title="Permanent link">&para;</a></h3>
<p>Antes de entrar en detalles en las instrucciones necesarias para realizar las operaciones CRUD, veamos algunos comandos que nos serán muy útiles al interactuar con el shell:</p>
<table>
<thead>
<tr>
<th>Comando</th>
<th>Función</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>show dbs</code></td>
<td>Muestra el nombre de las bases de datos</td>
</tr>
<tr>
<td><code>show collections</code></td>
<td>Muestra el nombre de las colecciones</td>
</tr>
<tr>
<td><code>db</code></td>
<td>Muestra el nombre de la base de datos que estamos utilizando</td>
</tr>
<tr>
<td><code>db.dropDatabase()</code></td>
<td>Elimina la base de datos actual</td>
</tr>
<tr>
<td><code>db.help()</code></td>
<td>Muestra los comandos disponibles</td>
</tr>
<tr>
<td><code>db.version()</code></td>
<td>Muestra la versión actual del servidor</td>
</tr>
</tbody>
</table>
<p>En el resto de la sesión vamos a hacer un uso intenso del shell de MongoDB. Por ejemplo, si nos basamos en el objeto definido en el apartado de BSON, podemos ejecutar las siguientes instrucciones:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span><span class="nx">yo</span><span class="p">)</span><span class="w">  </span><span class="c1">// (1)</span><span class="w"></span>
</span><span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nx">acknowledged</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nx">insertedId</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;631704a042aae0893122f2d6&quot;</span><span class="p">)</span><span class="w"></span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="hll"><span class="linenos" data-linenos=" 6 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span><span class="w">  </span><span class="c1">// (2)</span><span class="w"></span>
</span><span class="linenos" data-linenos=" 7 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">      </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;6316fc938cc2bc168bfed066&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="10 "></span><span class="w">      </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Aitor Medrano&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="nx">edad</span><span class="o">:</span><span class="w"> </span><span class="mf">45</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="12 "></span><span class="w">      </span><span class="nx">profesion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Profesor&#39;</span><span class="w"></span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos="15 "></span><span class="w">      </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;631704a042aae0893122f2d6&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="16 "></span><span class="w">      </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Aitor&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="17 "></span><span class="w">      </span><span class="nx">apellidos</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Medrano&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="18 "></span><span class="w">      </span><span class="nx">fnac</span><span class="o">:</span><span class="w"> </span><span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;1977-10-03T00:00:00.000Z&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="19 "></span><span class="w">      </span><span class="nx">hobbies</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;programación&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;videojuegos&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;baloncesto&#39;</span><span class="w"> </span><span class="p">],</span><span class="w"></span>
<span class="linenos" data-linenos="20 "></span><span class="w">      </span><span class="nx">casado</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="21 "></span><span class="w">      </span><span class="nx">hijos</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="22 "></span><span class="w">      </span><span class="nx">contacto</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">twitter</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;@aitormedrano&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;a.medrano@edu.gva.es&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="23 "></span><span class="w">      </span><span class="nx">fechaCreacion</span><span class="o">:</span><span class="w"> </span><span class="nx">Timestamp</span><span class="p">({</span><span class="w"> </span><span class="nx">t</span><span class="o">:</span><span class="w"> </span><span class="mf">1662452896</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="linenos" data-linenos="24 "></span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos" data-linenos="25 "></span><span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="hll"><span class="linenos" data-linenos="26 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">yo</span><span class="p">.</span><span class="nx">profesion</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Profesor&quot;</span><span class="w"></span>
</span><span class="linenos" data-linenos="27 "></span><span class="o">&lt;</span><span class="w"> </span><span class="nx">Profesor</span><span class="w"></span>
<span class="hll"><span class="linenos" data-linenos="28 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">(</span><span class="nx">yo</span><span class="p">)</span><span class="w">   </span><span class="c1">// (3)</span><span class="w"></span>
</span><span class="linenos" data-linenos="29 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="linenos" data-linenos="30 "></span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos="31 "></span><span class="w">      </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;6316fc938cc2bc168bfed066&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="32 "></span><span class="w">      </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Aitor Medrano&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="33 "></span><span class="w">      </span><span class="nx">edad</span><span class="o">:</span><span class="w"> </span><span class="mf">45</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="34 "></span><span class="w">      </span><span class="nx">profesion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Profesor&#39;</span><span class="w"></span>
<span class="linenos" data-linenos="35 "></span><span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="36 "></span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos="37 "></span><span class="w">      </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;631704a042aae0893122f2d6&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="38 "></span><span class="w">      </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Aitor&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="39 "></span><span class="w">      </span><span class="nx">apellidos</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Medrano&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="40 "></span><span class="w">      </span><span class="nx">fnac</span><span class="o">:</span><span class="w"> </span><span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;1977-10-03T00:00:00.000Z&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="41 "></span><span class="w">      </span><span class="nx">hobbies</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;programación&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;videojuegos&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;baloncesto&#39;</span><span class="w"> </span><span class="p">],</span><span class="w"></span>
<span class="linenos" data-linenos="42 "></span><span class="w">      </span><span class="nx">casado</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="43 "></span><span class="w">      </span><span class="nx">hijos</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="44 "></span><span class="w">      </span><span class="nx">contacto</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">twitter</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;@aitormedrano&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;a.medrano@edu.gva.es&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="45 "></span><span class="w">      </span><span class="nx">fechaCreacion</span><span class="o">:</span><span class="w"> </span><span class="nx">Timestamp</span><span class="p">({</span><span class="w"> </span><span class="nx">t</span><span class="o">:</span><span class="w"> </span><span class="mf">1662452896</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="linenos" data-linenos="46 "></span><span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="47 "></span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos="48 "></span><span class="w">      </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;6317056d42aae0893122f2d7&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="49 "></span><span class="w">      </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Aitor&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="50 "></span><span class="w">      </span><span class="nx">apellidos</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Medrano&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="51 "></span><span class="w">      </span><span class="nx">fnac</span><span class="o">:</span><span class="w"> </span><span class="nx">ISODate</span><span class="p">(</span><span class="s2">&quot;1977-10-03T00:00:00.000Z&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="52 "></span><span class="w">      </span><span class="nx">hobbies</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;programación&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;videojuegos&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;baloncesto&#39;</span><span class="w"> </span><span class="p">],</span><span class="w"></span>
<span class="linenos" data-linenos="53 "></span><span class="w">      </span><span class="nx">casado</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="54 "></span><span class="w">      </span><span class="nx">hijos</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="55 "></span><span class="w">      </span><span class="nx">contacto</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">twitter</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;@aitormedrano&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;a.medrano@edu.gva.es&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="56 "></span><span class="w">      </span><span class="nx">fechaCreacion</span><span class="o">:</span><span class="w"> </span><span class="nx">Timestamp</span><span class="p">({</span><span class="w"> </span><span class="nx">t</span><span class="o">:</span><span class="w"> </span><span class="mf">1662453101</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="p">}),</span><span class="w"></span>
<span class="linenos" data-linenos="57 "></span><span class="w">      </span><span class="nx">profesion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Profesor&#39;</span><span class="w"></span>
<span class="linenos" data-linenos="58 "></span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos" data-linenos="59 "></span><span class="w">  </span><span class="p">]</span><span class="w"></span>
<span class="hll"><span class="linenos" data-linenos="60 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">countDocuments</span><span class="p">()</span><span class="w">    </span><span class="c1">// (4)</span><span class="w"></span>
</span><span class="linenos" data-linenos="61 "></span><span class="o">&lt;</span><span class="w"> </span><span class="mf">3</span><span class="w"></span>
</code></pre></div>
<ol>
<li>Si queremos insertar un documento en una colección, hemos de utilizar el método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.insertOne/"><code>insertOne</code></a> pasándole como parámetro el documento que queremos insertar, ya sea a partir de una variable o el propio documento en sí.</li>
<li><a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.find/"><code>find</code></a> recupera todos los documentos de la colección</li>
<li>Modificamos nuestro documento y los volvemos a insertar. Realmente va a crear un nuevo documento, y no se va a quejar de que ya exista, porque nuestro documento no contiene ningún atributo identificador, por lo que considera que se trata de una nueva persona.</li>
<li>Obtenemos la cantidad de documentos de la colección mediante <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.countDocuments/"><code>countDocuments</code></a>.</li>
</ol>
<p>Con este ejemplo, hemos podido observar como los documentos de una misma colección no tienen por qué tener el mismo esquema, ni hemos necesitado definirlo explícitamente antes de insertar datos. Así pues, el esquema se irá generando y actualizando conforme se inserten documentos. Más adelante veremos que podemos definir un esquema para validar que los datos que insertamos cumplan restricciones de tipos de datos o elementos que obligatoriamente deben estar rellenados.</p>
<h3 id="empleando-javascript">Empleando JavaScript<a class="headerlink" href="#empleando-javascript" title="Permanent link">&para;</a></h3>
<p>Ya hemos comentado que el <em>shell</em> utiliza <em>JavaScript</em> como lenguaje de interacción, por lo que podemos almacenar los comandos en un script externo y ejecutarlo mediante <code>load()</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;scripts/misDatos.js&quot;</span><span class="p">);</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="nx">load</span><span class="p">(</span><span class="s2">&quot;/data/db/scripts/misDatos.js&quot;</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>Si hacemos una referencia relativa, lo hace respecto a la ruta desde la cual se ejecuta el shell <code>mongosh</code>.</p>
<p>Otra manera de lanzar un <em>script</em> es hacerlo desde la línea de comandos, pasándole como segundo parámetro el script a ejecutar:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>mongosh iabd misDatos.js
</code></pre></div>
<p>Si el código a ejecutar no necesita almacenarse en un script externo, el propio shell permite introducir instrucciones en varias líneas:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="mf">10</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><span class="hll"><span class="linenos" data-linenos=" 2 "></span><span class="p">...</span><span class="w">     </span><span class="nx">db</span><span class="p">.</span><span class="nx">espias</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="s2">&quot;nombre&quot;</span><span class="o">:</span><span class="s2">&quot;James Bond &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;agente&quot;</span><span class="o">:</span><span class="s2">&quot;00&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">i</span><span class="p">});</span><span class="w"></span>
</span><span class="hll"><span class="linenos" data-linenos=" 3 "></span><span class="p">...</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</span><span class="linenos" data-linenos=" 4 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="nx">acknowledged</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span><span class="nx">insertedId</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;63171d2142aae0893122f2e1&quot;</span><span class="p">)</span><span class="w"></span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="hll"><span class="linenos" data-linenos=" 8 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">espias</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span><span class="w"></span>
</span><span class="linenos" data-linenos=" 9 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos="11 "></span><span class="w">      </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;63171d2142aae0893122f2d8&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="12 "></span><span class="w">      </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;James Bond 0&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="13 "></span><span class="w">      </span><span class="nx">agente</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;000&#39;</span><span class="w"></span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="15 "></span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos="16 "></span><span class="w">      </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;63171d2142aae0893122f2d9&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="17 "></span><span class="w">      </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;James Bond 1&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="18 "></span><span class="w">      </span><span class="nx">agente</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;001&#39;</span><span class="w"></span>
<span class="linenos" data-linenos="19 "></span><span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="20 "></span><span class="w">    </span><span class="p">...</span><span class="w"></span>
<span class="linenos" data-linenos="21 "></span><span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos="22 "></span><span class="w">      </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;63171d2142aae0893122f2e1&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="23 "></span><span class="w">      </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;James Bond 9&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="24 "></span><span class="w">      </span><span class="nx">agente</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;009&#39;</span><span class="w"></span>
<span class="linenos" data-linenos="25 "></span><span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="linenos" data-linenos="26 "></span><span class="w">  </span><span class="p">]</span><span class="w"></span>
</code></pre></div>
<h2 id="objectid">ObjectId<a class="headerlink" href="#objectid" title="Permanent link">&para;</a></h2>
<p>En <em>MongoDB</em>, el atributo <code>_id</code> es único dentro de la colección, y hace la función de clave primaria. Se le asocia un <a href="https://www.mongodb.com/docs/manual/reference/method/ObjectId/"><code>ObjectId</code></a>, el cual es un tipo BSON de 12 bytes que se crea mediante:</p>
<ul>
<li>el <em>timestamp</em> actual (4 bytes)</li>
<li>un valor aleatorio y único por máquina y proceso (5 bytes)</li>
<li>un contador inicializado a número aleatorio (3 bytes).</li>
</ul>
<p>Este objeto lo crea el driver y no <em>MongoDB</em>, por lo cual no deberemos considerar que siguen un orden concreto, ya que clientes diferentes pueden tener <em>timestamps</em> desincronizados. Lo que sí que podemos obtener a partir del <code>ObjectId</code> es la fecha de creación del documento, mediante el método <code>getTimestamp()</code> del atributo <code>_id</code>.</p>
<p>Obteniendo la fecha de creación de un documento</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span>&gt; db.people.findOne<span class="o">()</span>._id
</span><span class="linenos" data-linenos="2 "></span>&lt; ObjectId<span class="o">(</span><span class="s2">&quot;6316fc938cc2bc168bfed066&quot;</span><span class="o">)</span>
<span class="hll"><span class="linenos" data-linenos="3 "></span>&gt; db.people.findOne<span class="o">()</span>._id.getTimestamp<span class="o">()</span>
</span><span class="linenos" data-linenos="4 "></span>&lt; ISODate<span class="o">(</span><span class="s2">&quot;2022-09-06T07:53:55.000Z&quot;</span><span class="o">)</span>
</code></pre></div>
<p>Este identificador es global, único e inmutable. Esto es, no habrá dos repetidos y una vez un documento tiene un <code>_id</code>, éste no se puede modificar.</p>
<p>Si en la definición del objeto a insertar no ponemos el atributo identificador, MongoDB creará uno de manera automática. Si lo ponemos nosotros de manera explícita, <em>MongoDB</em> no añadirá ningún <code>ObjectId</code>. Eso sí, debemos asegurarnos que sea único (podemos usar números, cadenas, etc…​).</p>
<p>Por lo tanto, podemos asignar un identificador al insertar:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">insert</span><span class="p">({</span><span class="nx">_id</span><span class="o">:</span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="nx">nombre</span><span class="o">:</span><span class="s2">&quot;Marina&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">edad</span><span class="o">:</span><span class="mf">14</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</span><span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">acknowledged</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">insertedIds</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="admonition caution">
<p class="admonition-title">Tipos de datos</p>
<p>Cuidado con los tipos, ya que no es lo mismo insertar un atributo con <code>edad:14</code> (se considera el campo como entero) que con <code>edad:"14"</code>, ya que considera el campo como texto.</p>
</div>
<p>O también, si queremos podemos hacer que el <code>_id</code> de un documento sea un documento en sí, y no un entero, para ello, al insertarlo, podemos asignarle un objeto JSON al atributo identificador:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="nx">_id</span><span class="o">:</span><span class="p">{</span><span class="nx">nombre</span><span class="o">:</span><span class="s1">&#39;Aitor&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">apellidos</span><span class="o">:</span><span class="s1">&#39;Medrano&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">twitter</span><span class="o">:</span><span class="s1">&#39;@aitormedrano&#39;</span><span class="p">},</span><span class="w"> </span><span class="nx">ciudad</span><span class="o">:</span><span class="s1">&#39;Elx&#39;</span><span class="p">})</span><span class="w"></span>
</span><span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="nx">acknowledged</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="nx">insertedId</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Aitor&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">apellidos</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Medrano&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">twitter</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;@aitormedrano&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="linenos" data-linenos="5 "></span><span class="w">  </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h2 id="recuperando-datos">Recuperando datos<a class="headerlink" href="#recuperando-datos" title="Permanent link">&para;</a></h2>
<p>Para recuperar los datos de una colección o un documento en concreto usaremos el método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.find/"><code>find()</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">find</span><span class="p">()</span><span class="w"></span>
</span><span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;6316fc1597eb703de2add36e&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">    </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Aitor&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">    </span><span class="nx">edad</span><span class="o">:</span><span class="w"> </span><span class="mf">45</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="nx">profesion</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Profesor&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;6317048697eb703de2add36f&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Aitor&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="nx">apellidos</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Medrano&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="nx">fnac</span><span class="o">:</span><span class="w"> </span><span class="mf">1977</span><span class="o">-</span><span class="mf">10</span><span class="o">-</span><span class="mo">02</span><span class="nx">T23</span><span class="o">:</span><span class="mo">00</span><span class="o">:</span><span class="mo">00</span><span class="mf">.000</span><span class="nx">Z</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="nx">hobbies</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;programación&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;videojuegos&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;baloncesto&#39;</span><span class="w"> </span><span class="p">],</span><span class="w"></span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="nx">casado</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="12 "></span><span class="w">    </span><span class="nx">hijos</span><span class="o">:</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="nx">contacto</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">twitter</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;@aitormedrano&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;a.medrano@edu.gva.es&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="nx">fechaCreacion</span><span class="o">:</span><span class="w"> </span><span class="nx">Timestamp</span><span class="p">({</span><span class="w"> </span><span class="nx">t</span><span class="o">:</span><span class="w"> </span><span class="mf">1662452870</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="o">:</span><span class="w"> </span><span class="mf">3</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>El método <code>find()</code> sobre una colección devuelve un cursor a los datos obtenidos, el cual se queda abierto con el servidor y que se cierra automáticamente a los 30 minutos de inactividad o al finalizar su recorrido. Si hay muchos resultados, la consola nos mostrará un subconjunto de los datos (20). Si queremos seguir obteniendo resultados, solo tenemos que introducir <code>it</code>, para que continúe iterando el cursor.</p>
<p>En cambio, si sólo queremos recuperar un documento hemos de utilizar <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.findOne/"><code>findOne()</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span><span class="err">&gt;</span><span class="w"> </span><span class="err">db.people.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">dO</span><span class="kc">ne</span><span class="err">()</span><span class="w"></span>
</span><span class="linenos" data-linenos="2 "></span><span class="err">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;6316fc1597eb703de2add36e&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="kc">n</span><span class="err">ombre</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Ai</span><span class="kc">t</span><span class="err">or&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="err">edad</span><span class="p">:</span><span class="w"> </span><span class="mi">45</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span><span class="err">pro</span><span class="kc">fes</span><span class="err">io</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Pro</span><span class="kc">fes</span><span class="err">or&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Preparando los ejemplos</p>
<p>Para los siguientes ejemplos, vamos a utilizar una colección de 10.000 documentos sobre los viajes realizados por los usuarios de una empresa de alquiler de bicicletas, los cuales han sido extraídos de <a href="https://ride.citibikenyc.com/system-data">https://ride.citibikenyc.com/system-data</a>.</p>
<p>Esta colección (<code>trips</code>) está cargada tanto en el cluster de MongoAtlas como en el contenedor de Docker (si has seguido las instrucciones) de la base de datos <code>sample_training</code>.</p>
<p>Un ejemplo de viaje sería:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="nx">sample_training</span><span class="w"></span>
</span><span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="s1">&#39;switched to db sample_training&#39;</span><span class="w"></span>
<span class="hll"><span class="linenos" data-linenos=" 3 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">findOne</span><span class="p">()</span><span class="w"></span>
</span><span class="linenos" data-linenos=" 4 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;572bb8222b288919b68abf5b&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">    </span><span class="nx">tripduration</span><span class="o">:</span><span class="w"> </span><span class="mf">889</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">    </span><span class="s1">&#39;start station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">268</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">    </span><span class="s1">&#39;start station name&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Howard St &amp; Centre St&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">    </span><span class="s1">&#39;end station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">3002</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">    </span><span class="s1">&#39;end station name&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;South End Ave &amp; Liberty St&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="nx">bikeid</span><span class="o">:</span><span class="w"> </span><span class="mf">22794</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="nx">usertype</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Subscriber&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="12 "></span><span class="w">    </span><span class="s1">&#39;birth year&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">1961</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="s1">&#39;start station location&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Point&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="o">-</span><span class="mf">73.99973337</span><span class="p">,</span><span class="w"> </span><span class="mf">40.71910537</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="s1">&#39;end station location&#39;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Point&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">coordinates</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="o">-</span><span class="mf">74.015756</span><span class="p">,</span><span class="w"> </span><span class="mf">40.711512</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="15 "></span><span class="w">    </span><span class="s1">&#39;start time&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">2016</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">01</span><span class="nx">T00</span><span class="o">:</span><span class="mo">01</span><span class="o">:</span><span class="mo">06</span><span class="mf">.000</span><span class="nx">Z</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="16 "></span><span class="w">    </span><span class="s1">&#39;stop time&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">2016</span><span class="o">-</span><span class="mo">01</span><span class="o">-</span><span class="mo">01</span><span class="nx">T00</span><span class="o">:</span><span class="mf">15</span><span class="o">:</span><span class="mf">56.000</span><span class="nx">Z</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
<h3 id="criterios-en-consultas">Criterios en consultas<a class="headerlink" href="#criterios-en-consultas" title="Permanent link">&para;</a></h3>
<p>Al hacer una consulta, si queremos obtener datos mediante más de un criterio, en el primer parámetro del <code>find</code> podemos pasar un objeto JSON con los campos a cumplir (condición Y).</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Consulta</label><label for="__tabbed_1_2">Resultado</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s1">&#39;start station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">405</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;end station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">146</span><span class="p">})</span><span class="w"></span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span><span class="w"> </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;572bb8222b288919b68ad197&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="kc">tr</span><span class="err">ipdura</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="mi">1143</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="err">&#39;s</span><span class="kc">tart</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">id&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">405</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="err">&#39;s</span><span class="kc">tart</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="kc">na</span><span class="err">me&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Washi</span><span class="kc">n</span><span class="err">g</span><span class="kc">t</span><span class="err">o</span><span class="kc">n</span><span class="w"> </span><span class="err">S</span><span class="kc">t</span><span class="w"> </span><span class="err">&amp;</span><span class="w"> </span><span class="err">Ga</span><span class="kc">nse</span><span class="err">voor</span><span class="kc">t</span><span class="w"> </span><span class="err">S</span><span class="kc">t</span><span class="err">&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="err">&#39;e</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">id&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">146</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="err">&#39;e</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="kc">na</span><span class="err">me&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Hudso</span><span class="kc">n</span><span class="w"> </span><span class="err">S</span><span class="kc">t</span><span class="w"> </span><span class="err">&amp;</span><span class="w"> </span><span class="err">Reade</span><span class="w"> </span><span class="err">S</span><span class="kc">t</span><span class="err">&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="err">bikeid</span><span class="p">:</span><span class="w"> </span><span class="mi">23724</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="err">user</span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Cus</span><span class="kc">t</span><span class="err">omer&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="err">&#39;bir</span><span class="kc">t</span><span class="err">h</span><span class="w"> </span><span class="err">year&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="10 "></span><span class="w">  </span><span class="err">&#39;s</span><span class="kc">tart</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">loca</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Poi</span><span class="kc">nt</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">coordi</span><span class="kc">nates</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">-74.008119</span><span class="p">,</span><span class="w"> </span><span class="mf">40.739323</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="11 "></span><span class="w">  </span><span class="err">&#39;e</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">loca</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Poi</span><span class="kc">nt</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">coordi</span><span class="kc">nates</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">-74.0091059</span><span class="p">,</span><span class="w"> </span><span class="mf">40.71625008</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="12 "></span><span class="w">  </span><span class="err">&#39;s</span><span class="kc">tart</span><span class="w"> </span><span class="kc">t</span><span class="err">ime&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">2016-01-01</span><span class="err">T</span><span class="mi">13</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mf">45.000</span><span class="err">Z</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="13 "></span><span class="w">  </span><span class="err">&#39;s</span><span class="kc">t</span><span class="err">op</span><span class="w"> </span><span class="kc">t</span><span class="err">ime&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">2016-01-01</span><span class="err">T</span><span class="mi">13</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">48.000</span><span class="err">Z</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="linenos" data-linenos="14 "></span><span class="p">{</span><span class="w"> </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;572bb8222b288919b68ad191&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="15 "></span><span class="w">  </span><span class="kc">tr</span><span class="err">ipdura</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="mi">1143</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="16 "></span><span class="w">  </span><span class="err">&#39;s</span><span class="kc">tart</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">id&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">405</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="17 "></span><span class="w">  </span><span class="err">&#39;s</span><span class="kc">tart</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="kc">na</span><span class="err">me&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Washi</span><span class="kc">n</span><span class="err">g</span><span class="kc">t</span><span class="err">o</span><span class="kc">n</span><span class="w"> </span><span class="err">S</span><span class="kc">t</span><span class="w"> </span><span class="err">&amp;</span><span class="w"> </span><span class="err">Ga</span><span class="kc">nse</span><span class="err">voor</span><span class="kc">t</span><span class="w"> </span><span class="err">S</span><span class="kc">t</span><span class="err">&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="18 "></span><span class="w">  </span><span class="err">&#39;e</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">id&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">146</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="19 "></span><span class="w">  </span><span class="err">&#39;e</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="kc">na</span><span class="err">me&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Hudso</span><span class="kc">n</span><span class="w"> </span><span class="err">S</span><span class="kc">t</span><span class="w"> </span><span class="err">&amp;</span><span class="w"> </span><span class="err">Reade</span><span class="w"> </span><span class="err">S</span><span class="kc">t</span><span class="err">&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="20 "></span><span class="w">  </span><span class="err">bikeid</span><span class="p">:</span><span class="w"> </span><span class="mi">17075</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="21 "></span><span class="w">  </span><span class="err">user</span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Cus</span><span class="kc">t</span><span class="err">omer&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="22 "></span><span class="w">  </span><span class="err">&#39;bir</span><span class="kc">t</span><span class="err">h</span><span class="w"> </span><span class="err">year&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="23 "></span><span class="w">  </span><span class="err">&#39;s</span><span class="kc">tart</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">loca</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Poi</span><span class="kc">nt</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">coordi</span><span class="kc">nates</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">-74.008119</span><span class="p">,</span><span class="w"> </span><span class="mf">40.739323</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="24 "></span><span class="w">  </span><span class="err">&#39;e</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">loca</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kc">t</span><span class="err">ype</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Poi</span><span class="kc">nt</span><span class="err">&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">coordi</span><span class="kc">nates</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">-74.0091059</span><span class="p">,</span><span class="w"> </span><span class="mf">40.71625008</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="25 "></span><span class="w">  </span><span class="err">&#39;s</span><span class="kc">tart</span><span class="w"> </span><span class="kc">t</span><span class="err">ime&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">2016-01-01</span><span class="err">T</span><span class="mi">13</span><span class="p">:</span><span class="mi">37</span><span class="p">:</span><span class="mf">38.000</span><span class="err">Z</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="26 "></span><span class="err">&#39;s</span><span class="kc">t</span><span class="err">op</span><span class="w"> </span><span class="kc">t</span><span class="err">ime&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">2016-01-01</span><span class="err">T</span><span class="mi">13</span><span class="p">:</span><span class="mi">56</span><span class="p">:</span><span class="mf">42.000</span><span class="err">Z</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Consejo de Rendimiento</p>
<p>Las consultas disyuntivas, es decir, con varios criterios u operador <code>$and</code>, deben filtrar el conjunto más pequeño cuanto más pronto posible.</p>
<p>Supongamos que vamos a consultar documentos que cumplen los criterios A, B y C. Digamos que el criterio A lo cumplen 40.000 documentos, el B lo hacen 9.000 y el C sólo 200. Si filtramos A, luego B, y finalmente C, el conjunto que trabaja cada criterio es muy grande.</p>
<p><figure style="align: center;">
    <img src="images/02andABC.jpg">
    <figcaption>Restringiendo consultas AND</figcaption>
</figure></p>
<p>En cambio, si hacemos una consulta que primero empiece por el criterio más restrictivo, el resultado con lo que se intersecciona el siguiente criterio es menor, y por tanto, se realizará más rápido.</p>
<p><figure style="align: center;">
    <img src="images/02andCBA.jpg">
    <figcaption>Restringiendo consultas AND de menor a mayor</figcaption>
</figure></p>
</div>
<p>MongoDB también ofrece operadores lógicos para los campos numéricos:</p>
<table>
<thead>
<tr>
<th>Comparador</th>
<th>Operador</th>
</tr>
</thead>
<tbody>
<tr>
<td>menor que (<code>&lt;</code>)</td>
<td><a href="https://www.mongodb.com/docs/manual/reference/operator/query/lt/"><code>$lt</code></a></td>
</tr>
<tr>
<td>menor o igual que (<code>≤</code>)</td>
<td><a href="https://www.mongodb.com/docs/manual/reference/operator/query/lte/"><code>$lte</code></a></td>
</tr>
<tr>
<td>mayor que (<code>&gt;</code>)</td>
<td><a href="https://www.mongodb.com/docs/manual/reference/operator/query/gt/"><code>$gt</code></a></td>
</tr>
<tr>
<td>mayor o igual que (<code>≥</code>)</td>
<td><a href="https://www.mongodb.com/docs/manual/reference/operator/query/gte/"><code>$gte</code></a></td>
</tr>
</tbody>
</table>
<p>Estos operadores se pueden utilizar de forma simultánea sobre un mismo campo o sobre diferentes campos, sobre campos anidados o que forman parte de un array, y se colocan como un nuevo documento en el valor del campo a filtrar, compuesto del operador y del valor a comparar mediante la siguiente sintaxis:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">coleccion</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">campo</span><span class="o">&gt;:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">operador</span><span class="o">&gt;:</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">valor</span><span class="o">&gt;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Por ejemplo, para recuperar los viajes que han durado menos de 5 minutos o comprendidos entre 3 y 5 minutos (el campo almacena el tiempo en segundos), podemos hacer:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;tripduration&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$lt</span><span class="o">:</span><span class="mf">300</span><span class="p">}</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;tripduration&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$gt</span><span class="o">:</span><span class="mf">180</span><span class="p">,</span><span class="w"> </span><span class="nx">$lte</span><span class="o">:</span><span class="mf">300</span><span class="p">}</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Para los campos de texto, además de la comparación directa, podemos usar el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/query/ne/"><code>$ne</code></a> para obtener los documentos cuyo campos no tienen un determinado valor (<em>not equal</em>). Así pues, podemos usarlo para averiguar todos los trayectos realizados por usuarios que no son subscriptores (<code>Subscriber</code>):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;usertype&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$ne</span><span class="o">:</span><span class="s2">&quot;Subscriber&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Por supuesto, podemos tener diferentes operadores en campos distintos. Por ejemplo, si queremos ver los viajes de menos de un minuto y medio realizado por usuarios que no son subscriptores haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;tripduration&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$lt</span><span class="o">:</span><span class="mf">90</span><span class="p">},</span><span class="w"> </span><span class="s2">&quot;usertype&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$ne</span><span class="o">:</span><span class="s2">&quot;Subscriber&quot;</span><span class="p">}</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Case sensitive</p>
<p>Las comparaciones de cadenas se realizan siguiendo el orden UTF8, similar a ASCII, con lo cual no es lo mismo buscar un rango entre mayúsculas que minúsculas.</p>
</div>
<p>Con cierto parecido a la condición de valor no nulo de las BBDD relacionales y teniendo en cuenta que la libertad de esquema puede provocar que un documento tenga unos campos determinados y otro no lo tenga, podemos utilizar el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/query/exists/"><code>$exists</code></a> si queremos averiguar si un campo existe (y por tanto tiene algún valor).</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;edad&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">$exists</span><span class="o">:</span><span class="kc">true</span><span class="p">}})</span><span class="w"></span>
</code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Polimorfismo</p>
<p>Mucho cuidado al usar polimorfismo y almacenar en un mismo campo un entero y una cadena, ya que al hacer comparaciones para recuperar datos, no vamos a poder mezclar cadenas con valores numéricos. Se considera un antipatrón el mezclar tipos de datos en un campo.</p>
</div>
<p>Pese a que ciertos operadores contengan su correspondiente operador negado, <em>MongoDB</em> ofrece el operador <code>$not</code>. Éste puede utilizarse conjuntamente con otros operadores para negar el resultado de los documentos obtenidos.</p>
<p>Por ejemplo, si queremos obtener todas las personas cuya edad no sea múltiplo de 5, podríamos hacerlo así:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">edad</span><span class="o">:</span><span class="p">{</span><span class="nx">$not</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$mod</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">5</span><span class="p">,</span><span class="mf">0</span><span class="p">]}}})</span><span class="w"></span>
</code></pre></div>
<h4 id="expresiones-regulares">Expresiones regulares<a class="headerlink" href="#expresiones-regulares" title="Permanent link">&para;</a></h4>
<p>Finalmente, si queremos realizar consultas sobre partes de un campo de texto, hemos de emplear expresiones regulares. Para ello, tenemos el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/query/regex/"><code>$regexp</code></a> o, de manera más sencilla, indicando como valor la expresión regular a cumplir:</p>
<p>Por ejemplo, para buscar la cantidad de viajes que salen da alguna estación cuyo nombre contenga <code>Central Park</code> podemos hacer:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;start station name&quot;</span><span class="o">:</span><span class="sr">/Central Park/</span><span class="p">}).</span><span class="nx">count</span><span class="p">()</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;start station name&quot;</span><span class="o">:</span><span class="sr">/central park/i</span><span class="p">}).</span><span class="nx">count</span><span class="p">()</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;start station name&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">$regex</span><span class="o">:</span><span class="sr">/central park/i</span><span class="p">}}).</span><span class="nx">count</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Búsquedas sobre textos</p>
<p>Si vamos a realizar búsquedas intensivas sobre texto, desde <em>MongoDB</em> han creado un producto específico dentro del ecosistema de <em>Mongo Atlas</em> el cual ofrece un mejor rendimiento y mayor funcionalidad que el uso de expresiones regulares, conocido con <a href="https://www.mongodb.com/es/atlas/search">Mongo Atlas Search</a>.</p>
<p>Si usamos una solución <em>on-premise</em>, mediante índices de texto y el operator <a href="https://www.mongodb.com/docs/manual/reference/operator/query/text/"><code>$text</code></a> podemos realizar búsquedas.</p>
</div>
<h4 id="operador-expr">Operador $expr<a class="headerlink" href="#operador-expr" title="Permanent link">&para;</a></h4>
<p>El operador <a href="https://www.mongodb.com/docs/manual/reference/operator/query/expr/"><code>$expr</code></a> es un operador de consulta expresiva que permite utilizar expresiones de agregación dentro de las consultas.</p>
<p>Permite utilizar variables y sentencias condicionales, asi como comparar campos dentro de un documento. Así pues, si queremos comparar valores entre dos campos, podemos hacerlo mediante <code>$expr</code> referenciando a los campos anteponiendo un dolar (<code>$</code>) delante del campo, de manera que si queremos obtener los viajes que comienzan y finalizan en la misma estación podemos hacer:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;$expr&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;$eq&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">&quot;$end station id&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;$start station id&quot;</span><span class="w"> </span><span class="p">]}})</span><span class="w"></span>
</code></pre></div>
<p>Al poner el <code>$</code> delante de un campo, en vez de referenciar al campo, lo que hace es referenciar a su valor, por lo que <code>$end station id</code> está referenciando al valor del campo <code>end station id</code>.</p>
<div class="admonition info">
<p class="admonition-title">Otros operadores</p>
<p>El operador <a href="https://www.mongodb.com/docs/manual/reference/operator/query/type/"><code>$type</code></a> permite recuperar documentos que dependan del tipo de campo que contiene.</p>
<p>El operador <a href="https://www.mongodb.com/docs/manual/reference/operator/query/where/"><code>$where</code></a> permite introducir una expresión <em>JavaScript</em>.</p>
</div>
<h3 id="proyeccion-de-campos">Proyección de campos<a class="headerlink" href="#proyeccion-de-campos" title="Permanent link">&para;</a></h3>
<p>Las consultas realizadas hasta ahora devuelven los documentos completos. Si queremos que devuelva un campo o varios campos en concreto, hemos de pasar un segundo parámetro de tipo JSON con aquellos campos que deseamos mostrar con el valor <code>true</code> o <code>1</code>. Destacar que si no se indica nada, por defecto siempre mostrará el campo <code>_id</code></p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s1">&#39;start station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">405</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;end station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">146</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">tripduration</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span><span class="w"></span>
</span><span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;572bb8222b288919b68ad191&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="nx">tripduration</span><span class="o">:</span><span class="w"> </span><span class="mf">1143</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Por lo tanto, si queremos que no se muestre el <code>_id</code>, lo podremos a <code>false</code> o <code>0</code>:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span><span class="err">&gt;</span><span class="w"> </span><span class="err">db.</span><span class="kc">tr</span><span class="err">ips.</span><span class="kc">f</span><span class="err">i</span><span class="kc">n</span><span class="err">d(</span><span class="p">{</span><span class="err">&#39;s</span><span class="kc">tart</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">id&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">405</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;e</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">s</span><span class="kc">tat</span><span class="err">io</span><span class="kc">n</span><span class="w"> </span><span class="err">id&#39;</span><span class="p">:</span><span class="w"> </span><span class="mi">146</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="kc">tr</span><span class="err">ipdura</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="err">_id</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span><span class="err">)</span><span class="w"></span>
</span><span class="linenos" data-linenos="2 "></span><span class="err">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kc">tr</span><span class="err">ipdura</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="p">:</span><span class="w"> </span><span class="mi">1143</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">No mezcles</p>
<p>Al hacer una proyección, no podemos mezclar campos que se vean (<code>1</code>) con los que no ( <code>0</code>). Es decir, hemos de hacer algo similar a:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">coleccion</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">consulta</span><span class="o">&gt;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="o">&lt;</span><span class="nx">campo1</span><span class="o">&gt;:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">campo2</span><span class="o">&gt;:</span><span class="w"> </span><span class="mf">1</span><span class="p">})</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="o">&lt;</span><span class="nx">coleccion</span><span class="o">&gt;</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">consulta</span><span class="o">&gt;</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="o">&lt;</span><span class="nx">campo1</span><span class="o">&gt;:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="o">&lt;</span><span class="nx">campo2</span><span class="o">&gt;:</span><span class="w"> </span><span class="mf">0</span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Así pues, sólo se mezclará la visibilidad de los campos cuando queramos ocultar el <code>_id</code>.</p>
</div>
<h3 id="condiciones-compuestas-con-y-o">Condiciones compuestas con Y / O<a class="headerlink" href="#condiciones-compuestas-con-y-o" title="Permanent link">&para;</a></h3>
<p>Para usar la conjunción o la disyunción, tenemos los operadores <a href="https://www.mongodb.com/docs/manual/reference/operator/query/and/"><code>$and</code></a> y <a href="https://www.mongodb.com/docs/manual/reference/operator/query/or/"><code>$or</code></a>. Son operadores prefijo, de modo que se ponen antes de las subconsultas que se van a evaluar. Estos operadores trabajan con arrays, donde cada uno de los elementos es un documento con la condición a evaluar, de modo que se realiza la unión entre estas condiciones, aplicando la lógica asociada a AND y a OR.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="nx">$or</span><span class="o">:</span><span class="p">[{</span><span class="s1">&#39;start station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">405</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;end station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">146</span><span class="p">}]</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="nx">$or</span><span class="o">:</span><span class="p">[{</span><span class="w"> </span><span class="s2">&quot;tripduration&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$lte</span><span class="o">:</span><span class="mf">70</span><span class="p">}},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;tripduration&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$gte</span><span class="o">:</span><span class="mf">3600</span><span class="p">}}]</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Realmente el operador <code>$and</code> no se suele usar porque podemos anidar en la consulta dos criterios, al poner uno dentro del otro. Así pues, estas dos consultas hacen lo mismo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s1">&#39;start station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">405</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;end station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">146</span><span class="p">})</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="nx">$and</span><span class="o">:</span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;start station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">405</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;end station id&#39;</span><span class="o">:</span><span class="w"> </span><span class="mf">146</span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Consejo de Rendimiento</p>
<p>Las consultas conjuntivas, es decir, con varios criterios excluyentes u operador <code>$or</code>, deben filtrar el conjunto más grande cuanto más pronto posible.</p>
<p>Supongamos que vamos a consultar los mismos documentos que cumplen los criterios A (40.000 documentos), B (9.000 documentos) y C (200 documentos).</p>
<p>Si filtramos C, luego B, y finalmente A, el conjunto de documentos que tiene que comprobar MongoDB es muy grande.</p>
<p><figure style="align: center;">
    <img src="images/02orCBA.jpg">
    <figcaption>Restringiendo consultas OR de menor a mayor</figcaption>
</figure></p>
<p>En cambio, si hacemos una consulta que primero empiece por el criterio menos restrictivo, el conjunto de documentos sobre el cual va a tener que comprobar siguientes criterios va a ser menor, y por tanto, se realizará más rápido.</p>
<p><figure style="align: center;">
    <img src="images/02orABC.jpg">
    <figcaption>Restringiendo consultas OR de mayor a menor</figcaption>
</figure></p>
</div>
<p>También podemos utilizar el operado <a href="https://www.mongodb.com/docs/manual/reference/operator/query/nor/"><code>$nor</code></a>, que no es más que la negación de <code>$or</code> y que obtendrá aquellos documentos que no cumplan ninguna de las condiciones.</p>
<div class="admonition question">
<p class="admonition-title">Autoevaluación</p>
<p>Que obtendríamos al ejecutar la siguiente consulta:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;tripduration&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$lte</span><span class="o">:</span><span class="mf">65</span><span class="p">},</span><span class="w"> </span><span class="nx">$nor</span><span class="o">:</span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="nx">usertype</span><span class="o">:</span><span class="s2">&quot;Customer&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s2">&quot;birth year&quot;</span><span class="o">:</span><span class="mf">1989</span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
</div>
<p>Finalmente, si queremos indicar mediante un array los diferentes valores que puede cumplir un campo, podemos utilizar el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/query/in/"><code>$in</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="w"> </span><span class="s2">&quot;birth year&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="mf">1977</span><span class="p">,</span><span class="w"> </span><span class="mf">1980</span><span class="p">]}</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Por supuesto, también existe su negación mediante <a href="https://www.mongodb.com/docs/manual/reference/operator/query/nin/"><code>$nin</code></a>.</p>
<h3 id="condiciones-sobre-objetos-anidados">Condiciones sobre objetos anidados<a class="headerlink" href="#condiciones-sobre-objetos-anidados" title="Permanent link">&para;</a></h3>
<p>Si queremos acceder a campos de subdocumentos, siguiendo la sintaxis de JSON, se utiliza la notación punto. Esta notación permite acceder al campo de un documento anidado, da igual el nivel en el que esté y su orden respecto al resto de campos.</p>
<div class="admonition note">
<p class="admonition-title">Preparando los ejemplos</p>
<p>Para los siguientes ejemplos sobre documentos anidados y arrays, vamos a utilizar una colección de 500 documentos sobre mensajes de un blog.</p>
<p>Esta colección (<code>posts</code>) está cargada tanto en el cluster de MongoAtlas como en el contenedor de Docker (si has seguido las instrucciones) de la base de datos <code>sample_training</code>.</p>
<p>Un ejemplo de mensaje sería:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="nx">sample_training</span><span class="w"></span>
</span><span class="linenos" data-linenos=" 2 "></span><span class="w">  </span><span class="s1">&#39;switched to db sample_training&#39;</span><span class="w"></span>
<span class="hll"><span class="linenos" data-linenos=" 3 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">findOne</span><span class="p">()</span><span class="w"></span>
</span><span class="linenos" data-linenos=" 4 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50ab0f8bbcf1bfe2536dc3f9&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Amendment I\n&lt;p&gt;Congress shall make ....&quot;\n&lt;p&gt;\n&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="nx">permalink</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;aRjNnLZkJkTyspAIoRGe&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;machine&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bill of Rights&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">  </span><span class="nx">tags</span><span class="o">:</span><span class="w"></span>
<span class="linenos" data-linenos="10 "></span><span class="w">    </span><span class="s1">&#39;santa&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="11 "></span><span class="w">    </span><span class="s1">&#39;xylophone&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="12 "></span><span class="w">    </span><span class="s1">&#39;math&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="13 "></span><span class="w">    </span><span class="s1">&#39;dream&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="14 "></span><span class="w">    </span><span class="s1">&#39;action&#39;</span><span class="w"> </span><span class="p">],</span><span class="w"></span>
<span class="linenos" data-linenos="15 "></span><span class="w">  </span><span class="nx">comments</span><span class="o">:</span><span class="w"></span>
<span class="linenos" data-linenos="16 "></span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Lorem ipsum dolor ...&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="17 "></span><span class="w">      </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;HvizfYVx@pKvLaagH.com&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="18 "></span><span class="w">      </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Santiago Dollins&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="19 "></span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Lorem ipsum dolor sit...&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="20 "></span><span class="w">      </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;WpOUCpdD@hccdxJvT.com&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="21 "></span><span class="w">      </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Jaclyn Morado&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="22 "></span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Lorem ipsum dolor sit amet...&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="23 "></span><span class="w">      </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;OgDzHfFN@cWsDtCtx.com&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="24 "></span><span class="w">      </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Houston Valenti&#39;</span><span class="w"> </span><span class="p">}],</span><span class="w"></span>
<span class="linenos" data-linenos="25 "></span><span class="w">  </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="mf">2012</span><span class="o">-</span><span class="mf">11</span><span class="o">-</span><span class="mf">20</span><span class="nx">T05</span><span class="o">:</span><span class="mo">05</span><span class="o">:</span><span class="mf">15.231</span><span class="nx">Z</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
<p>Para acceder al autor de los comentarios de un mensaje usaríamos la propiedad <code>comments.author</code>.</p>
<p>Por ejemplo, para averiguar los mensajes titulados 'Bill of Rights' y que tienen algún comentario creado por <code>Santiago Dollins</code> haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Bill of Rights&#39;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;comments.author&quot;</span><span class="o">:</span><span class="s1">&#39;Santiago Dollins&#39;</span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<h3 id="consultas-sobre-arrays">Consultas sobre arrays<a class="headerlink" href="#consultas-sobre-arrays" title="Permanent link">&para;</a></h3>
<p>Si trabajamos con arrays, vamos a poder consultar el contenido de una posición del mismo tal como si fuera un campo normal, siempre que sea un campo de primer nivel, es decir, no sea un documento embebido dentro de un array.</p>
<p>Si queremos filtrar teniendo en cuenta el número de ocurrencias del array, podemos utilizar:</p>
<ul>
<li><code>$all</code> para filtrar ocurrencias que tienen todos los valores del array, es decir, los valores pasados a la consulta serán un subconjunto del resultado. Puede que devuelva los mismos, o un array con más campos (el orden no importa)</li>
<li><code>$in</code>, igual que SQL, para obtener las ocurrencias que cumple con alguno de los valores pasados (similar a usar <code>$or</code> sobre un conjunto de valores de un mismo campo). Si queremos su negación, usaremos <code>$nin</code>, para obtener los documentos que no cumplen ninguno de los valores.</li>
</ul>
<p>Por ejemplo, si queremos obtener los mensajes que contenga las etiquetas <code>dream</code> y <code>action</code> tendríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$all</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;dream&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;action&quot;</span><span class="p">]}}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>En cambio, si queremos los mensajes que contengan alguna de esas etiquetas haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$in</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;dream&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;action&quot;</span><span class="p">]}}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Si el array contiene documentos y queremos filtrar la consulta sobre los campos de los documentos del array, tenemos que utilizar <a href="https://www.mongodb.com/docs/manual/reference/operator/query/elemMatch/"><code>$elemMatch</code></a>, de manera que obtengamos aquellos que al menos encuentre un elemento que cumpla el criterio. Así pues, si queremos recuperar los mensajes que tienen un comentario cuyo autor sea <code>Santiago Dollins</code> haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="nx">comments</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$elemMatch</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Santiago Dollins&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;xnZKyvWD@jHfVKtUh.com&quot;</span><span class="p">}}}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Criterio con notación punto</p>
<p>En el ejemplo anterior, si sólo hubiéramos tenido un campo para el filtrado, podríamos haber utilizado la notación punto <code>comments.author</code>.</p>
</div>
<p>Si sólo queremos los comentarios escritos por un determinado autor, en vez de en el filtrado, hemos de indicarlo en la proyección:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{},</span><span class="w"> </span><span class="p">{</span><span class="nx">comments</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$elemMatch</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Santiago Dollins&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;xnZKyvWD@jHfVKtUh.com&quot;</span><span class="p">}}}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Si lo que nos interesa es la cantidad de elementos que contiene un array, emplearemos el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/query/size/"><code>$size</code></a>. Por ejemplo, para obtener los mensajes que tienen 10 etiquetas haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="nx">tags</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$size</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">10</span><span class="p">}}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Finalmente, a la hora de proyectar los datos, si no estamos interesados en todos los valores de un campo que es un array, podemos restringir el resultado mediante el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/projection/slice/"><code>$slice</code></a>. Así pues, si quisiéramos obtener las mensajes titulados <code>US Constitution</code> y que de esos mensajes, mostrar sólo tres etiquetas y dos comentarios, haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos=" 1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">posts</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="nx">title</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;US Constitution&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">comments</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$slice</span><span class="o">:</span><span class="mf">2</span><span class="p">},</span><span class="w"> </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$slice</span><span class="o">:</span><span class="mf">3</span><span class="p">}}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</span><span class="linenos" data-linenos=" 2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;50ab0f8bbcf1bfe2536dc416&quot;</span><span class="p">),</span><span class="w"></span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">  </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;We the People ...&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">  </span><span class="nx">permalink</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;NhWDUNColpvxFjovsgqU&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">  </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;machine&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;US Constitution&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">  </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;engineer&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;granddaughter&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sundial&#39;</span><span class="w"> </span><span class="p">],</span><span class="w"></span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">  </span><span class="nx">comments</span><span class="o">:</span><span class="w"> </span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">   </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Lorem ipsum dolor ...&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="10 "></span><span class="w">       </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ftRlVMZN@auLhwhlj.com&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="11 "></span><span class="w">       </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Leonida Lafond&#39;</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="12 "></span><span class="w">     </span><span class="p">{</span><span class="w"> </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Lorem ipsum dolor sit...&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="13 "></span><span class="w">       </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;dsoLAdFS@VGBBuDVs.com&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="14 "></span><span class="w">       </span><span class="nx">author</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Nobuko Linzey&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">],</span><span class="w"></span>
<span class="linenos" data-linenos="15 "></span><span class="w">  </span><span class="nx">date</span><span class="o">:</span><span class="w"> </span><span class="mf">2012</span><span class="o">-</span><span class="mf">11</span><span class="o">-</span><span class="mf">20</span><span class="nx">T05</span><span class="o">:</span><span class="mo">05</span><span class="o">:</span><span class="mf">15.276</span><span class="nx">Z</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="conjunto-de-valores">Conjunto de valores<a class="headerlink" href="#conjunto-de-valores" title="Permanent link">&para;</a></h3>
<p>Igual que en SQL, a partir de un colección, si queremos obtener todos los diferentes valores que existen en un campo, utilizaremos el método distinct</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">distinct</span><span class="p">(</span><span class="s1">&#39;usertype&#39;</span><span class="p">)</span><span class="w"></span>
</span><span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;Customer&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Subscriber&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
</code></pre></div>
<p>Si queremos filtrar los datos sobre los que se obtienen los valores, le pasaremos un segundo parámetro con el criterio a aplicar:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">distinct</span><span class="p">(</span><span class="s1">&#39;usertype&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;birth year&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$gt</span><span class="o">:</span><span class="w"> </span><span class="mf">1990</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</span><span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s1">&#39;Subscriber&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"></span>
</code></pre></div>
<h3 id="cursores">Cursores<a class="headerlink" href="#cursores" title="Permanent link">&para;</a></h3>
<p>Al hacer una consulta en el <em>shell</em>, se devuelve un cursor. Este cursor lo podemos guardar en un variable, y partir de ahí trabajar con él como haríamos mediante cualquier lenguaje de programación. Si <code>cur</code> es la variable que referencia al cursor, podremos utilizar los siguientes métodos:</p>
<table>
<thead>
<tr>
<th>Método</th>
<th>Uso</th>
<th>Lugar de ejecución</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>cur.hasNext()</code></td>
<td><code>true</code>/<code>false</code> para saber si quedan elementos</td>
<td>Cliente</td>
</tr>
<tr>
<td><code>cur.next()</code></td>
<td>Pasa al siguiente documento</td>
<td>Cliente</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.limit/"><code>cur.limit(cantidad)</code></a></td>
<td>Restringe el número de resultados a <code>cantidad</code></td>
<td>Servidor</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.sort/"><code>cur.sort({campo:1})</code></a></td>
<td>Ordena los datos por campo: <code>1</code> ascendente o <code>-1</code> o descendente</td>
<td>Servidor</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/docs/manual/reference/method/cursor.skip/"><code>cur.skip(cantidad)</code></a></td>
<td>Permite saltar <code>cantidad</code> elementos con el cursor</td>
<td>Servidor</td>
</tr>
</tbody>
</table>
<p>La consulta no se ejecuta hasta que el cursor comprueba o pasa al siguiente documento (<code>next</code>/<code>hasNext</code>), por ello que tanto <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.limit/"><code>limit</code></a> como <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.sort/"><code>sort</code></a> (ambos modifican el cursor) sólo se pueden realizar antes de recorrer cualquier elemento del cursor.</p>
<p>Como tras realizar una consulta con <code>find</code>, realmente se devuelve un cursor, un uso muy habitual es encadenar una operación de <code>find</code> con <code>sort</code> y/o <code>limit</code> para ordenar el resultado por uno o más campos y posteriormente limitar el número de documentos a devolver.</p>
<p>Así pues, si quisiéramos obtener los tres viajes que más han durado, podríamos hacerlo así:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;tripduration&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">}).</span><span class="nx">limit</span><span class="p">(</span><span class="mf">3</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>También podemos filtrar previamente a ordenar y limitar:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">usertype</span><span class="o">:</span><span class="s2">&quot;Customer&quot;</span><span class="p">}).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;tripduration&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">}).</span><span class="nx">limit</span><span class="p">(</span><span class="mf">3</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Finalmente, podemos paginar utilizando el método <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.skip/"><code>skip</code></a>, para mostrar viajes de 10 en 10 y a partir de la tercera página, podríamos hacer algo así:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="nx">usertype</span><span class="o">:</span><span class="s2">&quot;Customer&quot;</span><span class="p">}).</span><span class="nx">sort</span><span class="p">({</span><span class="s2">&quot;tripduration&quot;</span><span class="o">:-</span><span class="mf">1</span><span class="p">}).</span><span class="nx">limit</span><span class="p">(</span><span class="mf">10</span><span class="p">).</span><span class="nx">skip</span><span class="p">(</span><span class="mf">20</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<div class="admonition question">
<p class="admonition-title">Autoevaluación</p>
<p>A partir de la colección <code>trips</code>, escribe un consulta que recupere los viajes realizados por subscriptores ordenados descendentemente por su duración y que obtenga los documentos de 15 al 20.</p>
</div>
<h3 id="contando-documentos">Contando Documentos<a class="headerlink" href="#contando-documentos" title="Permanent link">&para;</a></h3>
<p>Para contar el número de documentos, en vez de <code>find</code> usaremos el método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.countDocuments/"><code>countDocuments</code></a>. Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">countDocuments</span><span class="p">({</span><span class="s2">&quot;birth year&quot;</span><span class="o">:</span><span class="mf">1977</span><span class="p">})</span><span class="w"></span>
</span><span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="mf">186</span><span class="w">  </span>
<span class="hll"><span class="linenos" data-linenos="3 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">countDocuments</span><span class="p">({</span><span class="s2">&quot;birth year&quot;</span><span class="o">:</span><span class="mf">1977</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;tripduration&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">$lt</span><span class="o">:</span><span class="mf">600</span><span class="p">}})</span><span class="w"></span>
</span><span class="linenos" data-linenos="4 "></span><span class="o">&lt;</span><span class="w"> </span><span class="mf">116</span><span class="w"></span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">count</p>
<p>Desde la versión 4.0, los métodos <code>count</code> a nivel de colección y de cursor están caducados (<em>deprecated</em>), y no se recomienda su utilización. Aún así, es muy común utilizarlo como método de un cursor:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="s2">&quot;birth year&quot;</span><span class="o">:</span><span class="mf">1977</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;tripduration&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">$lt</span><span class="o">:</span><span class="mf">600</span><span class="p">}}).</span><span class="nx">count</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
</div>
<p>Cuando tenemos muchísimos datos, si no necesitamos exactitud pero queremos un valor estimado el cual tarde menos en conseguirse (utiliza los metadatos de las colecciones), podemos usar <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.estimatedDocumentCount"><code>estimatedDocumentCount</code></a></p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="linenos" data-linenos="1 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">estimatedDocumentCount</span><span class="p">({</span><span class="s2">&quot;birth year&quot;</span><span class="o">:</span><span class="mf">1977</span><span class="p">})</span><span class="w"></span>
</span><span class="linenos" data-linenos="2 "></span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10.000</span><span class="w"></span>
<span class="hll"><span class="linenos" data-linenos="3 "></span><span class="o">&gt;</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">trips</span><span class="p">.</span><span class="nx">estimatedDocumentCount</span><span class="p">({</span><span class="s2">&quot;birth year&quot;</span><span class="o">:</span><span class="mf">1977</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;tripduration&quot;</span><span class="o">:</span><span class="p">{</span><span class="nx">$lt</span><span class="o">:</span><span class="mf">600</span><span class="p">}})</span><span class="w"></span>
</span><span class="linenos" data-linenos="4 "></span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10.000</span><span class="w"> </span>
</code></pre></div>
<h2 id="modificando-documentos">Modificando documentos<a class="headerlink" href="#modificando-documentos" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Preparando un persona</p>
<p>Para este apartado, vamos a insertar dos veces la misma persona sobre la cual realizaremos las modificaciones:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="w"> </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">edad</span><span class="o">:</span><span class="w"> </span><span class="mf">45</span><span class="p">,</span><span class="w"> </span><span class="nx">profesion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Profesor&quot;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="w"> </span><span class="nx">nombre</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">edad</span><span class="o">:</span><span class="w"> </span><span class="mf">45</span><span class="p">,</span><span class="w"> </span><span class="nx">profesion</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Profesor&quot;</span><span class="w"> </span><span class="p">})</span><span class="w"></span>
</code></pre></div>
</div>
<p>Para actualizar (y fusionar datos), se utilizan los métodos <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.updateOne"><code>updateOne</code></a> / <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.updateMany"><code>updateMany</code></a> dependiendo de cuantos documentos queremos que modifique. Ambos métodos requieren 2 parámetros: el primero es la consulta para averiguar sobre qué documentos, y en el segundo parámetro, los campos a modificar utilizando los operadores de actualización:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="nx">nombre</span><span class="o">:</span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">$set</span><span class="o">:</span><span class="p">{</span><span class="nx">nombre</span><span class="o">:</span><span class="s2">&quot;Marina Medrano&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">salario</span><span class="o">:</span><span class="w"> </span><span class="mf">123456</span><span class="p">}})</span><span class="w"></span>
</code></pre></div>
<p>Al realizar la modificación, el shell nos devolverá información sobre cuantos documentos ha encontrado, modificado y más información:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="w"> </span><span class="err">ack</span><span class="kc">n</span><span class="err">owledged</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="err">i</span><span class="kc">nserte</span><span class="err">dId</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="err">ma</span><span class="kc">t</span><span class="err">chedCou</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span><span class="err">modi</span><span class="kc">f</span><span class="err">iedCou</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="5 "></span><span class="w">  </span><span class="err">upser</span><span class="kc">te</span><span class="err">dCou</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Como hay más de una persona con el mismo nombre, al haber utilizado <code>updateOne</code> sólo modificará el primer documento que ha encontrado.</p>
<div class="admonition danger">
<p class="admonition-title">¡Cuidado!</p>
<p>En versiones antiguas de MongoDB, además de utilizar los operadores de actualización, podíamos pasarle como parámetro un documento, de manera que <em>MongoDB</em> realizaba un reemplazo de los campos, es decir, si en el origen había 100 campos y en la operación de modificación sólo poníamos 2, el resultado únicamente contendría 2 campos. Es por ello, que ahora es obligatorio utilizar los operadores.</p>
</div>
<p>Si cuando vamos a actualizar, en el criterio de selección no encuentra el documento sobre el que hacer los cambios, no se realiza ninguna acción.</p>
<p>Si quisiéramos que en el caso de no encontrar nada insertase un nuevo documento, acción conocida como <strong><em>upsert</em></strong> (<em>update + insert</em>), hay que pasarle un tercer parámetro al método con el objeto <code>{upsert:true}</code>. Si encuentra el documento, lo modificará, pero si no, creará uno nuevo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="nx">nombre</span><span class="o">:</span><span class="s2">&quot;Andreu Medrano&quot;</span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">                    </span><span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Andreu Medrano&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">twitter</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;@andreumedrano&quot;</span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">                    </span><span class="p">{</span><span class="nx">upsert</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<h3 id="operadores-de-actualizacion">Operadores de actualización<a class="headerlink" href="#operadores-de-actualizacion" title="Permanent link">&para;</a></h3>
<p>MongoDB ofrece un conjunto de operadores para simplificar la modificación de campos.</p>
<p>El operador más utiilzar es el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/update/set/"><code>$set</code></a>, el cual admite los campos que se van a modificar. Si el campo no existe, lo creará.</p>
<p>Por ejemplo, para modificar el salario haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="err">db.people.upda</span><span class="kc">te</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="kc">n</span><span class="err">ombre</span><span class="p">:</span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="err">$se</span><span class="kc">t</span><span class="p">:{</span><span class="err">salario</span><span class="p">:</span><span class="w"> </span><span class="mi">1000000</span><span class="p">}}</span><span class="err">)</span><span class="w"></span>
</code></pre></div>
<p>Mediante <a href="https://www.mongodb.com/docs/manual/reference/operator/update/inc/"><code>$inc</code></a> podemos incrementar el valor de una variable:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="err">db.people.upda</span><span class="kc">te</span><span class="err">O</span><span class="kc">ne</span><span class="err">(</span><span class="p">{</span><span class="kc">n</span><span class="err">ombre</span><span class="p">:</span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="err">$i</span><span class="kc">n</span><span class="err">c</span><span class="p">:{</span><span class="err">salario</span><span class="p">:</span><span class="w"> </span><span class="mi">1000</span><span class="p">}}</span><span class="err">)</span><span class="w"></span>
</code></pre></div>
<p>Para eliminar un campo de un documento, usaremos el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/update/unset/"><code>$unset</code></a>.</p>
<p>De este modo, para eliminar el campo <em>twitter</em> de una persona haríamos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="nx">nombre</span><span class="o">:</span><span class="s2">&quot;Aitor Medrano&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">$unset</span><span class="o">:</span><span class="p">{</span><span class="nx">twitter</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">}})</span><span class="w"></span>
</code></pre></div>
<p>Otros operadores que podemos utilizar son <a href="https://www.mongodb.com/docs/manual/reference/operator/update/mul/"><code>$mul</code></a>, <a href="https://www.mongodb.com/docs/manual/reference/operator/update/min/"><code>$min</code></a>, <a href="https://www.mongodb.com/docs/manual/reference/operator/update/max/"><code>$max</code></a> y <a href="https://www.mongodb.com/docs/manual/reference/operator/update/currentDate/"><code>$currentDate</code></a>. Podemos consultar todos los operadores disponibles en <a href="https://www.mongodb.com/docs/manual/reference/operator/update/">https://www.mongodb.com/docs/manual/reference/operator/update/</a></p>
<div class="admonition question">
<p class="admonition-title">Autoevaluación</p>
<p>Tras realizar la siguiente operación sobre una colección vacía:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="nx">nombre</span><span class="o">:</span><span class="s1">&#39;yo&#39;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="s1">&#39;$set&#39;</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;hobbies&#39;</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;gaming&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;sofing&#39;</span><span class="p">]}},</span><span class="w"> </span><span class="p">{</span><span class="nx">upsert</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">}</span><span class="w"> </span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p>¿Cuál es el estado de la colección?</p>
</div>
<p>Finalmente, un caso particular de las actualizaciones es la posibilidad de renombrar un campo mediante el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/update/rename"><code>$rename</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="nx">_id</span><span class="o">:</span><span class="mf">1</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">$rename</span><span class="o">:</span><span class="p">{</span><span class="s1">&#39;nickname&#39;</span><span class="o">:</span><span class="s1">&#39;alias&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cell&#39;</span><span class="o">:</span><span class="s1">&#39;movil&#39;</span><span class="p">}})</span><span class="w"></span>
</code></pre></div>
<p>Podemos consultar todas las opciones de configuración de una actualización en <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.update/">https://www.mongodb.com/docs/manual/reference/method/db.collection.update/</a>.</p>
<h3 id="control-de-la-concurrencia">Control de la concurrencia<a class="headerlink" href="#control-de-la-concurrencia" title="Permanent link">&para;</a></h3>
<p>Cuando se hace una actualización múltiple, <em>MongoDB</em> no realiza la operación de manera atómica (a no ser que utilicemos <a href="https://www.mongodb.com/docs/manual/core/transactions/">transacciones</a> desde el driver), lo que provoca que se puedan producir pausas (<em>pause yielding</em>). Cada documento en sí es atómico, por lo que ninguno se va a quedar a la mitad.</p>
<p>MongoDB ofrece el método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.findAndModify/"><code>findAndModify</code></a> para encontrar y modificar un documento de manera atómica, y así evitar que, entre la búsqueda y la modificación, el estado del documento se vea afectado. Además, devuelve el documento modificado. Un caso de uso muy común es para contadores y casos similares.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">findAndModify</span><span class="p">({</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">nombre</span><span class="o">:</span><span class="s2">&quot;Marina Medrano&quot;</span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="nx">update</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">$inc</span><span class="o">:</span><span class="p">{</span><span class="nx">salario</span><span class="o">:</span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="nx">edad</span><span class="o">:-</span><span class="mf">30</span><span class="p">}},</span><span class="w"></span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span><span class="ow">new</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"></span>
<span class="linenos" data-linenos="5 "></span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Por defecto, el documento devuelto será el resultado que ha encontrado con la consulta. Si queremos que nos devuelva el documento modificado con los cambios deseados, necesitamos utilizar el parámetro <code>new</code> a <code>true</code>. Si no lo indicamos o lo ponemos a <code>false</code>, tendremos el comportamiento por defecto.</p>
<h3 id="actualizaciones-sobre-arrays">Actualizaciones sobre Arrays<a class="headerlink" href="#actualizaciones-sobre-arrays" title="Permanent link">&para;</a></h3>
<p>Para trabajar con arrays necesitamos nuevos operadores que nos permitan tanto introducir como eliminar elementos de una manera más sencilla que sustituir todos los elementos del array.</p>
<p>Los operadores que podemos emplear para trabajar con arrays son:</p>
<table>
<thead>
<tr>
<th>Operador</th>
<th>Propósito</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.mongodb.com/docs/manual/reference/operator/update/push/"><code>$push</code></a></td>
<td>Añade uno o varios elementos</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/docs/manual/reference/operator/update/addToSet/"><code>$addToSet</code></a></td>
<td>Añade un elemento sin duplicados</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/docs/manual/reference/operator/update/pull/"><code>$pull</code></a></td>
<td>Elimina un elemento</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/docs/manual/reference/operator/update/pullAll/"><code>$pullAll</code></a></td>
<td>Elimina varios elementos</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/docs/manual/reference/operator/update/pop/"><code>$pop</code></a></td>
<td>Elimina el primer o el último</td>
</tr>
</tbody>
</table>
<div class="admonition info">
<p class="admonition-title">Preparando los ejemplos</p>
<p>Para trabajar con los arrays, vamos a suponer que tenemos una colección de enlaces donde vamos a almacenar un documento por cada site, con un atributo <code>tags</code> con etiquetas sobre el enlace en cuestión</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">enlaces</span><span class="p">.</span><span class="nx">insertOne</span><span class="p">({</span><span class="nx">titulo</span><span class="o">:</span><span class="s2">&quot;www.google.es&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">tags</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;mapas&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;videos&quot;</span><span class="p">]})</span><span class="w"></span>
</code></pre></div>
<p>De modo que tendríamos el siguiente documento:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="w"> </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;633c60e8ac452ac9d7f9fe74&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;www.google.es&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="kc">ta</span><span class="err">gs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">&#39;mapas&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;videos&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
</div>
<h4 id="anadiendo-elementos">Añadiendo elementos<a class="headerlink" href="#anadiendo-elementos" title="Permanent link">&para;</a></h4>
<p>Si queremos añadir uno o varios elementos, usaremos el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/update/push/"><code>$push</code></a>. Cuando queremos añadir varios elementos a la vez, mediante el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/update/each/"><code>$each</code></a> le pasamos un array con los datos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">enlaces</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="nx">titulo</span><span class="o">:</span><span class="s2">&quot;www.google.es&quot;</span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">                     </span><span class="p">{</span><span class="nx">$push</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">tags</span><span class="o">:</span><span class="s2">&quot;blog&quot;</span><span class="p">}}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">enlaces</span><span class="p">.</span><span class="nx">updateOne</span><span class="p">({</span><span class="nx">titulo</span><span class="o">:</span><span class="s2">&quot;www.google.es&quot;</span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="4 "></span><span class="w">                     </span><span class="p">{</span><span class="nx">$push</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="nx">tags</span><span class="o">:</span><span class="p">{</span><span class="nx">$each</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;calendario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mapas&quot;</span><span class="p">]}}})</span><span class="w"></span>
</code></pre></div>
<p>Al hacer estar modificación, el resultado del documento sería:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="w"> </span><span class="err">_id</span><span class="p">:</span><span class="w"> </span><span class="err">Objec</span><span class="kc">t</span><span class="err">Id(</span><span class="s2">&quot;633c61b5ac452ac9d7f9fe75&quot;</span><span class="err">)</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="kc">t</span><span class="err">i</span><span class="kc">tul</span><span class="err">o</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;www.google.es&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="kc">ta</span><span class="err">gs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="err">&#39;mapas&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;videos&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;blog&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;cale</span><span class="kc">n</span><span class="err">dario&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;email&#39;</span><span class="p">,</span><span class="w"> </span><span class="err">&#39;mapas&#39;</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Al utilizar <code>$push</code> no se tiene en cuenta lo que contiene el array, por tanto, si un elemento ya existe, se repetirá y tendremos duplicados. Si queremos evitar los duplicados, usaremos <a href="https://www.mongodb.com/docs/manual/reference/operator/update/addToSet/"><code>$addToSet</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">enlaces</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">titulo</span><span class="o">:</span><span class="s2">&quot;www.google.es&quot;</span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">                  </span><span class="p">{</span><span class="nx">$addToSet</span><span class="o">:</span><span class="p">{</span><span class="nx">tags</span><span class="o">:</span><span class="s2">&quot;buscador&quot;</span><span class="p">}})</span><span class="w"></span>
</code></pre></div>
<p>Si queremos añadir más de un campo a la vez sin duplicados, debemos anidar el operador <code>$each</code> igual que hemos hecho antes:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">enlaces</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">titulo</span><span class="o">:</span><span class="s2">&quot;www.google.es&quot;</span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">                  </span><span class="p">{</span><span class="nx">$addToSet</span><span class="o">:</span><span class="p">{</span><span class="nx">tags</span><span class="o">:</span><span class="p">{</span><span class="nx">$each</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;drive&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;traductor&quot;</span><span class="p">]}}})</span><span class="w"></span>
</code></pre></div>
<p>En cambio, si queremos eliminar elementos de un array, usaremos el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/update/pull/"><code>$pull</code></a>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">enlaces</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">titulo</span><span class="o">:</span><span class="s2">&quot;www.google.es&quot;</span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">                  </span><span class="p">{</span><span class="nx">$pull</span><span class="o">:</span><span class="p">{</span><span class="nx">tags</span><span class="o">:</span><span class="s2">&quot;traductor&quot;</span><span class="p">}})</span><span class="w"></span>
</code></pre></div>
<p>Similar al caso anterior, con <a href="https://www.mongodb.com/docs/manual/reference/operator/update/pullAll/"><code>$pullAll</code></a>, eliminaremos varios elementos de una sola vez:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">enlaces</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">titulo</span><span class="o">:</span><span class="s2">&quot;www.google.es&quot;</span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">                  </span><span class="p">{</span><span class="nx">$pullAll</span><span class="o">:</span><span class="p">{</span><span class="nx">tags</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;calendario&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;email&quot;</span><span class="p">]}})</span><span class="w"></span>
</code></pre></div>
<p>Otra manera de eliminar elementos del array es mediante <a href="https://www.mongodb.com/docs/manual/reference/operator/update/pop/"><code>$pop</code></a>, el cual elimina el primero (<code>-1</code>) o el último (<code>1</code>) elemento del array:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">enlaces</span><span class="p">.</span><span class="nx">update</span><span class="p">({</span><span class="nx">titulo</span><span class="o">:</span><span class="s2">&quot;www.google.es&quot;</span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="nx">$pop</span><span class="o">:</span><span class="p">{</span><span class="nx">tags</span><span class="o">:-</span><span class="mf">1</span><span class="p">}})</span><span class="w"></span>
</code></pre></div>
<h4 id="operador-posicional">Operador posicional<a class="headerlink" href="#operador-posicional" title="Permanent link">&para;</a></h4>
<p>Por último, tenemos el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/update/positional/">posicional</a>, el cual se expresa con el símbolo <code>$</code> y nos permite modificar el elemento que ocupa una determinada posición del array sin saber exactamente cual es esa posición.</p>
<p>Supongamos que tenemos las calificaciones de los estudiantes (colección <code>students</code>) en un documento con una estructura similar a la siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;_id&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;notas&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="mf">80</span><span class="p">,</span><span class="w"> </span><span class="mf">85</span><span class="p">,</span><span class="w"> </span><span class="mf">90</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>y queremos cambiar la calificación de 80 por 82. Mediante el operador posicional haremos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">students</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="nx">notas</span><span class="o">:</span><span class="w"> </span><span class="mf">80</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;notas.$&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">82</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>De manera similar, si queremos modificar parte de un documento el cual forma parte de un array, debemos usar la notación punto tras el <code>$</code>.</p>
<p>Por ejemplo, supongamos que tenemos estas calificaciones de un determinado alumno, las cuales forman parte de un objeto dentro de un array:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;_id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="nt">&quot;notas&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kc">n</span><span class="err">o</span><span class="kc">ta</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span><span class="w"> </span><span class="err">media</span><span class="p">:</span><span class="w"> </span><span class="mi">75</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="kc">n</span><span class="err">o</span><span class="kc">ta</span><span class="p">:</span><span class="w"> </span><span class="mi">85</span><span class="p">,</span><span class="w"> </span><span class="err">media</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="kc">n</span><span class="err">o</span><span class="kc">ta</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="err">media</span><span class="p">:</span><span class="w"> </span><span class="mi">85</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Podemos observar como tenemos cada calificación como parte de un objeto dentro de un array. Si queremos cambiar el valor de <code>media</code> a <code>89</code> de la calificación cuya <code>nota</code> es <code>85</code>, haremos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">students</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">_id</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;notas.nota&quot;</span><span class="o">:</span><span class="w"> </span><span class="mf">85</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">$set</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s2">&quot;notas.$.media&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="mf">89</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>Es decir, el <code>$</code> referencia al documento que ha cumplido el filtro de búsqueda.</p>
<div class="admonition info">
<p class="admonition-title">Más operadores posicionales</p>
<p>Además del operador posicional $, tenemos disponible el operador posicional <a href="https://www.mongodb.com/docs/manual/reference/operator/update/positional-all/"><code>$[]</code></a> que indica que afecta a todos los elementos del array, y el operador posicional <a href="https://www.mongodb.com/docs/manual/reference/operator/update/positional-filtered/"><code>$[identificador]</code></a> que identifica que elementos del array cumplen una condición para su filtrado.</p>
</div>
<p>Podemos consultar toda la documentación disponible sobre estos operadores en <a href="http://docs.mongodb.org/manual/reference/operator/update-array/">http://docs.mongodb.org/manual/reference/operator/update-array/</a></p>
<h2 id="borrando-documentos">Borrando documentos<a class="headerlink" href="#borrando-documentos" title="Permanent link">&para;</a></h2>
<p>Para borrar, usaremos los método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.deleteOne/"><code>deleteOne</code></a> o <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.deleteMany/"><code>deleteMany</code></a>, los cuales funcionan de manera similar a <code>findOne</code> y <code>find</code>. Si no pasamos ningún parámetro, <code>deleteOne</code> borrará el primer documento, o en el caso de <code>deleteMany</code> toda la colección documento a documento. Si le pasamos un parámetro, éste será el criterio de selección de documentos a eliminar.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">deleteOne</span><span class="p">({</span><span class="nx">nombre</span><span class="o">:</span><span class="s2">&quot;Marina Medrano&quot;</span><span class="p">})</span><span class="w"></span>
</code></pre></div>
<p>Al eliminar un documento, no podemos olvidar que cualquier referencia al documento que exista en la base de datos seguirá existiendo. Por este motivo, manualmente también hay que eliminar o modificar esas referencias.</p>
<p>Si queremos borrar toda la colección, es más eficiente usar el método <a href="https://www.mongodb.com/docs/manual/reference/method/db.collection.drop/"><code>drop</code></a>, ya que también elimina los índices.</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="nx">db</span><span class="p">.</span><span class="nx">people</span><span class="p">.</span><span class="nx">drop</span><span class="p">()</span><span class="w"></span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Eliminar un campo</p>
<p>Recordad que eliminar un determinado campo de un documento no se considera un operación de borrado, sino una actualización mediante el operador <a href="https://www.mongodb.com/docs/manual/reference/operator/update/unset/"><code>$unset</code></a>.</p>
</div>
<h2 id="referencias">Referencias<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://www.mongodb.com/docs/manual/">Manual de MongoDB</a></li>
<li><a href="https://www.mongodb.com/developer/products/mongodb/cheat-sheet/">Cheatsheet oficial</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/sql-comparison/">Comparación entre SQL y MongoDB</a></li>
<li>Cursos gratuitos de <a href="https://university.mongodb.com/">Mongo University</a></li>
<li>Consultas solucionadas sobre la colección <code>sample_restaurants.restaurants</code> en <a href="https://www.w3resource.com/mongodb-exercises/">w3resource</a></li>
</ul>
<h2 id="actividades">Actividades<a class="headerlink" href="#actividades" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>(<abbr title="Gestiona sistemas de almacenamiento y el amplio ecosistema alrededor de ellos facilitando el procesamiento de grandes cantidades de datos sin fallos y de forma rápida.">RA5075.2</abbr> / <abbr title="Se ha comprobado el poder de procesamiento de su modelo de computación distribuida.">CE5.2b</abbr> / 1p) Crea un cluster en <em>MongoAtlas</em>, carga los datos de ejemplo y adjunta capturas de pantalla de:</p>
<ul>
<li>Dashboard del cluster</li>
<li>Bases de datos / colecciones creadas</li>
</ul>
<p>A continuación, conéctate mediante <em>MongoDB Compass</em> y adjunta una captura de pantalla tras conectar con el clúster.</p>
</li>
<li>
<p>(<abbr title="Gestiona soluciones a problemas propuestos, utilizando sistemas de almacenamiento y herramientas asociadas al centro de datos.">RA5075.1</abbr> / <abbr title="Se han procesado los datos almacenados">CE5.1d</abbr> / 2p) Haciendo uso de <code>mongosh</code>, escribe los comandos necesarios para:</p>
<ol>
<li>Obtener las bases de datos creadas.</li>
<li>Sobre la base de datos <code>sample_training</code> y la colección <code>zips</code> averigua:<ol>
<li>Cuantos documentos hay en la ciudad de <code>SAN DIEGO</code>.</li>
<li>Cuantos documentos tienen menos de 100 personas (campo <code>pop</code>).</li>
<li>Obtén los estados de la ciudad de <code>SAN DIEGO</code> (Solución: <code>[ 'CA', 'TX' ]</code>).</li>
<li>Cual es el código postal de la ciudad de <code>ALLEN</code> que no tiene habitantes (sólo recupera el <code>zip</code>, no nos interesa ningún otro campo, ni el <code>_id</code>).</li>
<li>Listado con los 5 códigos postales más poblados (muestra los documentos completos).</li>
<li>Cantidad de documentos que no tienen menos de 5.000 habitantes ni más de 1.000.000 (debes utilizar el operador <code>$nor</code>).</li>
<li>Cuantos documentos tienen más habitantes que su propio código postal (campo <code>zip</code>).</li>
</ol>
</li>
<li>Sobre la colección <code>posts</code> averigua:<ol>
<li>Cuantos mensajes tienen las etiquetas <code>restaurant</code> o <code>moon</code>.</li>
<li>Los comentarios que ha escrito el usuario <code>Salena Olmos</code>.</li>
<li>Recupera los mensajes que en <code>body</code> contengan la palabra <code>earth</code>, y devuelve el título, 3 comentarios y 5 etiquetas.</li>
</ol>
</li>
</ol>
</li>
<li>
<p>(<abbr title="Gestiona soluciones a problemas propuestos, utilizando sistemas de almacenamiento y herramientas asociadas al centro de datos.">RA5075.1</abbr> / <abbr title="Se han procesado los datos almacenados">CE5.1d</abbr> / 2p) Escribe los comandos necesarios para realizar las siguientes operaciones sobre la colección <code>zips</code>:</p>
<ol>
<li>
<p>Crea una entrada con los siguientes datos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span><span class="w"> </span><span class="err">ci</span><span class="kc">t</span><span class="err">y</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;ELX&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="2 "></span><span class="w">  </span><span class="err">zip</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="mi">03206</span><span class="err">&#39;</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="3 "></span><span class="w">  </span><span class="err">loc</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="err">x</span><span class="p">:</span><span class="w"> </span><span class="mf">38.265500</span><span class="p">,</span><span class="w"> </span><span class="err">y</span><span class="p">:</span><span class="w"> </span><span class="mf">-0.698459</span><span class="w"> </span><span class="p">},</span><span class="w"></span>
<span class="linenos" data-linenos="4 "></span><span class="w">  </span><span class="err">pop</span><span class="p">:</span><span class="w"> </span><span class="mi">230224</span><span class="p">,</span><span class="w"></span>
<span class="linenos" data-linenos="5 "></span><span class="w">  </span><span class="err">s</span><span class="kc">tate</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;España&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
</code></pre></div>
</li>
<li>
<p>Crea una entrada con los datos del código postal donde vives (si es el mismo código postal, crea uno diferente).</p>
</li>
<li>Modifica la población de tu código postal a <code>1.000.000</code>.</li>
<li>Incrementa la población de todas los documentos de <code>España</code> en 666 personas.</li>
<li>Añade un campo <code>prov</code> a ambos documentos con valor <code>Alicante</code>.</li>
<li>Modifica los documentos de <code>España</code> y añade un atributo <code>tags</code> que contenga un array vacío.</li>
<li>Modifica todos los documentos de la provincia de <code>Alicante</code> y añade al atributo <code>tags</code> el valor <code>sun</code>.</li>
<li>Modifica el valor de <code>sun</code> de tu código postal y sustitúyelo por <code>house</code>.</li>
<li>Renombra en los documentos de la provincia de <code>Alicante</code> el atributo <code>prov</code> por <code>provincia</code></li>
<li>Elimina las coordenadas del zip <code>03206</code>.</li>
<li>Elimina tu entrada.</li>
</ol>
</li>
</ol>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        ¿Ha sido útil está página?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="Sí, ha sido util" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="La página es mejorable" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
                Gracias por tu colaboración!
              
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
                Gracias por tu colaboración! Ayúdame a mejorarla enviandome un mail a <a href="mailto:a.medrano@edu.gva.es">a.medrano@edu.gva.es</a> con tus comentarios.
              
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Volver al principio
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Pie" >
      
        
        <a href="01nosql.html" class="md-footer__link md-footer__link--prev" aria-label="Anterior: S18.- Almacenamiento de datos. NoSQL" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              S18.- Almacenamiento de datos. NoSQL
            </div>
          </div>
        </a>
      
      
        
        <a href="03modelado.html" class="md-footer__link md-footer__link--next" aria-label="Siguiente: S21.- Modelado de datos NoSQL" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Siguiente
              </span>
              S21.- Modelado de datos NoSQL
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2022-2023 Aitor Medrano - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  

<h4>Consentimiento de cookie</h4>
<p>Esta página de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentación y averiguar si encuentras aquello que buscas o cómo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input type="checkbox" class="md-toggle" id="__settings">
<div class="md-consent__settings">
  <ul class="task-list">
    
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        <label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);console.log(new FormData(form)),__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "navigation.top", "navigation.tracking", "navigation.indexes", "content.code.annotate", "announce.dismiss", "toc.follow"], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>