
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Repaso a los servicios PaaS que ofrece AWS para gestionar los datos, centrándonos tanto en RDS para los datos relacionales como en DynamoDB como sistema NoSQL.">
      
      
      
        <link rel="canonical" href="https://aitor-medrano.github.io/iabd2223/cloud/06datos.html">
      
      
        <link rel="prev" href="05emr.html">
      
      
        <link rel="next" href="07athena.html">
      
      <link rel="icon" href="../images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.14">
    
    
      
        <title>Gestión de datos en la nube con AWS. RDS y DynamoDB. - Inteligencia Artificial y Big Data</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.113286f1.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-MFP4QLMMV7"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-MFP4QLMMV7",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-MFP4QLMMV7",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Gestión de datos en la nube con AWS. RDS y DynamoDB. - Inteligencia Artificial y Big Data" >
      
        <meta  property="og:description"  content="Repaso a los servicios PaaS que ofrece AWS para gestionar los datos, centrándonos tanto en RDS para los datos relacionales como en DynamoDB como sistema NoSQL." >
      
        <meta  property="og:image"  content="https://aitor-medrano.github.io/iabd2223/assets/images/social/cloud/06datos.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://aitor-medrano.github.io/iabd2223/cloud/06datos.html" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Gestión de datos en la nube con AWS. RDS y DynamoDB. - Inteligencia Artificial y Big Data" >
      
        <meta  name="twitter:description"  content="Repaso a los servicios PaaS que ofrece AWS para gestionar los datos, centrándonos tanto en RDS para los datos relacionales como en DynamoDB como sistema NoSQL." >
      
        <meta  name="twitter:image"  content="https://aitor-medrano.github.io/iabd2223/assets/images/social/cloud/06datos.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#datos-en-la-nube" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-header__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Inteligencia Artificial y Big Data
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gestión de datos en la nube con AWS. RDS y DynamoDB.
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="light-blue"  aria-label="Cambiar a modo noche"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Cambiar a modo noche" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="light-blue"  aria-label="Cambiar a modo día"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Cambiar a modo día" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Inteligencia Artificial y Big Data" class="md-nav__button md-logo" aria-label="Inteligencia Artificial y Big Data" data-md-component="logo">
      
  <img src="../images/logoIABD3.png" alt="logo">

    </a>
    Inteligencia Artificial y Big Data
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Inicio
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../sa/index.html">Sistemas de almacenamiento</a>
          
            <label for="__nav_2">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Sistemas de almacenamiento
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/01nosql.html" class="md-nav__link">
        Almacenamiento de datos. NoSQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/02mongo.html" class="md-nav__link">
        MongoDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/03modelado.html" class="md-nav__link">
        Modelado de datos NoSQL
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/05agregaciones.html" class="md-nav__link">
        Agregaciones
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/06replicacion.html" class="md-nav__link">
        Replicación y Particionado
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sa/07pymongo.html" class="md-nav__link">
        MongoDB y Python
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../hadoop/index.html">Ecosistema Hadoop</a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Ecosistema Hadoop
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/01arq.html" class="md-nav__link">
        Arquitecturas Big Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/02etl.html" class="md-nav__link">
        Ingesta de datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/03hadoop.html" class="md-nav__link">
        Hadoop
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/04hdfs.html" class="md-nav__link">
        HDFS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/04formatos.html" class="md-nav__link">
        Formatos de datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/05flume.html" class="md-nav__link">
        Sqoop y Flume
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../hadoop/06hive.html" class="md-nav__link">
        Hive
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html">Datos en el cloud</a>
          
            <label for="__nav_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Datos en el cloud
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="01cloud.html" class="md-nav__link">
        Cloud
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="02aws.html" class="md-nav__link">
        AWS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="03s3.html" class="md-nav__link">
        S3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="04computacion.html" class="md-nav__link">
        EC2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="05emr.html" class="md-nav__link">
        EMR
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          RDS y DynamoDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="06datos.html" class="md-nav__link md-nav__link--active">
        RDS y DynamoDB
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#datos-relacionales-amazon-rds" class="md-nav__link">
    Datos relacionales - Amazon RDS
  </a>
  
    <nav class="md-nav" aria-label="Datos relacionales - Amazon RDS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instancias-de-bases-de-datos" class="md-nav__link">
    Instancias de bases de datos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alta-disponibilidad" class="md-nav__link">
    Alta disponibilidad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#casos-de-uso" class="md-nav__link">
    Casos de uso
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#costes" class="md-nav__link">
    Costes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-rds" class="md-nav__link">
    Ejemplo RDS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amazon-aurora" class="md-nav__link">
    Amazon Aurora
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datos-nosql-dynamodb" class="md-nav__link">
    Datos NoSQL - DynamoDB
  </a>
  
    <nav class="md-nav" aria-label="Datos NoSQL - DynamoDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#componentes-y-particiones" class="md-nav__link">
    Componentes y particiones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infraestructura" class="md-nav__link">
    Infraestructura
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#costes_1" class="md-nav__link">
    Costes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-dynamodb" class="md-nav__link">
    Ejemplo DynamoDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interaccion-con-python" class="md-nav__link">
    Interacción con Python
  </a>
  
    <nav class="md-nav" aria-label="Interacción con Python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caso-de-uso-1-cargar-datos-en-dynamodb" class="md-nav__link">
    Caso de uso 1: Cargar datos en DynamoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#faker" class="md-nav__link">
    Faker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caso-de-uso-2-consultar-datos-en-dynamodb" class="md-nav__link">
    Caso de uso 2 - Consultar datos en DynamoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caso-de-uso-3-de-s3-a-dynamodb" class="md-nav__link">
    Caso de uso 3 - De S3 a DynamoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caso-de-uso-4-desde-rds" class="md-nav__link">
    Caso de uso 4 - Desde RDS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actividades" class="md-nav__link">
    Actividades
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="07athena.html" class="md-nav__link">
        Athena
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../spark/index.html">Spark</a>
          
            <label for="__nav_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Spark
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spark/01spark.html" class="md-nav__link">
        Ecosistema
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spark/01rdd.html" class="md-nav__link">
        RDD
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spark/02dataframeAPI.html" class="md-nav__link">
        DataFrames API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spark/02agregaciones.html" class="md-nav__link">
        Agregaciones
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spark/02catalog.html" class="md-nav__link">
        Spark Catalog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spark/03streaming.html" class="md-nav__link">
        Streaming I
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../spark/03join-window.html" class="md-nav__link">
        Streaming II
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
        
          
            
          
        
          
        
          
        
          
        
          
        
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../dataflow/index.html">Flujo de datos</a>
          
            <label for="__nav_6">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Flujo de datos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/04nifi1.html" class="md-nav__link">
        Nifi I
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/05nifi2.html" class="md-nav__link">
        Nifi II
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/02kafka.html" class="md-nav__link">
        Kafka I
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dataflow/03kafka.html" class="md-nav__link">
        Kafka II
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="https://aitor-medrano.github.io/pia2223/" class="md-nav__link">
        PIA FP
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#datos-relacionales-amazon-rds" class="md-nav__link">
    Datos relacionales - Amazon RDS
  </a>
  
    <nav class="md-nav" aria-label="Datos relacionales - Amazon RDS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#instancias-de-bases-de-datos" class="md-nav__link">
    Instancias de bases de datos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alta-disponibilidad" class="md-nav__link">
    Alta disponibilidad
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#casos-de-uso" class="md-nav__link">
    Casos de uso
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#costes" class="md-nav__link">
    Costes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-rds" class="md-nav__link">
    Ejemplo RDS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#amazon-aurora" class="md-nav__link">
    Amazon Aurora
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datos-nosql-dynamodb" class="md-nav__link">
    Datos NoSQL - DynamoDB
  </a>
  
    <nav class="md-nav" aria-label="Datos NoSQL - DynamoDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#componentes-y-particiones" class="md-nav__link">
    Componentes y particiones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#infraestructura" class="md-nav__link">
    Infraestructura
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#costes_1" class="md-nav__link">
    Costes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejemplo-dynamodb" class="md-nav__link">
    Ejemplo DynamoDB
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interaccion-con-python" class="md-nav__link">
    Interacción con Python
  </a>
  
    <nav class="md-nav" aria-label="Interacción con Python">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#caso-de-uso-1-cargar-datos-en-dynamodb" class="md-nav__link">
    Caso de uso 1: Cargar datos en DynamoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#faker" class="md-nav__link">
    Faker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caso-de-uso-2-consultar-datos-en-dynamodb" class="md-nav__link">
    Caso de uso 2 - Consultar datos en DynamoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caso-de-uso-3-de-s3-a-dynamodb" class="md-nav__link">
    Caso de uso 3 - De S3 a DynamoDB
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#caso-de-uso-4-desde-rds" class="md-nav__link">
    Caso de uso 4 - Desde RDS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#actividades" class="md-nav__link">
    Actividades
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="datos-en-la-nube">Datos en la nube<a class="headerlink" href="#datos-en-la-nube" title="Permanent link">&para;</a></h1>
<p>Ya hemos visto que el almacenamiento en la nube ofrece un gran número de ventajas. Otro de los productos estrella de la computación en la nube es el uso de bases de datos, ya sean distribuidas o no.</p>
<p>La principal ventaja de utilizar un servicio de base de datos basado en la nube es que no requieren de la administración por parte del usuario. Éste sólo utiliza el servicio sin necesidad de tener conocimientos avanzados sobre su administración. Estos servicios se conocen como <strong>administrados</strong>, ya que la propia plataforma cloud se encarga de gestionar el escalado, las copias de seguridad automáticas, la tolerancia a errores y la alta disponibilidad, y por tanto, estos servicios forman parte de una solución PaaS.</p>
<p>Si nosotros creásemos una instancia EC2 e instalásemos cualquier sistema gestor de base de datos, como <em>MariaDB</em> o <em>PostgreSQL</em>, seríamos responsables de varias tareas administrativas, como el mantenimiento del servidor y la huella energética, el software, la instalación, la implementación de parches y las copias de seguridad de la base de datos, así como de garantizar su alta disponibilidad, de planificar la escalabilidad y la seguridad de los datos, y de instalar el sistema operativo e instalarle los respectivos parches.</p>
<h2 id="datos-relacionales-amazon-rds">Datos relacionales - <em>Amazon RDS</em><a class="headerlink" href="#datos-relacionales-amazon-rds" title="Permanent link">&para;</a></h2>
<p>AWS ofrece <em>Amazon RDS</em> (<a href="https://aws.amazon.com/es/rds/">https://aws.amazon.com/es/rds/</a>) como servicio administrado que configura y opera una base de datos relacional en la nube, de manera que como desarrolladores sólo hemos de enfocar nuestros esfuerzos en los datos y optimizar nuestras aplicaciones.</p>
<h3 id="instancias-de-bases-de-datos">Instancias de bases de datos<a class="headerlink" href="#instancias-de-bases-de-datos" title="Permanent link">&para;</a></h3>
<p>Una instancia de base de datos es un entorno de base de datos aislado que puede contener varias bases de datos creadas por el usuario. Se puede acceder a él utilizando las mismas herramientas y aplicaciones que utiliza con una instancia de base de datos independiente.</p>
<p>Cuando vamos a crear una instancia de base de datos, primero hemos de indicar qué motor de base de datos ejecutar. Actualmente, RDS admite seis motores de bases de datos:</p>
<ul>
<li><a href="https://aws.amazon.com/es/rds/mysql/">MySQL</a>, compatible con las versiones 5.6, 5.7 y 8.0.</li>
<li><a href="https://aws.amazon.com/es/rds/aurora/">Amazon Aurora</a></li>
<li><a href="https://aws.amazon.com/es/rds/sqlserver/">Microsoft SQL Server</a>, que permite implementar varias versiones de SQL Server (2012, 2014, 2016, 2017 y 2019), incluidas las Express, Web, Standard y Enterprise.</li>
<li><a href="https://aws.amazon.com/es/rds/postgresql/">PostgreSQL</a>, compatible con las versiones 9.6, 10, 11 y 12.</li>
<li><a href="https://aws.amazon.com/es/rds/mariadb/">MariaDB</a>, compatible con las versiones 10.2, 10.3, 10.4 y 10.5</li>
<li>y <a href="https://aws.amazon.com/es/rds/oracle">Oracle</a>, compatible con Oracle 12 y Oracle 19, con dos modelos de licencia diferentes: <em>Licencia incluida</em> y <em>Bring-Your-Own-License (BYOL)</em>.</li>
</ul>
<p>Los recursos que se encuentran en una instancia de base de datos se definen en función de la clase de instancia de base de datos, y el tipo de almacenamiento se determina por el tipo de disco. Las instancias y el almacenamiento de base de datos difieren en cuanto a las características de rendimiento y al precio, lo que permite adaptar el coste y el rendimiento a las necesidades de nuestra base de datos.</p>
<figure style="align: center;">
    <img src="images/06rds.png" width="500">
    <figcaption>Instancia de RDS</figcaption>
</figure>

<p>Por ejemplo, si seleccionamos el motor de <em>MariaDB</em>, podemos observar como mediante la creación sencilla nos ofrece tres propuestas de tamaño, dependiendo de si es para el entorno de producción, desarrollo y pruebas o el de la capa gratuita.</p>
<figure style="align: center;">
    <img src="images/06mariadb.png">
    <figcaption>Configuración de tamaño de la instancia con MariaDB</figcaption>
</figure>

<h3 id="alta-disponibilidad">Alta disponibilidad<a class="headerlink" href="#alta-disponibilidad" title="Permanent link">&para;</a></h3>
<p>Una de las características más importantes de <em>RDS</em> es la capacidad de configurar la instancia de base de datos para una alta disponibilidad con una <a href="https://aws.amazon.com/es/rds/features/multi-az/">implementación Multi-AZ</a>. Al hacerlo, se genera de manera automática una <strong>copia en espera</strong> de la instancia de base de datos en otra zona de disponibilidad dentro de la misma VPC. Después de propagar la copia de la base de datos, las transacciones se replican de forma <ins>síncrona</ins> a la copia en espera.</p>
<figure style="align: center;">
    <img src="images/06rdsMultiAZ.png">
    <figcaption>Alta disponibilidad en Multi-AZ</figcaption>
</figure>

<p>Por lo tanto, si la instancia de base de datos principal falla en una implementación Multi-AZ, <em>RDS</em> activa automáticamente la instancia de base de datos en espera como la nueva instancia principal.</p>
<h4 id="replica-de-lectura">Réplica de lectura<a class="headerlink" href="#replica-de-lectura" title="Permanent link">&para;</a></h4>
<p>RDS también admite la creación de <a href="https://aws.amazon.com/es/rds/features/read-replicas/">réplicas de lectura</a> para MySQL, MariaDB, PostgreSQLy Amazon Aurora. </p>
<figure style="float: right;">
    <img src="images/06rdsReplicaLectura.png">
    <figcaption>Réplica de lectura</figcaption>
</figure>

<p>Las actualizaciones que se realizan en la instancia principal se copian de manera <ins>asíncrona</ins> en la instancia de réplica de lectura, de manera que direccionando las consultas a esta nueva réplica reduciremos la carga de la instancia principal.</p>
<p>Las réplicas de lectura también pueden convertirse en la instancia de base de datos principal, pero, debido a la replicación asíncrona, este proceso debe hacerse de forma manual.</p>
<p>Las réplicas de lectura pueden crearse en una región diferente a la utilizada por la base de datos principal, lo que puede mejorar la recuperación de desastres y/o disminuir la latencia al dirigir las lecturas a una réplica de lectura lo más cercana al usuario.</p>
<h3 id="casos-de-uso">Casos de uso<a class="headerlink" href="#casos-de-uso" title="Permanent link">&para;</a></h3>
<p>AmazonRDS es ideal para las aplicaciones web y móviles que necesitan una base de datos con alto rendimiento, enorme escalabilidad en el almacenamiento y alta disponibilidad.</p>
<p>Se recomienda <em>RDS</em> cuando nuestra aplicación necesite:</p>
<ul>
<li>Transacciones o consultas complejas</li>
<li>Tasa de consulta o escritura media a alta: hasta 30.000 IOPS (15.000 lecturas + 15.000 escrituras)</li>
<li>No más de una única partición o nodo de trabajo</li>
<li>Alta durabilidad</li>
</ul>
<p>En cambio, no se recomienda cuando:</p>
<ul>
<li>Tasas de lectura o escritura muy grandes (por ejemplo, 150.000 escrituras por segundo)</li>
<li>Fragmentación causada por el gran tamaño de los datos o las altas demandas de rendimiento</li>
<li>Solicitudes y consultas GET o PUT simples que una base de datos NoSQL puede manejar</li>
<li>Personalización del sistema de administración de bases de datos relacionales (en este caso, es mejor instalar por nuestra cuenta el SGBD que necesitemos en una instancia EC2).</li>
</ul>
<h3 id="costes">Costes<a class="headerlink" href="#costes" title="Permanent link">&para;</a></h3>
<p>El <a href="https://aws.amazon.com/es/rds/pricing/">coste</a> se calcula en base al tiempo de ejecución (calculado en horas) así como las características de la base de datos. Las características de la base de datos varían según el motor, el <a href="https://aws.amazon.com/es/rds/instance-types/">tipo de instancia</a> y su cantidad, así como la clase de memoria de la base de datos.</p>
<p>Otros gastos asociados son:</p>
<ul>
<li>almacenamiento aprovisionado: el almacenamiento para copias de seguridad de hasta el 100% del almacenamiento de nuestra base de datos activa es gratuito. Una vez que se termina la instancia de base de datos, el almacenamiento para copias de seguridad se factura por GB por mes.</li>
<li>cantidad de solicitudes de entrada y de salida.</li>
</ul>
<p>Aunque se recomienda utilizar la <a href="https://calculator.aws/#/addService">calculadora de costes</a> para afinar en el presupuesto, por ejemplo, una base de datos con MariaDB con una instancia <code>db.m4.large</code> con 2 procesadores y 8GB de RAM, en una única AZ, con un porcentaje de utilización del 100%  y 30GB para almacenar los datos, cuesta alrededor de 131$ mensuales. En cambio si la cambiamos por dos instancias más potentes, como puede ser la <code>db.m4.4xlarge</code>, con 16 procesadores y 64 GB de RAM, en multi-AZ ya sube a unos 4.100$ al mes.</p>
<p>Es importante recordar que si reservamos las instancias estos costes se reducirían en proporción a 2350$ (reserva de un año) o 1526$ (reserva de tres años).</p>
<h3 id="ejemplo-rds">Ejemplo RDS<a class="headerlink" href="#ejemplo-rds" title="Permanent link">&para;</a></h3>
<p>A continuación vamos a hacer un ejemplo sencillo donde vamos a crear una base de datos con la información que vimos en el bloque de SQL. Para ello, crearemos una instancia de MariaDB y nos conectaremos desde <em>HeidiSQL</em>.</p>
<figure style="align: center;">
    <img src="images/06rds-instituto1.png">
    <figcaption>Creación de la BD en RDS</figcaption>
</figure>

<p>Así pues, desde la consola de AWS, crearemos nuestra base de datos a la que llamaremos <code>instituto</code>.</p>
<p>En nuestro caso hemos seguido la creación estándar con una plantilla de la capa gratuita (utiliza una instancia <code>db.t4g.micro</code>). Una vez configurado el usuario <code>admin</code> y la contraseña <code>adminadmin</code> (al menos debe tener ocho caracteres), debemos configurar la conectividad.</p>
<figure style="align: center;">
    <img src="images/06rds-instituto2a.png">
    <figcaption>Configuración de la conectividad en RDS</figcaption>
</figure>

<div class="admonition caution">
<p class="admonition-title">Instancias permitidas en AWS Academy</p>
<p>Si queréis crear bases de datos con máquinas más potentes, podéis utilizar instancias hasta nivel <em>large</em>, y a ser posible a ráfagas (instancias <em>t</em>). Dentro de la <em>Configuración adicional</em>, es importante deshabilitar la monitorización mejorada (no tenemos permiso para su uso en <em>AWS Academy</em>).</p>
</div>
<p>Como vamos a querer acceder a nuestro servidor de MariaDB desde fuera de una VPC de EC2, necesitamos configurar el acceso público. Al hacerlo, no quiere decir que ya sea accesible desde fuera de internet, ya que necesitamos configurar su grupo de seguridad (recordad que funciona a modo de <em>firewall</em>). Así pues, es recomendable crear un nuevo grupo de seguridad para que permitamos las conexiones del puerto 3306 a nuestra IP.</p>
<figure style="align: center;">
    <img src="images/06rds-instituto2b.png">
    <figcaption>Configuración de la conectividad en RDS</figcaption>
</figure>

<p>Así pues, una vez creada (lo cual tarda unos minutos), podremos seleccionar la instancia creada y ver su panel de información:</p>
<figure style="align: center;">
    <img src="images/06rds-instituto3.png">
    <figcaption>Resumen de instancia en RDS</figcaption>
</figure>

<p>Así pues, si copiamos la información del punto de enlace y creamos una conexión en <em>DBeaver</em>, veremos que nos conectamos correctamente (si no hemos creado un nuevo grupo de seguridad, deberemos editar el grupo de seguridad por defecto, y añadir una regla de entrada para el protocolo TCP para el puerto 3306, y por ejemplo para todo internet - <code>0.0.0.0/0</code>).</p>
<figure style="align: center;">
    <img src="images/06rds-instituto4.png" width="600">
    <figcaption>Configuración en DBeaver</figcaption>
</figure>

<p>Una vez conectado, ya procedemos de la misma manera que si tuviéramos la base de datos en un entorno local.</p>
<h2 id="amazon-aurora">Amazon Aurora<a class="headerlink" href="#amazon-aurora" title="Permanent link">&para;</a></h2>
<p><em>Amazon Aurora</em> es una base de datos relacional compatible con <em>MySQL</em> y <em>PostgreSQL</em> optimizada para la nube. Combina el rendimiento y la disponibilidad de las bases de datos comerciales de alta gama con la simplicidad y la rentabilidad de las bases de datos de código abierto. Ofrece dos modelos, el clásico basado en instancias y un <a href="https://aws.amazon.com/es/rds/aurora/serverless/">modelo <em>serverless</em></a> en el cual se contratan unidades de computación (ACU).</p>
<p>Al estar desarrollado de forma nativa por Amazon se adapta mejor a su infraestructura en coste, rendimiento y alta disponibilidad. Está pensado como un subsistema de almacenamiento distribuido de alto rendimiento, ofreciendo automatización de las tareas que requieren mucho tiempo, como el aprovisionamiento, la implementación de parches, las copias ​de seguridad, la recuperación, la detección de errores y su reparación.</p>
<figure style="float: right;">
    <img src="images/06aurora.png">
    <figcaption>Alta disponibles con Aurora</figcaption>
</figure>

<p><em>Aurora</em> replica varias copias de los datos en múltiples zonas de disponibilidad y realiza copias de seguridad continuas de los datos en <em>S3</em>.</p>
<p>Respecto a la seguridad, hay varios niveles disponibles, incluidos el aislamiento de la red con <em>VPC</em>, el cifrado en reposo por medio de claves creadas y controladas con <em>AWS KMS</em> y el cifrado de los datos en tránsito mediante SSL.</p>
<p>Respecto al coste, si cogemos el mismo ejemplo anterior de una instancia de Aurora compatible con MySQL con dos procesadores y 8GB de RAM, en este caso, la <code>db.t4g.large</code>, el precio se queda en 106$ mensuales.</p>
<h2 id="datos-nosql-dynamodb">Datos NoSQL - <em>DynamoDB</em><a class="headerlink" href="#datos-nosql-dynamodb" title="Permanent link">&para;</a></h2>
<p><em>DynamoDB</em> (<a href="https://aws.amazon.com/es/dynamodb/">https://aws.amazon.com/es/dynamodb/</a>) es un servicio administrado de base de datos NoSQL clave-valor y documental, rápido y flexible para todas las aplicaciones que requieren una latencia uniforme de un solo dígito de milisegundos a cualquier escala y una capacidad de almacenamiento prácticamente ilimitado.</p>
<p>Así pues, es un almacén de claves/valor (similar a <a href="https://redis.io/">Redis</a> y <a href="https://www.mongodb.com/es">MongoDB</a> a la vez), flexible y sin estructura fija (los elementos pueden tener atributos diferentes), diseñado para garantizar un determinado rendimiento así como una determinada disponibilidad para cada tabla (en NoSQL suele haber pocas tablas), es decir, se definen elementos por tabla y se paga según lo exigido en cada una.</p>
<h3 id="componentes-y-particiones">Componentes y particiones<a class="headerlink" href="#componentes-y-particiones" title="Permanent link">&para;</a></h3>
<p>Los componentes principales son:</p>
<ul>
<li>las <strong>tablas</strong>: son conjuntos de datos, formada por los elementos.</li>
<li>los <strong>elementos</strong>: grupo de atributos que se puede identificar de forma exclusiva entre todos los demás elementos</li>
<li>los <strong>atributos</strong>: elemento de datos fundamental que no es preciso seguir dividiendo.</li>
</ul>
<p><em>DynamoDB</em> soporta dos tipos de claves principales:</p>
<ul>
<li>La <strong>clave de partición</strong> es una clave principal simple.</li>
<li>La <strong>clave de partición y de ordenamiento</strong>, también conocidas como clave principal compuesta, ya que está formada por dos atributos.</li>
</ul>
<figure style="align: center;">
    <img src="images/06ddb-claves.png" width="600">
    <figcaption>Claves</figcaption>
</figure>

<p>A medida que aumenta el volumen de datos, la clave principal particiona e indexa los datos de la tabla. Podemos recuperar los datos de una tabla de <em>DynamoDB</em> de dos formas distintas, bien por la clave y hacer una consulta directa, o utilizar un escaneo de todos los elementos en busca de aquello que coincida con el parámetro de búsqueda.</p>
<figure style="align: center;">
    <img src="images/06ddb-particiones.png" width="600">
    <figcaption>Consultas por clave o escaneo</figcaption>
</figure>

<p>Para aprovechar al máximo las operaciones de consulta, es importante que la clave utilizada identifique de forma unívoca los elementos de la tabla de <em>DynamoDB</em>. Podemos configurar una clave principal simple basada en un único atributo de los valores de los datos con una distribución uniforme. De forma alternativa, podemos especificar una clave compuesta, que incluye una clave de partición y una clave secundaria.</p>
<p>Además, <em>DynamoDB</em> permite crear índices para optimizar las consultas que realicemos sobre atributos que no forman parte de la clave de partición u ordenamiento.</p>
<h3 id="infraestructura">Infraestructura<a class="headerlink" href="#infraestructura" title="Permanent link">&para;</a></h3>
<p>AWS administra toda la infraestructura subyacente de datos y los almacena de manera redundante en varias instalaciones dentro de una región, como parte de la arquitectura tolerante a errores.</p>
<p>El sistema particiona los datos automáticamente, distribuyendo los datos entre diferentes dispositivos de almacenamiento. No existe ningún límite práctico respecto de la cantidad de elementos que se pueden almacenar en una tabla. Por ejemplo, algunos clientes tienen tablas de producción con miles de millones de elementos.</p>
<p>Todos los datos de <em>DynamoDB</em> se almacenan en unidades SSD, y su lenguaje de consulta simple (<a href="https://partiql.org/">PartiQL</a>) permite un rendimiento de las consultas uniforme y de baja latencia. Además de escalar el almacenamiento, <em>DynamoDB</em> permite aprovisionar el volumen del rendimiento de lectura o escritura que necesita para cada tabla.</p>
<p>También facilita el escalado automático, monitorizando la carga de la tabla e incrementando o disminuyendo el rendimiento aprovisionado de manera automática. Otras características clave son las tablas globales que permiten generar réplicas de manera automática en las regiones de AWS que elijamos, el cifrado en reposo y la visibilidad del tiempo de vida (TTL) de los elementos.</p>
<h3 id="costes_1">Costes<a class="headerlink" href="#costes_1" title="Permanent link">&para;</a></h3>
<p>Con <em>DynamoDB</em> se cobran las operaciones de lectura, escritura y almacenamiento de datos en sus tablas, junto con las características opcionales que decidamos habilitar. Ofrece dos modos de capacidad con opciones de facturación:</p>
<ul>
<li>
<p><a href="https://aws.amazon.com/es/dynamodb/pricing/on-demand/">Bajo demanda</a>: se cobran las operaciones de lectura y escritura de datos realizada en las tablas. No necesitamos especificar el rendimiento de lectura y escritura que espera de nuestras aplicaciones. Apropiado cuando:</p>
<ul>
<li>Creamos nuevas tablas con cargas de trabajo desconocidas.</li>
<li>El tráfico de la aplicación es impredecible.</li>
</ul>
</li>
<li>
<p><a href="https://aws.amazon.com/es/dynamodb/pricing/provisioned/">Aprovisionada</a>: se configura el número de operaciones de lectura y escritura por segundo que consideramos que necesitará nuestra aplicación. Permite usar el escalado automático para ajustar automáticamente la capacidad de la tabla en función de la tasa de uso especificada. Apropiado cuando:</p>
<ul>
<li>El tráfico de la aplicación es predecible.</li>
<li>Las aplicaciones tienen un tráfico uniforme o aumenta gradualmente.</li>
<li>Los requisitos de capacidad se pueden predecir para controlar los costos</li>
</ul>
</li>
</ul>
<p>Por ejemplo, una tabla donde especificamos un rendimiento garantizado de 1000 millones lecturas y 1 millón de escrituras al mes, con una coherencia eventual (es decir, que permite desorden de peticiones ) nos costará $67,17 al mes.</p>
<h3 id="ejemplo-dynamodb">Ejemplo DynamoDB<a class="headerlink" href="#ejemplo-dynamodb" title="Permanent link">&para;</a></h3>
<p>A continuación vamos a crear un ejemplo donde tras crear una tabla, la cargaremos con datos para posteriormente realizar alguna consulta.</p>
<p>Supongamos que tenemos datos relativos a un catálogo de productos, almacenados en el archivo <a href="resources/ProductCatalog.json">ProductCatalog.json</a>, el cual queremos poder consultar.</p>
<p>Si visualizamos el primer registro podemos observar su estructura. Esta estructura es específica de <em>DynamoDB</em>, ya que indica en el primer elemento el nombre de la tabla (en nuestro caso <code>ProductCatalog</code>), y a continuación el tipo de operación (<code>PutRequest</code>):</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">    </span><span class="nt">&quot;ProductCatalog&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">        </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">            </span><span class="nt">&quot;PutRequest&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">                </span><span class="nt">&quot;Item&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">                    </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">                        </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;101&quot;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">                    </span><span class="p">},</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">                    </span><span class="nt">&quot;Title&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="10 "></span><span class="w">                        </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Book 101 Title&quot;</span>
<span class="linenos" data-linenos="11 "></span><span class="w">                    </span><span class="p">},</span>
<span class="linenos" data-linenos="12 "></span><span class="w">                    </span><span class="nt">&quot;ISBN&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="13 "></span><span class="w">                        </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;111-1111111111&quot;</span>
<span class="linenos" data-linenos="14 "></span><span class="w">                    </span><span class="p">},</span>
<span class="linenos" data-linenos="15 "></span><span class="w">                    </span><span class="nt">&quot;Authors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="16 "></span><span class="w">                        </span><span class="nt">&quot;L&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="17 "></span><span class="w">                            </span><span class="p">{</span>
<span class="linenos" data-linenos="18 "></span><span class="w">                                </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Author1&quot;</span>
<span class="linenos" data-linenos="19 "></span><span class="w">                            </span><span class="p">}</span>
<span class="linenos" data-linenos="20 "></span><span class="w">                        </span><span class="p">]</span>
<span class="linenos" data-linenos="21 "></span><span class="w">                    </span><span class="p">},</span>
<span class="linenos" data-linenos="22 "></span><span class="w">                    </span><span class="nt">&quot;Price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="23 "></span><span class="w">                        </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2&quot;</span>
<span class="linenos" data-linenos="24 "></span><span class="w">                    </span><span class="p">},</span>
<span class="linenos" data-linenos="25 "></span><span class="w">                    </span><span class="nt">&quot;Dimensions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="26 "></span><span class="w">                        </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;8.5 x 11.0 x 0.5&quot;</span>
<span class="linenos" data-linenos="27 "></span><span class="w">                    </span><span class="p">},</span>
<span class="linenos" data-linenos="28 "></span><span class="w">                    </span><span class="nt">&quot;PageCount&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="29 "></span><span class="w">                        </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;500&quot;</span>
<span class="linenos" data-linenos="30 "></span><span class="w">                    </span><span class="p">},</span>
<span class="linenos" data-linenos="31 "></span><span class="w">                    </span><span class="nt">&quot;InPublication&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="32 "></span><span class="w">                        </span><span class="nt">&quot;BOOL&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
<span class="linenos" data-linenos="33 "></span><span class="w">                    </span><span class="p">},</span>
<span class="linenos" data-linenos="34 "></span><span class="w">                    </span><span class="nt">&quot;ProductCategory&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="35 "></span><span class="w">                        </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Book&quot;</span>
<span class="linenos" data-linenos="36 "></span><span class="w">                    </span><span class="p">}</span>
<span class="linenos" data-linenos="37 "></span><span class="w">                </span><span class="p">}</span>
<span class="linenos" data-linenos="38 "></span><span class="w">            </span><span class="p">}</span>
<span class="linenos" data-linenos="39 "></span><span class="w">        </span><span class="p">},</span>
</code></pre></div>
<p>Para ello, primero vamos a crear la tabla desde el interfaz web de AWS. Tras seleccionar <em>Amazon DynamoDB</em>, creamos una tabla que llamamos <code>ProductCatalog</code>, cuyo identificador será <code>Id</code> de tipo <em>número</em>. El resto de campos se crearán automáticamente al importar los datos.</p>
<figure style="align: center;">
    <img src="images/06ddb-createTable.png" width="600">
    <figcaption>Creando la tabla</figcaption>
</figure>

<p>También podíamos haber creado la tabla mediante el comando <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/dynamodb/create-table.html">create-table</a> de AWS CLI:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>aws<span class="w"> </span>dynamodb<span class="w"> </span>create-table<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span>--table-name<span class="w"> </span>ProductCatalog<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span>--attribute-definitions<span class="w"> </span><span class="nv">AttributeName</span><span class="o">=</span>Id,AttributeType<span class="o">=</span>N<span class="w">  </span><span class="se">\</span>
<span class="linenos" data-linenos="4 "></span><span class="w">    </span>--key-schema<span class="w"> </span><span class="nv">AttributeName</span><span class="o">=</span>Id,KeyType<span class="o">=</span>HASH<span class="w"> </span><span class="se">\</span>
<span class="linenos" data-linenos="5 "></span><span class="w">    </span>--billing-mode<span class="w"> </span>PAY_PER_REQUEST
</code></pre></div>
<p>Para introducir los datos, podemos hacerlo de varias maneras.</p>
<ul>
<li>Si pulsamos sobra la tabla y luego en elementos podemos rellenar un formulario indicando el tipo de los elementos y su valor.</li>
<li>
<p>Otra manera más ágil es mediante AWS CLI (recordad antes configurar las <a href="02aws.html#variablesEntorno">variables de entorno</a> con la información de la conexión):</p>
<p>El comando <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/dynamodb/batch-write-item.html">batch-write-item</a> permite importar los datos desde un archivo JSON siempre y cuando cumpla con el formato comentado anteriormente.</p>
<p>Así pues, el comando sería:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>aws<span class="w"> </span>dynamodb<span class="w"> </span>batch-write-item<span class="w"> </span>--request-items<span class="w"> </span>file://ProductCatalog.json
</code></pre></div>
<p>Una vez ejecutado tendremos un mensaje de <code>UnprocessedItems: {}</code>.</p>
</li>
<li>
<p>También podemos cargar los datos en S3, y realizar una <a href="https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/S3DataImport.HowItWorks.html">importación desde S3</a>, pero el formato del documento es diferente, admitiendo datos en CSV, un formato de JSON multilínea específico de DynamoDB (compuestos de documentos <code>Item</code>) o un formato propietario como <a href="https://amzn.github.io/ion-docs/">Amazon Ion</a>. Así pues, primero cargaremos <a href="resources/ProductCatalogS3.json">ProductCatalogS3.json</a> en S3, y a continuación realizamos la importación.</p>
<p><figure style="align: center;">
    <img src="images/06ddb-import-s3.png" width="600">
    <figcaption>Importación en DynamoDB desde S3</figcaption>
</figure></p>
<p>Tras indicar el archivo, deberemos indicar los datos de creación de la nueva tabla (es decir, no permite importar datos sobre una tabla ya existente previamente).</p>
</li>
</ul>
<p>Si volvemos a la consola web, tras entrar en la tabla y pulsar en <em>Ver elementos</em> veremos los datos ya introducidos.</p>
<figure style="align: center;">
    <img src="images/06ddb-elementos.png" width="600">
    <figcaption>Ver elementos</figcaption>
</figure>

<p>Si queremos consultar información de la tabla mediante el comando <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/dynamodb/describe-table.html">describe-table</a> de AWS CLI, ejecutaremos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>aws<span class="w"> </span>dynamodb<span class="w"> </span>describe-table<span class="w"> </span>--table-name<span class="w"> </span>ProductCatalog
</code></pre></div>
<p>Si queremos hacer la consulta de la tabla para ver los datos que contiene desde el comando <a href="https://awscli.amazonaws.com/v2/documentation/api/latest/reference/dynamodb/scan.html">scan</a> de AWS CLI, ejecutaremos:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>aws<span class="w"> </span>dynamodb<span class="w"> </span>scan<span class="w"> </span>--table-name<span class="w"> </span>ProductCatalog
</code></pre></div>
<p>Y veremos algo similar a:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">    </span><span class="nt">&quot;Items&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">        </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">            </span><span class="nt">&quot;Title&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">                </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;18-Bike-204&quot;</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">            </span><span class="nt">&quot;Price&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">                </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;500&quot;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="10 "></span><span class="w">            </span><span class="nt">&quot;Brand&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span><span class="w">                </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Brand-Company C&quot;</span>
<span class="linenos" data-linenos="12 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="13 "></span><span class="w">            </span><span class="nt">&quot;Description&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="14 "></span><span class="w">                </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;205 Description&quot;</span>
<span class="linenos" data-linenos="15 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="16 "></span><span class="w">            </span><span class="nt">&quot;Color&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="17 "></span><span class="w">                </span><span class="nt">&quot;L&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="18 "></span><span class="w">                    </span><span class="p">{</span>
<span class="linenos" data-linenos="19 "></span><span class="w">                        </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Red&quot;</span>
<span class="linenos" data-linenos="20 "></span><span class="w">                    </span><span class="p">},</span>
<span class="linenos" data-linenos="21 "></span><span class="w">                    </span><span class="p">{</span>
<span class="linenos" data-linenos="22 "></span><span class="w">                        </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Black&quot;</span>
<span class="linenos" data-linenos="23 "></span><span class="w">                    </span><span class="p">}</span>
<span class="linenos" data-linenos="24 "></span><span class="w">                </span><span class="p">]</span>
<span class="linenos" data-linenos="25 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="26 "></span><span class="w">            </span><span class="nt">&quot;ProductCategory&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="27 "></span><span class="w">                </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bicycle&quot;</span>
<span class="linenos" data-linenos="28 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="29 "></span><span class="w">            </span><span class="nt">&quot;Id&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="30 "></span><span class="w">                </span><span class="nt">&quot;N&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;205&quot;</span>
<span class="linenos" data-linenos="31 "></span><span class="w">            </span><span class="p">},</span>
<span class="linenos" data-linenos="32 "></span><span class="w">            </span><span class="nt">&quot;BicycleType&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos="33 "></span><span class="w">                </span><span class="nt">&quot;S&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hybrid&quot;</span>
</code></pre></div>
<p>Como se puede observar, los datos salen desordenados.</p>
<p>Vamos a realizar consultas sobre estos datos haciendo uso de <em>PartiQL</em>. Así pues, en el menú de la izquierda, seleccionamos el editor <em>PartiQL</em>.</p>
<figure style="align: center;">
    <img src="images/06ddb-partiQL.png">
    <figcaption>Consultas con PartiQL</figcaption>
</figure>

<p>En el panel de la derecha podremos realizar consultas del tipo:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">ProductCatalog</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">101</span>
<span class="linenos" data-linenos="2 "></span><span class="k">select</span><span class="w"> </span><span class="n">Title</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">ProductCatalog</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">ProductCategory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Book&#39;</span>
<span class="linenos" data-linenos="3 "></span><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">ProductCatalog</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">Price</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">300</span>
</code></pre></div>
<h2 id="interaccion-con-python">Interacción con Python<a class="headerlink" href="#interaccion-con-python" title="Permanent link">&para;</a></h2>
<h3 id="caso-de-uso-1-cargar-datos-en-dynamodb">Caso de uso 1: Cargar datos en DynamoDB<a class="headerlink" href="#caso-de-uso-1-cargar-datos-en-dynamodb" title="Permanent link">&para;</a></h3>
<p>Vamos a cargar un listado de películas en <em>DynamoDB</em>. El primer paso es elegir las claves de particionado y ordenación. El archivo <a href="resources/datosPeliculas.json">datosPeliculas.json</a> contiene el siguiente contenido:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">[</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">    </span><span class="p">{</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">        </span><span class="nt">&quot;year&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2013</span><span class="p">,</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Rush&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">        </span><span class="nt">&quot;info&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">            </span><span class="nt">&quot;directors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Ron Howard&quot;</span><span class="p">],</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">            </span><span class="nt">&quot;release_date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2013-09-02T00:00:00Z&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">            </span><span class="nt">&quot;rating&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">8.3</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">            </span><span class="nt">&quot;genres&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="10 "></span><span class="w">                </span><span class="s2">&quot;Action&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">                </span><span class="s2">&quot;Biography&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span><span class="w">                </span><span class="s2">&quot;Drama&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="13 "></span><span class="w">                </span><span class="s2">&quot;Sport&quot;</span>
<span class="linenos" data-linenos="14 "></span><span class="w">            </span><span class="p">],</span>
<span class="linenos" data-linenos="15 "></span><span class="w">            </span><span class="nt">&quot;image_url&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;http://ia.media-imdb.com/images/M/MV5BMTQyMDE0MTY0OV5BMl5BanBnXkFtZTcwMjI2OTI0OQ@@._V1_SX400_.jpg&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span><span class="w">            </span><span class="nt">&quot;plot&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;A re-creation of the merciless 1970s rivalry between Formula One rivals James Hunt and Niki Lauda.&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="17 "></span><span class="w">            </span><span class="nt">&quot;rank&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="linenos" data-linenos="18 "></span><span class="w">            </span><span class="nt">&quot;running_time_secs&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">7380</span><span class="p">,</span>
<span class="linenos" data-linenos="19 "></span><span class="w">            </span><span class="nt">&quot;actors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos="20 "></span><span class="w">                </span><span class="s2">&quot;Daniel Bruhl&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span><span class="w">                </span><span class="s2">&quot;Chris Hemsworth&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="22 "></span><span class="w">                </span><span class="s2">&quot;Olivia Wilde&quot;</span>
<span class="linenos" data-linenos="23 "></span><span class="w">            </span><span class="p">]</span>
<span class="linenos" data-linenos="24 "></span><span class="w">        </span><span class="p">}</span>
<span class="linenos" data-linenos="25 "></span><span class="w">    </span><span class="p">},</span>
<span class="linenos" data-linenos="26 "></span><span class="p">]</span>
</code></pre></div>
<p>Como los años de las películas permiten particionar de manera más o menos equilibrada los datos, en la mejor candidata para clave de particionado. Como sí que habrá varias películas en el mismo año, elegimos el título como clave de ordenación, provocando que los documentos tengan una clave compuesta.</p>
<p>Así pues, vamos a nombrar nuestra tabla como <code>SeveroPeliculas</code> y ponemos como clave de partición el atributo <code>year</code> de tipo numérico, y como clave de ordenación <code>title</code> de tipo cadena.</p>
<figure style="align: center;">
    <img src="images/06ddCrearTabla.png">
    <figcaption>Creación de la tabla SeveroPeliculas</figcaption>
</figure>

<p>Una vez creada la tabla, vamos a ver cómo podemos cargar los datos. Haciendo uso de la librería <em>boto3</em> vamos a crear el archivo <code>cargarDatosPeliculas.py</code>:</p>
<div class="highlight"><span class="filename">cargarDatosPeliculas.py</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos" data-linenos=" 3 "></span><span class="kn">import</span> <span class="nn">decimal</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span> <span class="c1"># (1)</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">tabla</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;SeveroPeliculas&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;datosPeliculas.json&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ficheroJSON</span><span class="p">:</span>
<span class="linenos" data-linenos="10 "></span>    <span class="n">peliculas</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ficheroJSON</span><span class="p">,</span> <span class="n">parse_float</span><span class="o">=</span><span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">)</span>
<span class="linenos" data-linenos="11 "></span>    <span class="k">for</span> <span class="n">pelicula</span> <span class="ow">in</span> <span class="n">peliculas</span><span class="p">:</span>
<span class="linenos" data-linenos="12 "></span>        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">pelicula</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>
<span class="linenos" data-linenos="13 "></span>        <span class="n">title</span> <span class="o">=</span> <span class="n">pelicula</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span>
<span class="linenos" data-linenos="14 "></span>        <span class="n">info</span> <span class="o">=</span> <span class="n">pelicula</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">]</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Añadida película:&quot;</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">title</span><span class="p">)</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span>        <span class="n">tabla</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span>
<span class="linenos" data-linenos="19 "></span>            <span class="n">Item</span><span class="o">=</span><span class="p">{</span>
<span class="linenos" data-linenos="20 "></span>                <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span>                <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
<span class="linenos" data-linenos="22 "></span>                <span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">info</span><span class="p">,</span>
<span class="linenos" data-linenos="23 "></span>            <span class="p">}</span>
<span class="linenos" data-linenos="24 "></span>        <span class="p">)</span>
</code></pre></div>
<ol>
<li>Nos conectamos a la región e indicamos que vamos a utilizar el servicio de <em>DynamoDB</em></li>
</ol>
<p>Si lo ejecutamos desde nuestro ordenador, nos aparecerá por la consola cada una de las películas insertadas.</p>
<div class="admonition caution">
<p class="admonition-title">Float y boto3</p>
<p>Mucho cuidado con boto3 y <em>DynamoDB</em>, ya que los tipos <code>Float</code> no están soportados, y en cambio, hemos de utilizar el tipo <code>Decimal</code>.</p>
</div>
<h3 id="faker">Faker<a class="headerlink" href="#faker" title="Permanent link">&para;</a></h3>
<p>Si necesitamos escribir muchos datos, es muy útil emplear una librería como <a href="https://faker.readthedocs.io/en/master/">Faker</a> para generar datos sintéticos.</p>
<p>Primero hemos de instalarla mediante pip:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>pip3<span class="w"> </span>install<span class="w"> </span>faker
</code></pre></div>
<p>Vamos a realizar un ejemplo para mostrar algunos datos aleatorios y comprobar su funcionamiento:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Código</label><label for="__tabbed_1_2">Resultado</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><span class="filename">holaFaker.py</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">()</span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">(</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span>   <span class="c1"># cambiamos el locale a español</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nombre:&quot;</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">())</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dirección:&quot;</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">address</span><span class="p">())</span>
<span class="linenos" data-linenos=" 8 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nombre de hombre:&quot;</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name_male</span><span class="p">())</span>
<span class="linenos" data-linenos=" 9 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Número de teléfono:&quot;</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">phone_number</span><span class="p">())</span>
<span class="linenos" data-linenos="10 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Color:&quot;</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">color_name</span><span class="p">())</span>
<span class="linenos" data-linenos="11 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fecha:&quot;</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
<span class="linenos" data-linenos="12 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Email:&quot;</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">email</span><span class="p">())</span>
<span class="linenos" data-linenos="13 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frase de 10 palabras&quot;</span><span class="p">,</span> <span class="n">fake</span><span class="o">.</span><span class="n">sentence</span><span class="p">(</span><span class="n">nb_words</span><span class="o">=</span><span class="mi">10</span><span class="p">))</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="go">Nombre: Dani Pla Chico</span>
<span class="linenos" data-linenos="2 "></span><span class="go">Dirección: Cuesta de Emiliano Milla 66</span>
<span class="linenos" data-linenos="3 "></span><span class="go">Albacete, 83227</span>
<span class="linenos" data-linenos="4 "></span><span class="go">Nombre de hombre: Matías</span>
<span class="linenos" data-linenos="5 "></span><span class="go">Número de teléfono: +34 818 779 827</span>
<span class="linenos" data-linenos="6 "></span><span class="go">Color: Salmón oscuro</span>
<span class="linenos" data-linenos="7 "></span><span class="go">Fecha: 1984-09-29</span>
<span class="linenos" data-linenos="8 "></span><span class="go">Email: btome@example.net</span>
<span class="linenos" data-linenos="9 "></span><span class="go">Frase de 10 palabras Perferendis saepe consequatur saepe sapiente est impedit eaque omnis temporibus excepturi repellat ducimus.</span>
</code></pre></div>
</div>
</div>
</div>
<p>Los diferentes grupos de datos que genera se agrupan en <em>Providers</em>: de dirección, fechas, relacionados con internet, bancarios, códigos de barra, isbn, etc... Se recomienda consultar la documentación en <a href="https://faker.readthedocs.io/en/master/providers.html">https://faker.readthedocs.io/en/master/providers.html</a>.</p>
<div class="admonition caution">
<p class="admonition-title">Locale ES</p>
<p>Al trabajar con el idioma en español, puede que algunos métodos no funcionen (más que no funcionar, posiblemente tengan otro nombre). Es recomendable comprobar las opciones disponibles en <a href="https://faker.readthedocs.io/en/master/locales/es_ES.html">https://faker.readthedocs.io/en/master/locales/es_ES.html</a></p>
</div>
<h4 id="generando-csv">Generando CSV<a class="headerlink" href="#generando-csv" title="Permanent link">&para;</a></h4>
<p>Vamos a generar un CSV con datos de 1000 personas. Primero creamos una lista con los encabezados y los escribimos en el fichero, para posteriormente, línea a línea, generar los datos de cada persona:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Código</label><label for="__tabbed_2_2">Resultado</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><span class="filename">generaCSV.py</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;datosFaker.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">(</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span>   <span class="c1"># cambiamos el locale a español</span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">header</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nombre&#39;</span><span class="p">,</span> <span class="s1">&#39;edad&#39;</span><span class="p">,</span> <span class="s1">&#39;calle&#39;</span><span class="p">,</span> <span class="s1">&#39;ciudad&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="s1">&#39;provincia&#39;</span><span class="p">,</span> <span class="s1">&#39;cp&#39;</span><span class="p">,</span> <span class="s1">&#39;longitud&#39;</span><span class="p">,</span> <span class="s1">&#39;latitud&#39;</span><span class="p">]</span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">mywriter</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="linenos" data-linenos="10 "></span><span class="n">mywriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
<span class="linenos" data-linenos="13 "></span>    <span class="n">mywriter</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span>
<span class="linenos" data-linenos="14 "></span>                    <span class="n">fake</span><span class="o">.</span><span class="n">random_int</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="linenos" data-linenos="15 "></span>                    <span class="n">fake</span><span class="o">.</span><span class="n">street_address</span><span class="p">(),</span>
<span class="linenos" data-linenos="16 "></span>                    <span class="n">fake</span><span class="o">.</span><span class="n">city</span><span class="p">(),</span>
<span class="linenos" data-linenos="17 "></span>                    <span class="n">fake</span><span class="o">.</span><span class="n">state</span><span class="p">(),</span>
<span class="linenos" data-linenos="18 "></span>                    <span class="n">fake</span><span class="o">.</span><span class="n">postcode</span><span class="p">(),</span>
<span class="linenos" data-linenos="19 "></span>                    <span class="n">fake</span><span class="o">.</span><span class="n">longitude</span><span class="p">(),</span>
<span class="linenos" data-linenos="20 "></span>                    <span class="n">fake</span><span class="o">.</span><span class="n">latitude</span><span class="p">()])</span>
<span class="linenos" data-linenos="21 "></span><span class="n">output</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><span class="filename">datosFaker.csv</span><pre><span></span><code><span class="linenos" data-linenos="1 "></span>nombre,edad,calle,ciudad,provincia,cp,longitud,latitud
<span class="linenos" data-linenos="2 "></span>Jenaro Verdú Suarez,26,Urbanización Mohamed Vallés 122,Sevilla,Guipúzcoa,73198,2.657719,-69.679293
<span class="linenos" data-linenos="3 "></span>Eugenio Calzada Revilla,57,Camino Vanesa Amor 36 Piso 9 ,Huesca,Álava,75590,34.041399,-52.924628
<span class="linenos" data-linenos="4 "></span>Flavio del Lumbreras,76,Avenida de Beatriz Amaya 92,Ciudad,Murcia,86420,58.248903,-17.924926
</code></pre></div>
</div>
</div>
</div>
<h4 id="generando-json">Generando JSON<a class="headerlink" href="#generando-json" title="Permanent link">&para;</a></h4>
<p>Y a continuación repetimos el mismo ejemplo, pero ahora generando un documento JSON. La principal diferencia es que primero vamos a rellenar un diccionario con toda la información, y luego persistimos el diccionario:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Código</label><label for="__tabbed_3_2">Resultado</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><span class="filename">generaJSON.py</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">from</span> <span class="nn">faker</span> <span class="kn">import</span> <span class="n">Faker</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">fake</span> <span class="o">=</span> <span class="n">Faker</span><span class="p">(</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span>   <span class="c1"># cambiamos el locale a español</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="c1"># Preparamos los datos</span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">datos</span> <span class="o">=</span> <span class="p">{}</span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">datos</span><span class="p">[</span><span class="s1">&#39;registros&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
<span class="linenos" data-linenos="11 "></span>    <span class="n">persona</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;datos&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span>
<span class="linenos" data-linenos="12 "></span>            <span class="s2">&quot;edad&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">random_int</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="linenos" data-linenos="13 "></span>            <span class="s2">&quot;calle&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">street_address</span><span class="p">(),</span>
<span class="linenos" data-linenos="14 "></span>            <span class="s2">&quot;ciudad&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">city</span><span class="p">(),</span>
<span class="linenos" data-linenos="15 "></span>            <span class="s2">&quot;provincia&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">state</span><span class="p">(),</span>
<span class="linenos" data-linenos="16 "></span>            <span class="s2">&quot;cp&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">postcode</span><span class="p">(),</span>
<span class="linenos" data-linenos="17 "></span>            <span class="s2">&quot;longitud&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">longitude</span><span class="p">()),</span>
<span class="linenos" data-linenos="18 "></span>            <span class="s2">&quot;latitud&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">fake</span><span class="o">.</span><span class="n">latitude</span><span class="p">())}</span>
<span class="linenos" data-linenos="19 "></span>    <span class="n">datos</span><span class="p">[</span><span class="s1">&#39;registros&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">persona</span><span class="p">)</span>
<span class="linenos" data-linenos="20 "></span>
<span class="linenos" data-linenos="21 "></span><span class="c1"># Los metemos en el fichero</span>
<span class="linenos" data-linenos="22 "></span><span class="n">output</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;datosFaker.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="23 "></span><span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">datos</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><span class="filename">datosFaker.json</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="p">{</span>
<span class="linenos" data-linenos=" 2 "></span><span class="w">    </span><span class="nt">&quot;registros&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos" data-linenos=" 3 "></span><span class="w">        </span><span class="p">{</span>
<span class="linenos" data-linenos=" 4 "></span><span class="w">            </span><span class="nt">&quot;datos&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Merche Moreno Roman&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 5 "></span><span class="w">            </span><span class="nt">&quot;edad&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">51</span><span class="p">,</span>
<span class="linenos" data-linenos=" 6 "></span><span class="w">            </span><span class="nt">&quot;calle&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Paseo Amelia Folch 967&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span><span class="w">            </span><span class="nt">&quot;ciudad&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Segovia&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span><span class="w">            </span><span class="nt">&quot;provincia&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;M\u00e1laga&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span><span class="w">            </span><span class="nt">&quot;cp&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;71721&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span><span class="w">            </span><span class="nt">&quot;longitud&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">84.603801</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span><span class="w">            </span><span class="nt">&quot;latitud&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">58.941349</span>
<span class="linenos" data-linenos="12 "></span><span class="w">        </span><span class="p">},</span>
<span class="linenos" data-linenos="13 "></span><span class="w">        </span><span class="p">{</span>
<span class="linenos" data-linenos="14 "></span><span class="w">            </span><span class="nt">&quot;datos&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Miguel Abascal Sanz&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="15 "></span><span class="w">            </span><span class="nt">&quot;edad&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">21</span><span class="p">,</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="caso-de-uso-2-consultar-datos-en-dynamodb">Caso de uso 2 - Consultar datos en DynamoDB<a class="headerlink" href="#caso-de-uso-2-consultar-datos-en-dynamodb" title="Permanent link">&para;</a></h3>
<p>Una vez tenemos nuestra tabla de <em>DynamoDB</em> cargada con datos, llega el momento de recuperar los datos, ya sea un registro en concreto o la posibilidad de realizar una consulta, ya sea por su índice o su clave de ordenación (o ambas).</p>
<p>En el apartado anterior hemos estudiado que podemos realizar consultas sobre <em>DynamoDB</em> haciendo uso de un subconjunto de SQL conocido como PartiQL. En los siguientes ejemplos vamos a mostrar cómo realizar las operaciones vía el API de <em>DynamoDb</em> y mediante <em>PartiQL</em>.</p>
<p>Si queremos recuperar la película <em>Interstellar</em> de 2014 haremos:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:3"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><input id="__tabbed_4_3" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Mediante <code>get_item</code></label><label for="__tabbed_4_2">Mediante <code>get_item</code> con excepciones</label><label for="__tabbed_4_3">Mediante PartiQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><span class="filename">dynamodb_getitem.py</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">tabla</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;SeveroPeliculas&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Interstellar&quot;</span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">year</span> <span class="o">=</span> <span class="mi">2014</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">response</span> <span class="o">=</span> <span class="n">tabla</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span>
<span class="linenos" data-linenos="10 "></span>        <span class="n">Key</span><span class="o">=</span><span class="p">{</span>
<span class="linenos" data-linenos="11 "></span>            <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span>            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span>
<span class="linenos" data-linenos="13 "></span>        <span class="p">},</span>
<span class="linenos" data-linenos="14 "></span>        <span class="n">ProjectionExpression</span><span class="o">=</span><span class="s2">&quot;title, info.plot&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span><span class="n">item</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Item&#39;</span><span class="p">]</span>
<span class="linenos" data-linenos="16 "></span><span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><span class="filename">dynamodb_getitem_exc.py</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">from</span> <span class="nn">botocore.exceptions</span> <span class="kn">import</span> <span class="n">ClientError</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">tabla</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;SeveroPeliculas&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 6 "></span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Interstellar&quot;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">year</span> <span class="o">=</span> <span class="mi">2014</span>
<span class="linenos" data-linenos=" 9 "></span>
<span class="linenos" data-linenos="10 "></span><span class="c1"># Recupera una película</span>
<span class="linenos" data-linenos="11 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------ Datos de Interstellar&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="12 "></span><span class="k">try</span><span class="p">:</span>
<span class="linenos" data-linenos="13 "></span>    <span class="n">response</span> <span class="o">=</span> <span class="n">tabla</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span>
<span class="linenos" data-linenos="14 "></span>        <span class="n">Key</span><span class="o">=</span><span class="p">{</span>
<span class="linenos" data-linenos="15 "></span>            <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">year</span><span class="p">,</span>
<span class="linenos" data-linenos="16 "></span>            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">title</span>
<span class="linenos" data-linenos="17 "></span>        <span class="p">},</span>
<span class="linenos" data-linenos="18 "></span>        <span class="n">ProjectionExpression</span><span class="o">=</span><span class="s2">&quot;title, info.plot&quot;</span>
<span class="linenos" data-linenos="19 "></span>    <span class="p">)</span>
<span class="linenos" data-linenos="20 "></span><span class="k">except</span> <span class="n">ClientError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos" data-linenos="21 "></span>    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Error&#39;</span><span class="p">][</span><span class="s1">&#39;Message&#39;</span><span class="p">])</span>
<span class="linenos" data-linenos="22 "></span><span class="k">else</span><span class="p">:</span>
<span class="linenos" data-linenos="23 "></span>    <span class="n">item</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Item&#39;</span><span class="p">]</span>
<span class="linenos" data-linenos="24 "></span>    <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><span class="filename">dynamodb_select.py</span><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos=" 2 "></span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">clientDDB</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1"># Recupera una película con PartiQL</span>
<span class="linenos" data-linenos=" 6 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------ Datos de Interstellar mediante PartiQL&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">resp</span> <span class="o">=</span> <span class="n">clientDDB</span><span class="o">.</span><span class="n">execute_statement</span><span class="p">(</span>
<span class="linenos" data-linenos=" 8 "></span>    <span class="n">Statement</span><span class="o">=</span><span class="s2">&quot;SELECT title, info.plot FROM SeveroPeliculas WHERE year = 2014 and title=&#39;Interstellar&#39;&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">item</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos" data-linenos="10 "></span><span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Interstellar&quot;</span>
<span class="linenos" data-linenos="13 "></span><span class="n">year</span> <span class="o">=</span> <span class="mi">2014</span>
<span class="linenos" data-linenos="14 "></span><span class="c1"># Recupera una película con PartiQL con parámetros indicados mediante ?</span>
<span class="linenos" data-linenos="15 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------ Datos de Interstellar mediante PartiQL con parámetros&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="16 "></span><span class="n">resp</span> <span class="o">=</span> <span class="n">clientDDB</span><span class="o">.</span><span class="n">execute_statement</span><span class="p">(</span><span class="n">Statement</span><span class="o">=</span><span class="s1">&#39;SELECT * FROM SeveroPeliculas WHERE year = ? AND title = ?&#39;</span><span class="p">,</span>
<span class="linenos" data-linenos="17 "></span>                                    <span class="n">Parameters</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)},</span> <span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">}])</span>
<span class="linenos" data-linenos="18 "></span><span class="n">item</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="linenos" data-linenos="19 "></span><span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>
<p>En el caso de las <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/dynamodb.html#DynamoDB.Client.execute_statement">consultas mediante PartiQL haciendo uso de <code>execute_statement</code></a> conviene destacar que:</p>
<ul>
<li>Las consultas son <em>case sensitive</em>.</li>
<li>Los parámetros se indican mediante <code>?</code></li>
<li>Los contenidos de los parámetros se indican mediante una lista con un diccionario por cada parámetro donde la clave es el tipo del parámetro, y el valor es el dato a pasar (el dato se pasa siempre como un <code>string</code>)</li>
<li>Las consultas siempre devuelven un diccionario con una propiedad <code>Items</code> que contiene los resultados devueltos.</li>
</ul>
<p>Destacar que es diferente la estructura del resultado de realizar una consulta mediante el API de <em>DynamoDB</em> (respeta la estructura definida en la base de datos) o mediante <em>PartiQL</em> (crea un atributo por columna recuperada cuyo valor contiene el tipo del dato):</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Resultado de <code>get-item</code></label><label for="__tabbed_5_2">Resultado de <em>PartiQL</em></label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="err">&#39;i</span><span class="kc">nf</span><span class="err">o&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;plo</span><span class="kc">t</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;A</span><span class="w"> </span><span class="err">group</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="w"> </span><span class="err">explorers</span><span class="w"> </span><span class="err">make</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="kc">ne</span><span class="err">wly</span><span class="w"> </span><span class="err">discovered</span><span class="w"> </span><span class="err">wormhole</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">surpass</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">limi</span><span class="kc">tat</span><span class="err">io</span><span class="kc">ns</span><span class="w"> </span><span class="err">o</span><span class="kc">n</span><span class="w"> </span><span class="err">huma</span><span class="kc">n</span><span class="w"> </span><span class="err">space</span><span class="w"> </span><span class="kc">tra</span><span class="err">vel</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">co</span><span class="kc">n</span><span class="err">quer</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">vas</span><span class="kc">t</span><span class="w"> </span><span class="err">dis</span><span class="kc">tan</span><span class="err">ces</span><span class="w"> </span><span class="err">i</span><span class="kc">n</span><span class="err">volved</span><span class="w"> </span><span class="err">i</span><span class="kc">n</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="w"> </span><span class="err">i</span><span class="kc">nterstellar</span><span class="w"> </span><span class="err">voyage.&#39;</span><span class="p">},</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="err">&#39;</span><span class="kc">t</span><span class="err">i</span><span class="kc">tle</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;I</span><span class="kc">nterstellar</span><span class="err">&#39;</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="p">{</span>
<span class="linenos" data-linenos="2 "></span><span class="w">    </span><span class="err">&#39;</span><span class="kc">t</span><span class="err">i</span><span class="kc">tle</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;S&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;I</span><span class="kc">nterstellar</span><span class="err">&#39;</span><span class="p">},</span>
<span class="linenos" data-linenos="3 "></span><span class="w">    </span><span class="err">&#39;plo</span><span class="kc">t</span><span class="err">&#39;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="err">&#39;S&#39;</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;A</span><span class="w"> </span><span class="err">group</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="w"> </span><span class="err">explorers</span><span class="w"> </span><span class="err">make</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">o</span><span class="kc">f</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="kc">ne</span><span class="err">wly</span><span class="w"> </span><span class="err">discovered</span><span class="w"> </span><span class="err">wormhole</span><span class="w"> </span><span class="kc">t</span><span class="err">o</span><span class="w"> </span><span class="err">surpass</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">limi</span><span class="kc">tat</span><span class="err">io</span><span class="kc">ns</span><span class="w"> </span><span class="err">o</span><span class="kc">n</span><span class="w"> </span><span class="err">huma</span><span class="kc">n</span><span class="w"> </span><span class="err">space</span><span class="w"> </span><span class="kc">tra</span><span class="err">vel</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="err">d</span><span class="w"> </span><span class="err">co</span><span class="kc">n</span><span class="err">quer</span><span class="w"> </span><span class="kc">t</span><span class="err">he</span><span class="w"> </span><span class="err">vas</span><span class="kc">t</span><span class="w"> </span><span class="err">dis</span><span class="kc">tan</span><span class="err">ces</span><span class="w"> </span><span class="err">i</span><span class="kc">n</span><span class="err">volved</span><span class="w"> </span><span class="err">i</span><span class="kc">n</span><span class="w"> </span><span class="err">a</span><span class="kc">n</span><span class="w"> </span><span class="err">i</span><span class="kc">nterstellar</span><span class="w"> </span><span class="err">voyage.&#39;</span><span class="p">}</span>
<span class="linenos" data-linenos="4 "></span><span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>También podemos realizar otro tipo de consultas:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Películas de 2016 mediante <code>query</code></label><label for="__tabbed_6_2">Películas cuyo título esté entre la A y la L</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">from</span> <span class="nn">boto3.dynamodb.conditions</span> <span class="kn">import</span> <span class="n">Key</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="c1"># Mediante query</span>
<span class="linenos" data-linenos=" 5 "></span><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 6 "></span><span class="n">tabla</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;SeveroPeliculas&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 7 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----Películas de 2016&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">resp</span> <span class="o">=</span> <span class="n">tabla</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">KeyConditionExpression</span><span class="o">=</span><span class="n">Key</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="mi">2016</span><span class="p">))</span>
<span class="linenos" data-linenos=" 9 "></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]:</span>
<span class="linenos" data-linenos="10 "></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="c1"># Mediante PartiQL</span>
<span class="linenos" data-linenos="13 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----Películas de 2016 con PartiQL&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span><span class="n">clientDDB</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span><span class="n">resp</span> <span class="o">=</span> <span class="n">clientDDB</span><span class="o">.</span><span class="n">execute_statement</span><span class="p">(</span>
<span class="linenos" data-linenos="16 "></span>    <span class="n">Statement</span><span class="o">=</span><span class="s2">&quot;SELECT title, year FROM SeveroPeliculas WHERE year = 2016&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="17 "></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]:</span>
<span class="linenos" data-linenos="18 "></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos" data-linenos=" 3 "></span><span class="kn">import</span> <span class="nn">decimal</span>
<span class="linenos" data-linenos=" 4 "></span><span class="kn">from</span> <span class="nn">boto3.dynamodb.conditions</span> <span class="kn">import</span> <span class="n">Key</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">class</span> <span class="nc">DecimalEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">):</span>
<span class="linenos" data-linenos=" 9 "></span>            <span class="k">if</span> <span class="n">o</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos" data-linenos="10 "></span>                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="linenos" data-linenos="11 "></span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos" data-linenos="12 "></span>                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DecimalEncoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="n">anyo</span> <span class="o">=</span> <span class="mi">2016</span>
<span class="linenos" data-linenos="16 "></span><span class="n">letraInicial</span> <span class="o">=</span> <span class="s2">&quot;A&quot;</span>
<span class="linenos" data-linenos="17 "></span><span class="n">letraFinal</span> <span class="o">=</span> <span class="s2">&quot;F&quot;</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="20 "></span><span class="n">tabla</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;SeveroPeliculas&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="21 "></span>
<span class="linenos" data-linenos="22 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----Películas de 2016 cuyo título empieza desde A hasta L&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="23 "></span><span class="n">resp</span> <span class="o">=</span> <span class="n">tabla</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
<span class="linenos" data-linenos="24 "></span>    <span class="n">ProjectionExpression</span><span class="o">=</span><span class="s2">&quot;#yr, title, info.genres, info.actors[0]&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="25 "></span>    <span class="c1"># year es una palabra clave, por tanto necesitamos crear un alias</span>
<span class="linenos" data-linenos="26 "></span>    <span class="n">ExpressionAttributeNames</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;#yr&quot;</span><span class="p">:</span> <span class="s2">&quot;year&quot;</span><span class="p">},</span>
<span class="linenos" data-linenos="27 "></span>    <span class="n">KeyConditionExpression</span><span class="o">=</span><span class="n">Key</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">anyo</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Key</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">letraInicial</span><span class="p">,</span> <span class="n">letraFinal</span><span class="p">)</span>
<span class="linenos" data-linenos="28 "></span><span class="p">)</span>
<span class="linenos" data-linenos="29 "></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]:</span>
<span class="linenos" data-linenos="30 "></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos" data-linenos="31 "></span>    <span class="c1"># {&#39;info&#39;: {&#39;actors&#39;: [&#39;Zoe Saldana&#39;], &#39;genres&#39;: [&#39;Action&#39;, &#39;Adventure&#39;, &#39;Fantasy&#39;, &#39;Sci-Fi&#39;]}, &#39;year&#39;: Decimal(&#39;2016&#39;), &#39;title&#39;: &#39;Avatar 2&#39;}</span>
<span class="linenos" data-linenos="32 "></span>    <span class="c1"># Transforma los valores numéricos de Decimal a Number</span>
<span class="linenos" data-linenos="33 "></span>    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">DecimalEncoder</span><span class="p">))</span>
<span class="linenos" data-linenos="34 "></span>    <span class="c1"># {&quot;info&quot;: {&quot;actors&quot;: [&quot;Zoe Saldana&quot;], &quot;genres&quot;: [&quot;Action&quot;, &quot;Adventure&quot;, &quot;Fantasy&quot;, &quot;Sci-Fi&quot;]}, &quot;year&quot;: 2016, &quot;title&quot;: &quot;Avatar 2&quot;}</span>
<span class="linenos" data-linenos="35 "></span>    <span class="k">for</span> <span class="n">genero</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;info&#39;</span><span class="p">][</span><span class="s1">&#39;genres&#39;</span><span class="p">]:</span>
<span class="linenos" data-linenos="36 "></span>        <span class="nb">print</span><span class="p">(</span><span class="n">genero</span><span class="p">)</span>
<span class="linenos" data-linenos="37 "></span>
<span class="linenos" data-linenos="38 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----Películas de 2016 cuyo título empieza desde A hasta L con PartiQL&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="39 "></span><span class="n">clientDDB</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="40 "></span><span class="n">consulta</span> <span class="o">=</span> <span class="s1">&#39;SELECT year, title, info.genres, info.actors[0] FROM SeveroPeliculas WHERE year = ? AND title between ? and ?&#39;</span>
<span class="linenos" data-linenos="41 "></span><span class="n">resp</span> <span class="o">=</span> <span class="n">clientDDB</span><span class="o">.</span><span class="n">execute_statement</span><span class="p">(</span><span class="n">Statement</span><span class="o">=</span><span class="n">consulta</span><span class="p">,</span>
<span class="linenos" data-linenos="42 "></span>                                <span class="n">Parameters</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">anyo</span><span class="p">)},</span> <span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="n">letraInicial</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;S&#39;</span><span class="p">:</span> <span class="n">letraFinal</span><span class="p">}])</span>
<span class="linenos" data-linenos="43 "></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]:</span>
<span class="linenos" data-linenos="44 "></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="linenos" data-linenos="45 "></span>    <span class="c1"># [{&#39;year&#39;: {&#39;N&#39;: &#39;2016&#39;}, &#39;title&#39;: {&#39;S&#39;: &#39;Avatar 2&#39;}, &#39;actors[0]&#39;: {&#39;S&#39;: &#39;Zoe Saldana&#39;}, &#39;genres&#39;: {&#39;L&#39;: [{&#39;S&#39;: &#39;Action&#39;}, {&#39;S&#39;: &#39;Adventure&#39;}, {&#39;S&#39;: &#39;Fantasy&#39;}, {&#39;S&#39;: &#39;Sci-Fi&#39;}]}}]</span>
<span class="linenos" data-linenos="46 "></span>    <span class="k">for</span> <span class="n">genero</span> <span class="ow">in</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;genres&#39;</span><span class="p">][</span><span class="s1">&#39;L&#39;</span><span class="p">]:</span>
<span class="linenos" data-linenos="47 "></span>        <span class="nb">print</span><span class="p">(</span><span class="n">genero</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
</code></pre></div>
</div>
</div>
</div>
<p>La clase <code>DecimalEncoder</code> se utiliza para transformar los campos <code>Decimal</code> que utiliza <em>DynamoDB</em> para almacenar contenido numérico a tipo entero o flotante según necesite.</p>
<h4 id="full-scan">Full scan<a class="headerlink" href="#full-scan" title="Permanent link">&para;</a></h4>
<p>Cuando en <em>PartiQL</em> no le indicamos en la condición una expresión que busque por una de las claves, se realizará un <em>full scan</em> sobre toda la tabla, lo que puede implicar unos costes inesperados, tanto económicos como a nivel rendimiento.</p>
<p>El método <code>scan</code> lee cada elemento de la tabla y devuelve todos los datos de la tabla. Se le puede pasar una <code>filter_expression</code> opcional para que sólo devuelva los elementos que cumplan el criterio. Sin embargo, el filtrado se aplica tras escanear toda la tabla.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Ejemplo scan</label><label for="__tabbed_7_2">Full scan con PartiQL</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos" data-linenos=" 3 "></span><span class="kn">import</span> <span class="nn">decimal</span>
<span class="linenos" data-linenos=" 4 "></span><span class="kn">from</span> <span class="nn">boto3.dynamodb.conditions</span> <span class="kn">import</span> <span class="n">Key</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">class</span> <span class="nc">DecimalEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">decimal</span><span class="o">.</span><span class="n">Decimal</span><span class="p">):</span>
<span class="linenos" data-linenos=" 9 "></span>            <span class="k">if</span> <span class="n">o</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos" data-linenos="10 "></span>                <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="linenos" data-linenos="11 "></span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos" data-linenos="12 "></span>                <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="linenos" data-linenos="13 "></span>        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">DecimalEncoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span>
<span class="linenos" data-linenos="15 "></span><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="16 "></span><span class="n">tabla</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;SeveroPeliculas&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="17 "></span>
<span class="linenos" data-linenos="18 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----Películas de sobresaliente mediante full scan&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="19 "></span><span class="c1"># Escaneo y filtrado</span>
<span class="linenos" data-linenos="20 "></span><span class="n">fe</span> <span class="o">=</span> <span class="n">Key</span><span class="p">(</span><span class="s1">&#39;info.rating&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gte</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="linenos" data-linenos="21 "></span><span class="n">pe</span> <span class="o">=</span> <span class="s2">&quot;#yr, title, info.rating&quot;</span>
<span class="linenos" data-linenos="22 "></span><span class="n">ean</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;#yr&quot;</span><span class="p">:</span> <span class="s2">&quot;year&quot;</span><span class="p">}</span>
<span class="linenos" data-linenos="23 "></span><span class="n">resp</span> <span class="o">=</span> <span class="n">tabla</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span>
<span class="linenos" data-linenos="24 "></span>    <span class="n">FilterExpression</span><span class="o">=</span><span class="n">fe</span><span class="p">,</span>
<span class="linenos" data-linenos="25 "></span>    <span class="n">ProjectionExpression</span><span class="o">=</span><span class="n">pe</span><span class="p">,</span>
<span class="linenos" data-linenos="26 "></span>    <span class="n">ExpressionAttributeNames</span><span class="o">=</span><span class="n">ean</span>
<span class="linenos" data-linenos="27 "></span><span class="p">)</span>
<span class="linenos" data-linenos="28 "></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]:</span>
<span class="linenos" data-linenos="29 "></span>    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">DecimalEncoder</span><span class="p">))</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos="2 "></span><span class="kn">from</span> <span class="nn">boto3.dynamodb.conditions</span> <span class="kn">import</span> <span class="n">Key</span>
<span class="linenos" data-linenos="3 "></span>
<span class="linenos" data-linenos="4 "></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-----Películas de 2016 con PartiQL&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="5 "></span><span class="n">clientDDB</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="6 "></span><span class="n">resp</span> <span class="o">=</span> <span class="n">clientDDB</span><span class="o">.</span><span class="n">execute_statement</span><span class="p">(</span>
<span class="linenos" data-linenos="7 "></span>    <span class="n">Statement</span><span class="o">=</span><span class="s2">&quot;SELECT title, year, info.rating FROM SeveroPeliculas WHERE info.rating &gt;= 9&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="8 "></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">resp</span><span class="p">[</span><span class="s1">&#39;Items&#39;</span><span class="p">]:</span>
<span class="linenos" data-linenos="9 "></span>    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">][</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">][</span><span class="s1">&#39;S&#39;</span><span class="p">])</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="caso-de-uso-3-de-s3-a-dynamodb">Caso de uso 3 - De S3 a DynamoDB<a class="headerlink" href="#caso-de-uso-3-de-s3-a-dynamodb" title="Permanent link">&para;</a></h3>
<p>En la sesión de S3 trabajamos con Python con un dataset de películas, el cual filtramos mediante <a href="03s3.html#s3-select">S3Select</a> y nos quedamos con el título, la nota media y la trama siempre y cuando hayan recibido al menos 10.000 votos, el cual almacenamos en <code>TMDb_filtered.csv</code>.</p>
<p>Una vez creado el fichero en S3, vamos cargar los datos en DynamoDB. Como el dataset no contenía la fecha de la película, en nuestro caso le vamos a poner a todas las películas que son del 2022:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="linenos" data-linenos=" 3 "></span><span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1"># 1.- Leemos el fichero desde S3 y lo metemos en un DataFrame</span>
<span class="linenos" data-linenos=" 6 "></span><span class="n">s3c</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">bucketNombre</span> <span class="o">=</span> <span class="s2">&quot;s3severo2122python&quot;</span>
<span class="linenos" data-linenos=" 8 "></span><span class="n">ficheroNombre</span> <span class="o">=</span> <span class="s2">&quot;TMDb_filtered.csv&quot;</span>
<span class="linenos" data-linenos=" 9 "></span><span class="n">response</span> <span class="o">=</span> <span class="n">s3c</span><span class="o">.</span><span class="n">get_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucketNombre</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">ficheroNombre</span><span class="p">)</span>
<span class="linenos" data-linenos="10 "></span><span class="n">movies_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;Body&#39;</span><span class="p">],</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="11 "></span>
<span class="linenos" data-linenos="12 "></span><span class="c1"># 2.- Nos conectamos a DynamoDB</span>
<span class="linenos" data-linenos="13 "></span><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span><span class="n">tabla</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;SeveroPeliculas&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="c1"># 3.- Lo metemos en DynamoDB mediante un batch</span>
<span class="linenos" data-linenos="17 "></span><span class="k">with</span> <span class="n">tabla</span><span class="o">.</span><span class="n">batch_writer</span><span class="p">()</span> <span class="k">as</span> <span class="n">batch</span><span class="p">:</span>
<span class="linenos" data-linenos="18 "></span>    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">fila</span> <span class="ow">in</span> <span class="n">movies_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<span class="linenos" data-linenos="19 "></span>        <span class="n">Item</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos" data-linenos="20 "></span>            <span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="mi">2022</span><span class="p">,</span>
<span class="linenos" data-linenos="21 "></span>            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">fila</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]),</span>
<span class="linenos" data-linenos="22 "></span>            <span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos" data-linenos="23 "></span>                <span class="s1">&#39;plot&#39;</span> <span class="p">:</span> <span class="n">fila</span><span class="p">[</span><span class="s1">&#39;overview&#39;</span><span class="p">],</span>
<span class="linenos" data-linenos="24 "></span>                <span class="s1">&#39;rating&#39;</span> <span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">fila</span><span class="p">[</span><span class="s1">&#39;vote_average&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">&#39;1.00&#39;</span><span class="p">))</span>
<span class="linenos" data-linenos="25 "></span>            <span class="p">}</span>
<span class="linenos" data-linenos="26 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="27 "></span>        <span class="n">batch</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span><span class="n">Item</span><span class="o">=</span><span class="n">Item</span><span class="p">)</span>
</code></pre></div>
<h3 id="caso-de-uso-4-desde-rds">Caso de uso 4 - Desde RDS<a class="headerlink" href="#caso-de-uso-4-desde-rds" title="Permanent link">&para;</a></h3>
<div class="admonition tip">
<p class="admonition-title">Preparación MariaBD</p>
<p>Para estos actividades y futuras sesiones, vamos a utilizar una base de datos (<em>retail_db</em>) que contiene información sobre un comercio (clientes, productos, pedidos, etc...).</p>
<p>Para ello, descargaremos el archivo <a href="resources/create_db.sql">create_db.sql</a> con las sentencias para crear la base de datos y los datos como instrucciones SQL.</p>
<p>Tras ello, bien sea mediante <em>DBeaver</em> o si nos conectamos a <em>MariaDB</em> (<code>mariadb -u iabd -p</code>) desde la misma carpeta que hemos descargado el archivo, ejecutaremos los siguientes comando:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="k">create</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="n">retail_db</span><span class="p">;</span>
<span class="linenos" data-linenos="2 "></span><span class="n">use</span><span class="w"> </span><span class="n">retail_db</span><span class="p">;</span>
<span class="linenos" data-linenos="3 "></span><span class="k">source</span><span class="w"> </span><span class="n">create_db</span><span class="p">.</span><span class="k">sql</span><span class="p">;</span>
<span class="linenos" data-linenos="4 "></span><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="p">;</span>
</code></pre></div>
</div>
<p>Vamos a utilizar la instancia de base de datos iabd que tenemos en RDS con la base de datos <code>retail_db</code>.</p>
<h4 id="mariadbmysql-y-python">MariaDB/MySQL y Python<a class="headerlink" href="#mariadbmysql-y-python" title="Permanent link">&para;</a></h4>
<p>Para acceder a la base de datos desde Python necesitamos instalar la librería correspondiente:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span>pip3<span class="w"> </span>install<span class="w"> </span>mariadb
<span class="linenos" data-linenos="2 "></span>pip3<span class="w"> </span>install<span class="w"> </span>mysql-connector-python
</code></pre></div>
<p>Todo el código a continuación se basa en <em>MariaDB</em> como sistema gestor de base de datos. Si queremos conectarnos, debemos indicar los datos de conexion:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">mariadb</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos" data-linenos=" 3 "></span>
<span class="linenos" data-linenos=" 4 "></span><span class="k">try</span><span class="p">:</span>
<span class="linenos" data-linenos=" 5 "></span>    <span class="n">conn</span> <span class="o">=</span> <span class="n">mariadb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
<span class="linenos" data-linenos=" 6 "></span>        <span class="n">user</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;adminadmin&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="n">host</span><span class="o">=</span><span class="s2">&quot;iabd.cllw9xnmy9av.us-east-1.rds.amazonaws.com&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span>        <span class="n">database</span><span class="o">=</span><span class="s2">&quot;retail_db&quot;</span>
<span class="linenos" data-linenos="11 "></span>    <span class="p">)</span>
<span class="linenos" data-linenos="12 "></span><span class="k">except</span> <span class="n">mariadb</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos" data-linenos="13 "></span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error conectando a MariaD: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="14 "></span>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span>
<span class="linenos" data-linenos="16 "></span><span class="c1"># Obtenemos el cursor</span>
<span class="linenos" data-linenos="17 "></span><span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</code></pre></div>
<p>Una vez nos hemos conectado y tenemos abierto un cursor, ya podemos hacer consultas y recuperar datos.</p>
<p>Por ejemplo, para recuperar toda la información de los clientes almacenada en la tabla <code>customers</code>:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;select * from customers&quot;</span>
<span class="linenos" data-linenos=" 2 "></span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>
<span class="linenos" data-linenos=" 3 "></span><span class="n">resultado</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchAll</span><span class="p">()</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="c1"># Cerramos el cursor y la conexión</span>
<span class="linenos" data-linenos=" 6 "></span><span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos" data-linenos=" 7 "></span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos" data-linenos=" 8 "></span>
<span class="linenos" data-linenos=" 9 "></span><span class="c1"># Mostramos el resultado</span>
<span class="linenos" data-linenos="10 "></span><span class="nb">print</span><span class="p">(</span><span class="n">resultado</span><span class="p">)</span>
</code></pre></div>
<h4 id="de-rds-a-s3">De RDS a S3<a class="headerlink" href="#de-rds-a-s3" title="Permanent link">&para;</a></h4>
<p>Vamos a realizar otro ejemplo sencillo que recupere el nombre, apellido y email de los clientes mediante una consulta que reibe un parámetro:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">mariadb</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos" data-linenos=" 3 "></span><span class="kn">import</span> <span class="nn">json</span>
<span class="linenos" data-linenos=" 4 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos=" 5 "></span>
<span class="linenos" data-linenos=" 6 "></span><span class="k">try</span><span class="p">:</span>
<span class="linenos" data-linenos=" 7 "></span>    <span class="n">conn</span> <span class="o">=</span> <span class="n">mariadb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="n">user</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;adminadmin&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span>        <span class="n">host</span><span class="o">=</span><span class="s2">&quot;iabd.cllw9xnmy9av.us-east-1.rds.amazonaws.com&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span>        <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span>
<span class="linenos" data-linenos="12 "></span>        <span class="n">database</span><span class="o">=</span><span class="s2">&quot;retail_db&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="13 "></span><span class="k">except</span> <span class="n">mariadb</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos" data-linenos="14 "></span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error conectando a MariaDB: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="n">ciudad</span> <span class="o">=</span> <span class="s2">&quot;Brownsville&quot;</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="c1"># Obtenemos el cursor</span>
<span class="linenos" data-linenos="20 "></span><span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="linenos" data-linenos="21 "></span><span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;select customer_fname, customer_lname, customer_zipcode from customers where customer_city=?&quot;</span>
<span class="linenos" data-linenos="22 "></span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">ciudad</span><span class="p">,</span> <span class="p">))</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span><span class="c1"># Generamos un JSON con los datos</span>
<span class="linenos" data-linenos="25 "></span><span class="n">row_headers</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">cur</span><span class="o">.</span><span class="n">description</span><span class="p">]</span> 
<span class="linenos" data-linenos="26 "></span><span class="n">clientes</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="linenos" data-linenos="27 "></span><span class="n">json_data</span><span class="o">=</span><span class="p">[]</span>
<span class="linenos" data-linenos="28 "></span><span class="k">for</span> <span class="n">cliente</span> <span class="ow">in</span> <span class="n">clientes</span><span class="p">:</span>
<span class="linenos" data-linenos="29 "></span>    <span class="n">json_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">row_headers</span><span class="p">,</span><span class="n">cliente</span><span class="p">)))</span>
<span class="linenos" data-linenos="30 "></span>
<span class="linenos" data-linenos="31 "></span><span class="c1"># Cerramos el cursor y la conexión</span>
<span class="linenos" data-linenos="32 "></span><span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos" data-linenos="33 "></span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos" data-linenos="34 "></span>
<span class="linenos" data-linenos="35 "></span><span class="c1"># Persistimos el JSON en S3</span>
<span class="linenos" data-linenos="36 "></span><span class="n">s3r</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;s3&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="37 "></span><span class="nb">object</span> <span class="o">=</span> <span class="n">s3r</span><span class="o">.</span><span class="n">Object</span><span class="p">(</span><span class="s1">&#39;s3severo2122python&#39;</span><span class="p">,</span> <span class="s1">&#39;clientesRDS.json&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="38 "></span><span class="nb">object</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">Body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json_data</span><span class="p">))</span>
</code></pre></div>
<h4 id="de-rds-a-dynamodb">De RDS a DynamoDB<a class="headerlink" href="#de-rds-a-dynamodb" title="Permanent link">&para;</a></h4>
<p>Para este caso de uso, vamos a crear una nueva tabla en DynamoDB a la que llamaremos <code>SeveroClientes</code> y le pondremos como clave de particionado el campo <code>Id</code> de tipo numérico y como clave de ordenamiento el <code>Zip</code> de tipo texto.</p>
<figure style="align: center;">
    <img src="images/06ddSeveroClientes.png">
    <figcaption>Creación de la tabla SeveroClientes</figcaption>
</figure>

<p>Vamos a modificar el ejemplo anterior para que, una vez recuperado los datos de la base de datos, los almacene directamente en DynamoDB:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos=" 1 "></span><span class="kn">import</span> <span class="nn">mariadb</span>
<span class="linenos" data-linenos=" 2 "></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="linenos" data-linenos=" 3 "></span><span class="kn">import</span> <span class="nn">boto3</span>
<span class="linenos" data-linenos=" 4 "></span>
<span class="linenos" data-linenos=" 5 "></span><span class="k">try</span><span class="p">:</span>
<span class="linenos" data-linenos=" 6 "></span>    <span class="n">conn</span> <span class="o">=</span> <span class="n">mariadb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
<span class="linenos" data-linenos=" 7 "></span>        <span class="n">user</span><span class="o">=</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 8 "></span>        <span class="n">password</span><span class="o">=</span><span class="s2">&quot;adminadmin&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos=" 9 "></span>        <span class="n">host</span><span class="o">=</span><span class="s2">&quot;iabd.cllw9xnmy9av.us-east-1.rds.amazonaws.com&quot;</span><span class="p">,</span>
<span class="linenos" data-linenos="10 "></span>        <span class="n">port</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span>
<span class="linenos" data-linenos="11 "></span>        <span class="n">database</span><span class="o">=</span><span class="s2">&quot;retail_db&quot;</span>
<span class="linenos" data-linenos="12 "></span>    <span class="p">)</span>
<span class="linenos" data-linenos="13 "></span><span class="k">except</span> <span class="n">mariadb</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="linenos" data-linenos="14 "></span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error conectando a MariaDB: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos" data-linenos="15 "></span>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos" data-linenos="16 "></span>
<span class="linenos" data-linenos="17 "></span><span class="n">ciudad</span> <span class="o">=</span> <span class="s2">&quot;Brownsville&quot;</span>
<span class="linenos" data-linenos="18 "></span>
<span class="linenos" data-linenos="19 "></span><span class="c1"># Obtenemos el cursor</span>
<span class="linenos" data-linenos="20 "></span><span class="n">cur</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
<span class="linenos" data-linenos="21 "></span><span class="n">sql</span> <span class="o">=</span> <span class="s2">&quot;select customer_id, customer_fname, customer_lname, customer_zipcode from customers where customer_city=?&quot;</span>
<span class="linenos" data-linenos="22 "></span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">ciudad</span><span class="p">,</span> <span class="p">))</span>
<span class="linenos" data-linenos="23 "></span>
<span class="linenos" data-linenos="24 "></span><span class="c1"># Recorremos el cursor e insertamos en DynamoDB</span>
<span class="linenos" data-linenos="25 "></span><span class="n">dynamodb</span> <span class="o">=</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s1">&#39;dynamodb&#39;</span><span class="p">,</span> <span class="n">region_name</span><span class="o">=</span><span class="s1">&#39;us-east-1&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="26 "></span><span class="n">tabla</span> <span class="o">=</span> <span class="n">dynamodb</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;SeveroClientes&#39;</span><span class="p">)</span>
<span class="linenos" data-linenos="27 "></span><span class="k">with</span> <span class="n">tabla</span><span class="o">.</span><span class="n">batch_writer</span><span class="p">()</span> <span class="k">as</span> <span class="n">batch</span><span class="p">:</span>
<span class="linenos" data-linenos="28 "></span>    <span class="k">for</span> <span class="n">customer_id</span><span class="p">,</span> <span class="n">customer_fname</span><span class="p">,</span> <span class="n">customer_lname</span><span class="p">,</span> <span class="n">customer_zipcode</span> <span class="ow">in</span> <span class="n">cur</span><span class="p">:</span> 
<span class="linenos" data-linenos="29 "></span>        <span class="n">Item</span> <span class="o">=</span> <span class="p">{</span>
<span class="linenos" data-linenos="30 "></span>            <span class="s1">&#39;Id&#39;</span><span class="p">:</span> <span class="n">customer_id</span><span class="p">,</span>
<span class="linenos" data-linenos="31 "></span>            <span class="s1">&#39;Zip&#39;</span><span class="p">:</span> <span class="n">customer_zipcode</span><span class="p">,</span>
<span class="linenos" data-linenos="32 "></span>            <span class="s1">&#39;Nombre&#39;</span><span class="p">:</span> <span class="n">customer_fname</span><span class="p">,</span>
<span class="linenos" data-linenos="33 "></span>            <span class="s1">&#39;Apellidos&#39;</span><span class="p">:</span> <span class="n">customer_lname</span><span class="p">,</span>
<span class="linenos" data-linenos="34 "></span>        <span class="p">}</span>
<span class="linenos" data-linenos="35 "></span>    <span class="n">batch</span><span class="o">.</span><span class="n">put_item</span><span class="p">(</span><span class="n">Item</span><span class="o">=</span><span class="n">Item</span><span class="p">)</span>
<span class="linenos" data-linenos="36 "></span>
<span class="linenos" data-linenos="37 "></span><span class="c1"># Cerramos el cursor y la conexión</span>
<span class="linenos" data-linenos="38 "></span><span class="n">cur</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="linenos" data-linenos="39 "></span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Bases de datos y Pandas</p>
<p>Si estás interesado en colocar dentro de <em>Pandas</em> los datos que recuperas desde una base de datos, es muy común utilizar <a href="https://www.sqlalchemy.org/">SQLAlchemy</a> el cual ofrece una capa por encima de los <em>drivers</em> (además de ofrecer un framework ORM).</p>
<p>Un fragmento de código que utiliza <em>Pandas</em> y <em>SQLAlchemy</em> sería similar a:</p>
<div class="highlight"><pre><span></span><code><span class="linenos" data-linenos="1 "></span><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">create_engine</span>
<span class="linenos" data-linenos="2 "></span><span class="kn">import</span> <span class="nn">pymysql</span>
<span class="linenos" data-linenos="3 "></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="linenos" data-linenos="4 "></span>
<span class="linenos" data-linenos="5 "></span><span class="n">sqlEngine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s1">&#39;mysql+pymysql://iabd:@127.0.0.1&#39;</span><span class="p">,</span> <span class="n">pool_recycle</span><span class="o">=</span><span class="mi">3600</span><span class="p">)</span>
<span class="linenos" data-linenos="6 "></span><span class="n">dbConnection</span> <span class="o">=</span> <span class="n">sqlEngine</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
<span class="linenos" data-linenos="7 "></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;select * from retail_db.customers&quot;</span><span class="p">,</span> <span class="n">dbConnection</span><span class="p">);</span>
</code></pre></div>
</div>
<h2 id="referencias">Referencias<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://docs.aws.amazon.com/es_es/AmazonRDS/latest/UserGuide/Welcome.html">Guía de usuario de Amazon RDS</a></li>
<li><a href="https://docs.aws.amazon.com/es_es/amazondynamodb/latest/developerguide/Introduction.html">Guía de referencias de Amazon DynamoDB</a></li>
<li><a href="https://amazon-dynamodb-labs.com/index.html">Laboratorios con ejemplos y modelado con Amazon DynamoDB</a></li>
<li><a href="https://highlandsolutions.com/blog/hands-on-examples-for-working-with-dynamodb-boto3-and-python">DynamoDB mediante Python</a></li>
<li><a href="https://www.fernandomc.com/posts/ten-examples-of-getting-data-from-dynamodb-with-python-and-boto3/">Ten Examples of Getting Data from DynamoDB with Python and Boto3</a></li>
<li><a href="https://medium.com/skyline-ai/dynamodb-insert-performance-basics-in-python-boto3-5bc01919c79f">DynamoDB Insert: Performance Basics in Python/Boto3</a></li>
</ul>
<!--
TODO: Curso DynamoDB desde AWS: https://www.aws.training/Details/Curriculum?id=65583&redirect=false
-->

<h2 id="actividades">Actividades<a class="headerlink" href="#actividades" title="Permanent link">&para;</a></h2>
<ol>
<li>
<p>(<abbr title="Gestiona sistemas de almacenamiento y el amplio ecosistema alrededor de ellos facilitando el procesamiento de grandes cantidades de datos sin fallos y de forma rápida.">RA5075.2</abbr> / <abbr title="Se ha determinado la importancia de los sistemas de almacenamiento para depositar y procesar grandes cantidades de cualquier tipo de datos rápidamente.">CE5.2a</abbr> / 1p) Realizar el módulo 8 (Bases de Datos) del curso <a href="https://awsacademy.instructure.com/courses/30530/">ACF de AWS</a>.</p>
</li>
<li>
<p>(<abbr title="Gestiona sistemas de almacenamiento y el amplio ecosistema alrededor de ellos facilitando el procesamiento de grandes cantidades de datos sin fallos y de forma rápida.">RA5075.2</abbr> / <abbr title="Se ha determinado la importancia de los sistemas de almacenamiento para depositar y procesar grandes cantidades de cualquier tipo de datos rápidamente.">CE5.2a</abbr> / 1p) Siguiendo el ejemplo de RDS, crea una instancia (<code>instituto</code>) de una base de datos de tipo <em>MariaDB</em> y cárgala con los datos de <code>retail_db</code>.</p>
<p>A partir de esta instancia, crea una instantánea de forma manual. A continuación, restaura esta instantánea en una nueva instancia (por ejemplo, <code>instituto2</code>) de tipo <code>db.t4g.small</code>, y tras conectarte mediante <em>DBeaver</em>, comprueba que tiene los datos ya cargados. Adjunta una captura de pantalla donde se vean las características de las dos instancias.</p>
</li>
<li>
<p>(<abbr title="Gestiona sistemas de almacenamiento y el amplio ecosistema alrededor de ellos facilitando el procesamiento de grandes cantidades de datos sin fallos y de forma rápida.">RA5075.2</abbr> / <abbr title="Se ha determinado la importancia de los sistemas de almacenamiento para depositar y procesar grandes cantidades de cualquier tipo de datos rápidamente.">CE5.2a</abbr> / 1p) Siguiendo el ejemplo de <em>DynamoDB</em>, crea la tabla (<code>ProductCatalog</code>), cárgala con los datos del ejemplo y realiza un consulta para obtener las bicicletas híbridas. Exporta el resultado a CSV.</p>
</li>
<li>
<p>(<abbr title="Gestiona sistemas de almacenamiento y el amplio ecosistema alrededor de ellos facilitando el procesamiento de grandes cantidades de datos sin fallos y de forma rápida.">RA5075.2</abbr> / <abbr title="Se ha determinado la importancia de los sistemas de almacenamiento para depositar y procesar grandes cantidades de cualquier tipo de datos rápidamente.">CE5.2a</abbr> / 1p) Realiza los casos de uso 1 y 2 de interacción desde <em>Python</em> con <em>DynamoDB</em>.</p>
</li>
</ol>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        <a href='https://ko-fi.com/T6T8GWT9N' title='Invítame a un café en ko-fi.com' target='_blank'><img height='36' style='border:0px;height:36px;' src='https://storage.ko-fi.com/cdn/kofi2.png?v=3' border='0' alt='Invítame a un café en ko-fi.com' /></a>
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="Me encantan estos apuntes" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="Los apuntes son mejorables" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Gracias por tu tiempo. Si quieres me puedes <a href='https://ko-fi.com/T6T8GWT9N'>invitar a un café en ko-fi</a>.
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              ¡Gracias por tu colaboración! Ayúdame a mejorar los apuntes enviándome un mail a <a href="mailto:a.medrano@edu.gva.es">a.medrano@edu.gva.es</a> con tus comentarios.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Volver al principio
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Pie" >
        
          
          <a href="05emr.html" class="md-footer__link md-footer__link--prev" aria-label="Anterior: EMR" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Anterior
                </span>
                EMR
              </div>
            </div>
          </a>
        
        
          
          <a href="07athena.html" class="md-footer__link md-footer__link--next" aria-label="Siguiente: Athena" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Siguiente
                </span>
                Athena
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2022-2023 Aitor Medrano - Licencia CC BY-NC-SA
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/aitormedrano" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<a.medrano@edu.gva.es>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48H48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0L0 176z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  
    
  




  


<h4>Consentimiento de cookie</h4>
<p>Esta página de apuntes utiliza cookies para reconocer las visitas, medir la efectividad de la documentación y averiguar si encuentras aquello que buscas o cómo has llegado a estos apuntes. Con tu consentimiento, me ayudas a mejorar estos materiales.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Aceptar</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Gestionar cookies</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["header.autohide", "navigation.top", "navigation.tracking", "navigation.footer", "navigation.indexes", "content.code.annotate", "announce.dismiss", "toc.follow", "content.code.copy"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
    
  </body>
</html>